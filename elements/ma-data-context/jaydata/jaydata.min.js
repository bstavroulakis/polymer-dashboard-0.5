/*! polymerdashboard 2015-02-11 */
function jsonify(a){return JSON.stringify(a,null,"	")}!function(a){"use strict";if("function"==typeof bootstrap)bootstrap("promise",a);else if("object"==typeof exports&&"object"==typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=a}else{if("undefined"==typeof self)throw new Error("This environment was not anticiapted by Q. Please file a bug.");self.Q=a()}}(function(){"use strict";function a(a){return function(){return V.apply(a,arguments)}}function b(a){return a===Object(a)}function c(a){return"[object StopIteration]"===bb(a)||a instanceof R}function d(a,b){if(O&&b.stack&&"object"==typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(cb)){for(var c=[],d=b;d;d=d.source)d.stack&&c.unshift(d.stack);c.unshift(a.stack);var f=c.join("\n"+cb+"\n");a.stack=e(f)}}function e(a){for(var b=a.split("\n"),c=[],d=0;d<b.length;++d){var e=b[d];h(e)||f(e)||!e||c.push(e)}return c.join("\n")}function f(a){return-1!==a.indexOf("(module.js:")||-1!==a.indexOf("(node.js:")}function g(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b)return[b[1],Number(b[2])];var c=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a);if(c)return[c[1],Number(c[2])];var d=/.*@(.+):(\d+)$/.exec(a);return d?[d[1],Number(d[2])]:void 0}function h(a){var b=g(a);if(!b)return!1;var c=b[0],d=b[1];return c===Q&&d>=S&&gb>=d}function i(){if(O)try{throw new Error}catch(a){var b=a.stack.split("\n"),c=b[0].indexOf("@")>0?b[1]:b[2],d=g(c);if(!d)return;return Q=d[0],d[1]}}function j(a,b,c){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(b+" is deprecated, use "+c+" instead.",new Error("").stack),a.apply(a,arguments)}}function k(a){return a instanceof o?a:s(a)?B(a):A(a)}function l(){function a(a){b=a,f.source=a,X(c,function(b,c){k.nextTick(function(){a.promiseDispatch.apply(a,c)})},void 0),c=void 0,d=void 0}var b,c=[],d=[],e=$(l.prototype),f=$(o.prototype);if(f.promiseDispatch=function(a,e,f){var g=W(arguments);c?(c.push(g),"when"===e&&f[1]&&d.push(f[1])):k.nextTick(function(){b.promiseDispatch.apply(b,g)})},f.valueOf=function(){if(c)return f;var a=q(b);return r(a)&&(b=a),a},f.inspect=function(){return b?b.inspect():{state:"pending"}},k.longStackSupport&&O)try{throw new Error}catch(g){f.stack=g.stack.substring(g.stack.indexOf("\n")+1)}return e.promise=f,e.resolve=function(c){b||a(k(c))},e.fulfill=function(c){b||a(A(c))},e.reject=function(c){b||a(z(c))},e.notify=function(a){b||X(d,function(b,c){k.nextTick(function(){c(a)})},void 0)},e}function m(a){if("function"!=typeof a)throw new TypeError("resolver must be a function.");var b=l();try{a(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}return b.promise}function n(a){return m(function(b,c){for(var d=0,e=a.length;e>d;d++)k(a[d]).then(b,c)})}function o(a,b,c){void 0===b&&(b=function(a){return z(new Error("Promise does not support operation: "+a))}),void 0===c&&(c=function(){return{state:"unknown"}});var d=$(o.prototype);if(d.promiseDispatch=function(c,e,f){var g;try{g=a[e]?a[e].apply(d,f):b.call(d,e,f)}catch(h){g=z(h)}c&&c(g)},d.inspect=c,c){var e=c();"rejected"===e.state&&(d.exception=e.reason),d.valueOf=function(){var a=c();return"pending"===a.state||"rejected"===a.state?d:a.value}}return d}function p(a,b,c,d){return k(a).then(b,c,d)}function q(a){if(r(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function r(a){return a instanceof o}function s(a){return b(a)&&"function"==typeof a.then}function t(a){return r(a)&&"pending"===a.inspect().state}function u(a){return!r(a)||"fulfilled"===a.inspect().state}function v(a){return r(a)&&"rejected"===a.inspect().state}function w(){db.length=0,eb.length=0,fb||(fb=!0)}function x(a,b){fb&&(eb.push(a),db.push(b&&"undefined"!=typeof b.stack?b.stack:"(no stack) "+b))}function y(a){if(fb){var b=Y(eb,a);-1!==b&&(eb.splice(b,1),db.splice(b,1))}}function z(a){var b=o({when:function(b){return b&&y(this),b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});return x(b,a),b}function A(a){return o({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return ab(a)}},void 0,function(){return{state:"fulfilled",value:a}})}function B(a){var b=l();return k.nextTick(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}}),b.promise}function C(a){return o({isDef:function(){}},function(b,c){return I(a,b,c)},function(){return k(a).inspect()})}function D(a,b,c){return k(a).spread(b,c)}function E(a){return function(){function b(a,b){var g;if("undefined"==typeof StopIteration){try{g=d[a](b)}catch(h){return z(h)}return g.done?k(g.value):p(g.value,e,f)}try{g=d[a](b)}catch(h){return c(h)?k(h.value):z(h)}return p(g,e,f)}var d=a.apply(this,arguments),e=b.bind(b,"next"),f=b.bind(b,"throw");return e()}}function F(a){k.done(k.async(a)())}function G(a){throw new R(a)}function H(a){return function(){return D([this,J(arguments)],function(b,c){return a.apply(b,c)})}}function I(a,b,c){return k(a).dispatch(b,c)}function J(a){return p(a,function(a){var b=0,c=l();return X(a,function(d,e,f){var g;r(e)&&"fulfilled"===(g=e.inspect()).state?a[f]=g.value:(++b,p(e,function(d){a[f]=d,0===--b&&c.resolve(a)},c.reject,function(a){c.notify({index:f,value:a})}))},void 0),0===b&&c.resolve(a),c.promise})}function K(a){return p(a,function(a){return a=Z(a,k),p(J(Z(a,function(a){return p(a,T,T)})),function(){return a})})}function L(a){return k(a).allSettled()}function M(a,b){return k(a).then(void 0,void 0,b)}function N(a,b){return k(a).nodeify(b)}var O=!1;try{throw new Error}catch(P){O=!!P.stack}var Q,R,S=i(),T=function(){},U=function(){function a(){for(;b.next;){b=b.next;var c=b.task;b.task=void 0;var e=b.domain;e&&(b.domain=void 0,e.enter());try{c()}catch(g){if(f)throw e&&e.exit(),setTimeout(a,0),e&&e.enter(),g;setTimeout(function(){throw g},0)}e&&e.exit()}d=!1}var b={task:void 0,next:null},c=b,d=!1,e=void 0,f=!1;if(U=function(a){c=c.next={task:a,domain:f&&process.domain,next:null},d||(d=!0,e())},"undefined"!=typeof process&&process.nextTick)f=!0,e=function(){process.nextTick(a)};else if("function"==typeof setImmediate)e="undefined"!=typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!=typeof MessageChannel){var g=new MessageChannel;g.port1.onmessage=function(){e=h,g.port1.onmessage=a,a()};var h=function(){g.port2.postMessage(0)};e=function(){setTimeout(a,0),h()}}else e=function(){setTimeout(a,0)};return U}(),V=Function.call,W=a(Array.prototype.slice),X=a(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length)for(;;){if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError}for(;d>c;c++)c in this&&(b=a(b,this[c],c));return b}),Y=a(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),Z=a(Array.prototype.map||function(a,b){var c=this,d=[];return X(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0),d}),$=Object.create||function(a){function b(){}return b.prototype=a,new b},_=a(Object.prototype.hasOwnProperty),ab=Object.keys||function(a){var b=[];for(var c in a)_(a,c)&&b.push(c);return b},bb=a(Object.prototype.toString);R="undefined"!=typeof ReturnValue?ReturnValue:function(a){this.value=a};var cb="From previous event:";k.resolve=k,k.nextTick=U,k.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(k.longStackSupport=!0),k.defer=l,l.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):a.resolve(arguments.length>2?W(arguments,1):c)}},k.Promise=m,k.promise=m,m.race=n,m.all=J,m.reject=z,m.resolve=k,k.passByCopy=function(a){return a},o.prototype.passByCopy=function(){return this},k.join=function(a,b){return k(a).join(b)},o.prototype.join=function(a){return k([this,a]).spread(function(a,b){if(a===b)return a;throw new Error("Can't join: not the same: "+a+" "+b)})},k.race=n,o.prototype.race=function(){return this.then(k.race)},k.makePromise=o,o.prototype.toString=function(){return"[object Promise]"},o.prototype.then=function(a,b,c){function e(b){try{return"function"==typeof a?a(b):b}catch(c){return z(c)}}function f(a){if("function"==typeof b){d(a,h);try{return b(a)}catch(c){return z(c)}}return z(a)}function g(a){return"function"==typeof c?c(a):a}var h=this,i=l(),j=!1;return k.nextTick(function(){h.promiseDispatch(function(a){j||(j=!0,i.resolve(e(a)))},"when",[function(a){j||(j=!0,i.resolve(f(a)))}])}),h.promiseDispatch(void 0,"when",[void 0,function(a){var b,c=!1;try{b=g(a)}catch(d){if(c=!0,!k.onerror)throw d;k.onerror(d)}c||i.notify(b)}]),i.promise},k.tap=function(a,b){return k(a).tap(b)},o.prototype.tap=function(a){return a=k(a),this.then(function(b){return a.fcall(b).thenResolve(b)})},k.when=p,o.prototype.thenResolve=function(a){return this.then(function(){return a})},k.thenResolve=function(a,b){return k(a).thenResolve(b)},o.prototype.thenReject=function(a){return this.then(function(){throw a})},k.thenReject=function(a,b){return k(a).thenReject(b)},k.nearer=q,k.isPromise=r,k.isPromiseAlike=s,k.isPending=t,o.prototype.isPending=function(){return"pending"===this.inspect().state},k.isFulfilled=u,o.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},k.isRejected=v,o.prototype.isRejected=function(){return"rejected"===this.inspect().state};var db=[],eb=[],fb=!0;k.resetUnhandledRejections=w,k.getUnhandledReasons=function(){return db.slice()},k.stopUnhandledRejectionTracking=function(){w(),fb=!1},w(),k.reject=z,k.fulfill=A,k.master=C,k.spread=D,o.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,b)},b)},k.async=E,k.spawn=F,k["return"]=G,k.promised=H,k.dispatch=I,o.prototype.dispatch=function(a,b){var c=this,d=l();return k.nextTick(function(){c.promiseDispatch(d.resolve,a,b)}),d.promise},k.get=function(a,b){return k(a).dispatch("get",[b])},o.prototype.get=function(a){return this.dispatch("get",[a])},k.set=function(a,b,c){return k(a).dispatch("set",[b,c])},o.prototype.set=function(a,b){return this.dispatch("set",[a,b])},k.del=k["delete"]=function(a,b){return k(a).dispatch("delete",[b])},o.prototype.del=o.prototype["delete"]=function(a){return this.dispatch("delete",[a])},k.mapply=k.post=function(a,b,c){return k(a).dispatch("post",[b,c])},o.prototype.mapply=o.prototype.post=function(a,b){return this.dispatch("post",[a,b])},k.send=k.mcall=k.invoke=function(a,b){return k(a).dispatch("post",[b,W(arguments,2)])},o.prototype.send=o.prototype.mcall=o.prototype.invoke=function(a){return this.dispatch("post",[a,W(arguments,1)])},k.fapply=function(a,b){return k(a).dispatch("apply",[void 0,b])},o.prototype.fapply=function(a){return this.dispatch("apply",[void 0,a])},k["try"]=k.fcall=function(a){return k(a).dispatch("apply",[void 0,W(arguments,1)])},o.prototype.fcall=function(){return this.dispatch("apply",[void 0,W(arguments)])},k.fbind=function(a){var b=k(a),c=W(arguments,1);return function(){return b.dispatch("apply",[this,c.concat(W(arguments))])}},o.prototype.fbind=function(){var a=this,b=W(arguments);return function(){return a.dispatch("apply",[this,b.concat(W(arguments))])}},k.keys=function(a){return k(a).dispatch("keys",[])},o.prototype.keys=function(){return this.dispatch("keys",[])},k.all=J,o.prototype.all=function(){return J(this)},k.allResolved=j(K,"allResolved","allSettled"),o.prototype.allResolved=function(){return K(this)},k.allSettled=L,o.prototype.allSettled=function(){return this.then(function(a){return J(Z(a,function(a){function b(){return a.inspect()}return a=k(a),a.then(b,b)}))})},k.fail=k["catch"]=function(a,b){return k(a).then(void 0,b)},o.prototype.fail=o.prototype["catch"]=function(a){return this.then(void 0,a)},k.progress=M,o.prototype.progress=function(a){return this.then(void 0,void 0,a)},k.fin=k["finally"]=function(a,b){return k(a)["finally"](b)},o.prototype.fin=o.prototype["finally"]=function(a){return a=k(a),this.then(function(b){return a.fcall().then(function(){return b})},function(b){return a.fcall().then(function(){throw b})})},k.done=function(a,b,c,d){return k(a).done(b,c,d)},o.prototype.done=function(a,b,c){var e=function(a){k.nextTick(function(){if(d(a,f),!k.onerror)throw a;k.onerror(a)})},f=a||b||c?this.then(a,b,c):this;"object"==typeof process&&process&&process.domain&&(e=process.domain.bind(e)),f.then(void 0,e)},k.timeout=function(a,b,c){return k(a).timeout(b,c)},o.prototype.timeout=function(a,b){var c=l(),d=setTimeout(function(){b&&"string"!=typeof b||(b=new Error(b||"Timed out after "+a+" ms"),b.code="ETIMEDOUT"),c.reject(b)},a);return this.then(function(a){clearTimeout(d),c.resolve(a)},function(a){clearTimeout(d),c.reject(a)},c.notify),c.promise},k.delay=function(a,b){return void 0===b&&(b=a,a=void 0),k(a).delay(b)},o.prototype.delay=function(a){return this.then(function(b){var c=l();return setTimeout(function(){c.resolve(b)},a),c.promise})},k.nfapply=function(a,b){return k(a).nfapply(b)},o.prototype.nfapply=function(a){var b=l(),c=W(a);return c.push(b.makeNodeResolver()),this.fapply(c).fail(b.reject),b.promise},k.nfcall=function(a){var b=W(arguments,1);return k(a).nfapply(b)},o.prototype.nfcall=function(){var a=W(arguments),b=l();return a.push(b.makeNodeResolver()),this.fapply(a).fail(b.reject),b.promise},k.nfbind=k.denodeify=function(a){var b=W(arguments,1);return function(){var c=b.concat(W(arguments)),d=l();return c.push(d.makeNodeResolver()),k(a).fapply(c).fail(d.reject),d.promise}},o.prototype.nfbind=o.prototype.denodeify=function(){var a=W(arguments);return a.unshift(this),k.denodeify.apply(void 0,a)},k.nbind=function(a,b){var c=W(arguments,2);return function(){function d(){return a.apply(b,arguments)}var e=c.concat(W(arguments)),f=l();return e.push(f.makeNodeResolver()),k(d).fapply(e).fail(f.reject),f.promise}},o.prototype.nbind=function(){var a=W(arguments,0);return a.unshift(this),k.nbind.apply(void 0,a)},k.nmapply=k.npost=function(a,b,c){return k(a).npost(b,c)},o.prototype.nmapply=o.prototype.npost=function(a,b){var c=W(b||[]),d=l();return c.push(d.makeNodeResolver()),this.dispatch("post",[a,c]).fail(d.reject),d.promise},k.nsend=k.nmcall=k.ninvoke=function(a,b){var c=W(arguments,2),d=l();return c.push(d.makeNodeResolver()),k(a).dispatch("post",[b,c]).fail(d.reject),d.promise},o.prototype.nsend=o.prototype.nmcall=o.prototype.ninvoke=function(a){var b=W(arguments,1),c=l();return b.push(c.makeNodeResolver()),this.dispatch("post",[a,b]).fail(c.reject),c.promise},k.nodeify=N,o.prototype.nodeify=function(a){return a?void this.then(function(b){k.nextTick(function(){a(null,b)})},function(b){k.nextTick(function(){a(b)})}):this};var gb=i();return k}),function(a){return"object"==typeof exports&&"object"==typeof module?a(exports):"function"==typeof define&&define.amd?define(["exports"],a):void a(self.acorn||(self.acorn={}))}(function(a){"use strict";function b(a){nb=a||{};for(var b in rb)nb.hasOwnProperty(b)||(nb[b]=rb[b]);qb=nb.sourceFile||null}function c(a,b){var c=sb(ob,a);b+=" ("+c.line+":"+c.column+")";var d=new SyntaxError(b);throw d.pos=a,d.loc=c,d.raisedAt=tb,d}function d(a){function b(a){if(1==a.length)return c+="return str === "+JSON.stringify(a[0])+";";c+="switch(str){";for(var b=0;b<a.length;++b)c+="case "+JSON.stringify(a[b])+":";c+="return true}return false;"}a=a.split(" ");var c="",d=[];a:for(var e=0;e<a.length;++e){for(var f=0;f<d.length;++f)if(d[f][0].length==a[e].length){d[f].push(a[e]);continue a}d.push([a[e]])}if(d.length>3){d.sort(function(a,b){return b.length-a.length}),c+="switch(str.length){";for(var e=0;e<d.length;++e){var g=d[e];c+="case "+g[0].length+":",b(g)}c+="}"}else b(a);return new Function("str",c)}function e(a){return 65>a?36===a:91>a?!0:97>a?95===a:123>a?!0:a>=170&&Wc.test(String.fromCharCode(a))}function f(a){return 48>a?36===a:58>a?!0:65>a?!1:91>a?!0:97>a?95===a:123>a?!0:a>=170&&Xc.test(String.fromCharCode(a))}function g(){this.line=Bb,this.column=tb-Cb}function h(){Bb=1,tb=Cb=0,Ab=!0,l()}function i(a,b){vb=tb,nb.locations&&(xb=new g),yb=a,l(),zb=b,Ab=a.beforeExpr}function j(){var a=nb.onComment&&nb.locations&&new g,b=tb,d=ob.indexOf("*/",tb+=2);if(-1===d&&c(tb-2,"Unterminated comment"),tb=d+2,nb.locations){Zc.lastIndex=b;for(var e;(e=Zc.exec(ob))&&e.index<tb;)++Bb,Cb=e.index+e[0].length}nb.onComment&&nb.onComment(!0,ob.slice(b+2,d),b,tb,a,nb.locations&&new g)}function k(){for(var a=tb,b=nb.onComment&&nb.locations&&new g,c=ob.charCodeAt(tb+=2);pb>tb&&10!==c&&13!==c&&8232!==c&&8329!==c;)++tb,c=ob.charCodeAt(tb);nb.onComment&&nb.onComment(!1,ob.slice(a+2,tb),a,tb,b,nb.locations&&new g)}function l(){for(;pb>tb;){var a=ob.charCodeAt(tb);if(32===a)++tb;else if(13===a){++tb;var b=ob.charCodeAt(tb);10===b&&++tb,nb.locations&&(++Bb,Cb=tb)}else if(10===a)++tb,++Bb,Cb=tb;else if(14>a&&a>8)++tb;else if(47===a){var b=ob.charCodeAt(tb+1);if(42===b)j();else{if(47!==b)break;k()}}else if(14>a&&a>8||32===a||160===a)++tb;else{if(!(a>=5760&&Tc.test(String.fromCharCode(a))))break;++tb}}}function m(){var a=ob.charCodeAt(tb+1);return a>=48&&57>=a?A(!0):(++tb,i(vc))}function n(){var a=ob.charCodeAt(tb+1);return Ab?(++tb,x()):61===a?w(zc,2):w(xc,1)}function o(){var a=ob.charCodeAt(tb+1);return 61===a?w(zc,2):w(Lc,1)}function p(a){var b=ob.charCodeAt(tb+1);return b===a?w(124===a?Dc:Ec,2):61===b?w(zc,2):w(124===a?Fc:Hc,1)}function q(){var a=ob.charCodeAt(tb+1);return 61===a?w(zc,2):w(Gc,1)}function r(a){var b=ob.charCodeAt(tb+1);return b===a?w(Bc,2):61===b?w(zc,2):w(Ac,1)}function s(a){var b=ob.charCodeAt(tb+1),c=1;return b===a?(c=62===a&&62===ob.charCodeAt(tb+2)?3:2,61===ob.charCodeAt(tb+c)?w(zc,c+1):w(Kc,c)):(61===b&&(c=61===ob.charCodeAt(tb+2)?3:2),w(Jc,c))}function t(a){var b=ob.charCodeAt(tb+1);return 61===b?w(Ic,61===ob.charCodeAt(tb+2)?3:2):w(61===a?yc:Cc,1)}function u(a){switch(a){case 46:return m();case 40:return++tb,i(qc);case 41:return++tb,i(rc);case 59:return++tb,i(tc);case 44:return++tb,i(sc);case 91:return++tb,i(mc);case 93:return++tb,i(nc);case 123:return++tb,i(oc);case 125:return++tb,i(pc);case 58:return++tb,i(uc);case 63:return++tb,i(wc);case 48:var b=ob.charCodeAt(tb+1);if(120===b||88===b)return z();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return A(!1);case 34:case 39:return B(a);case 47:return n(a);case 37:case 42:return o();case 124:case 38:return p(a);case 94:return q();case 43:case 45:return r(a);case 60:case 62:return s(a);case 61:case 33:return t(a);case 126:return w(Cc,1)}return!1}function v(a){if(a?tb=ub+1:ub=tb,nb.locations&&(wb=new g),a)return x();if(tb>=pb)return i(Nb);var b=ob.charCodeAt(tb);if(e(b)||92===b)return E();var d=u(b);if(d===!1){var f=String.fromCharCode(b);if("\\"===f||Wc.test(f))return E();c(tb,"Unexpected character '"+f+"'")}return d}function w(a,b){var c=ob.slice(tb,tb+b);tb+=b,i(a,c)}function x(){for(var a,b,d="",e=tb;;){tb>=pb&&c(e,"Unterminated regular expression");var f=ob.charAt(tb);if(Yc.test(f)&&c(e,"Unterminated regular expression"),a)a=!1;else{if("["===f)b=!0;else if("]"===f&&b)b=!1;else if("/"===f&&!b)break;a="\\"===f}++tb}var d=ob.slice(e,tb);++tb;var g=D();return g&&!/^[gmsiy]*$/.test(g)&&c(e,"Invalid regexp flag"),i(Kb,new RegExp(d,g))}function y(a,b){for(var c=tb,d=0,e=0,f=null==b?1/0:b;f>e;++e){var g,h=ob.charCodeAt(tb);if(g=h>=97?h-97+10:h>=65?h-65+10:h>=48&&57>=h?h-48:1/0,g>=a)break;++tb,d=d*a+g}return tb===c||null!=b&&tb-c!==b?null:d}function z(){tb+=2;var a=y(16);return null==a&&c(ub+2,"Expected hexadecimal number"),e(ob.charCodeAt(tb))&&c(tb,"Identifier directly after number"),i(Jb,a)}function A(a){var b=tb,d=!1,f=48===ob.charCodeAt(tb);a||null!==y(10)||c(b,"Invalid number"),46===ob.charCodeAt(tb)&&(++tb,y(10),d=!0);var g=ob.charCodeAt(tb);(69===g||101===g)&&(g=ob.charCodeAt(++tb),(43===g||45===g)&&++tb,null===y(10)&&c(b,"Invalid number"),d=!0),e(ob.charCodeAt(tb))&&c(tb,"Identifier directly after number");var h,j=ob.slice(b,tb);return d?h=parseFloat(j):f&&1!==j.length?/[89]/.test(j)||Ib?c(b,"Invalid number"):h=parseInt(j,8):h=parseInt(j,10),i(Jb,h)}function B(a){tb++;for(var b="";;){tb>=pb&&c(ub,"Unterminated string constant");var d=ob.charCodeAt(tb);if(d===a)return++tb,i(Lb,b);if(92===d){d=ob.charCodeAt(++tb);var e=/^[0-7]+/.exec(ob.slice(tb,tb+3));for(e&&(e=e[0]);e&&parseInt(e,8)>255;)e=e.slice(0,e.length-1);if("0"===e&&(e=null),++tb,e)Ib&&c(tb-2,"Octal literal in strict mode"),b+=String.fromCharCode(parseInt(e,8)),tb+=e.length-1;else switch(d){case 110:b+="\n";break;case 114:b+="\r";break;case 120:b+=String.fromCharCode(C(2));break;case 117:b+=String.fromCharCode(C(4));break;case 85:b+=String.fromCharCode(C(8));break;case 116:b+="	";break;case 98:b+="\b";break;case 118:b+="";break;case 102:b+="\f";break;case 48:b+="\x00";break;case 13:10===ob.charCodeAt(tb)&&++tb;case 10:nb.locations&&(Cb=tb,++Bb);break;default:b+=String.fromCharCode(d)}}else(13===d||10===d||8232===d||8329===d)&&c(ub,"Unterminated string constant"),b+=String.fromCharCode(d),++tb}}function C(a){var b=y(16,a);return null===b&&c(ub,"Bad character escape sequence"),b}function D(){Nc=!1;for(var a,b=!0,d=tb;;){var g=ob.charCodeAt(tb);if(f(g))Nc&&(a+=ob.charAt(tb)),++tb;else{if(92!==g)break;Nc||(a=ob.slice(d,tb)),Nc=!0,117!=ob.charCodeAt(++tb)&&c(tb,"Expecting Unicode escape sequence \\uXXXX"),++tb;var h=C(4),i=String.fromCharCode(h);i||c(tb-1,"Invalid Unicode escape"),(b?e(h):f(h))||c(tb-4,"Invalid Unicode escape"),a+=i}b=!1}return Nc?a:ob.slice(d,tb)}function E(){var a=D(),b=Mb;return Nc||(Sc(a)?b=lc[a]:(nb.forbidReserved&&(3===nb.ecmaVersion?Oc:Pc)(a)||Ib&&Qc(a))&&c(ub,"The keyword '"+a+"' is reserved")),i(b,a)}function F(){Db=ub,Eb=vb,Fb=xb,v()}function G(a){for(Ib=a,tb=Eb;Cb>tb;)Cb=ob.lastIndexOf("\n",Cb-2)+1,--Bb;l(),v()}function H(){this.type=null,this.start=ub,this.end=null}function I(){this.start=wb,this.end=null,null!==qb&&(this.source=qb)}function J(){var a=new H;return nb.locations&&(a.loc=new I),nb.ranges&&(a.range=[ub,0]),a}function K(a){var b=new H;return b.start=a.start,nb.locations&&(b.loc=new I,b.loc.start=a.loc.start),nb.ranges&&(b.range=[a.range[0],0]),b}function L(a,b){return a.type=b,a.end=Eb,nb.locations&&(a.loc.end=Fb),nb.ranges&&(a.range[1]=Eb),a}function M(a){return nb.ecmaVersion>=5&&"ExpressionStatement"===a.type&&"Literal"===a.expression.type&&"use strict"===a.expression.value}function N(a){return yb===a?(F(),!0):void 0}function O(){return!nb.strictSemicolons&&(yb===Nb||yb===pc||Yc.test(ob.slice(Eb,ub)))}function P(){N(tc)||O()||R()}function Q(a){yb===a?F():R()}function R(){c(ub,"Unexpected token")}function S(a){"Identifier"!==a.type&&"MemberExpression"!==a.type&&c(a.start,"Assigning to rvalue"),Ib&&"Identifier"===a.type&&Rc(a.name)&&c(a.start,"Assigning to "+a.name+" in strict mode")}function T(a){Db=Eb=tb,nb.locations&&(Fb=new g),Gb=Ib=null,Hb=[],v();var b=a||J(),c=!0;for(a||(b.body=[]);yb!==Nb;){var d=U();b.body.push(d),c&&M(d)&&G(!0),c=!1}return L(b,"Program")}function U(){yb===xc&&v(!0);var a=yb,b=J();switch(a){case Ob:case Rb:F();var d=a===Ob;N(tc)||O()?b.label=null:yb!==Mb?R():(b.label=mb(),P());for(var e=0;e<Hb.length;++e){var f=Hb[e];if(null==b.label||f.name===b.label.name){if(null!=f.kind&&(d||"loop"===f.kind))break;if(b.label&&d)break}}return e===Hb.length&&c(b.start,"Unsyntactic "+a.keyword),L(b,d?"BreakStatement":"ContinueStatement");case Sb:return F(),P(),L(b,"DebuggerStatement");case Ub:return F(),Hb.push($c),b.body=U(),Hb.pop(),Q(dc),b.test=V(),P(),L(b,"DoWhileStatement");case Xb:if(F(),Hb.push($c),Q(qc),yb===tc)return X(b,null);if(yb===cc){var g=J();return F(),Z(g,!0),1===g.declarations.length&&N(kc)?Y(b,g):X(b,g)}var g=$(!1,!0);return N(kc)?(S(g),Y(b,g)):X(b,g);case Yb:return F(),kb(b,!0);case Zb:return F(),b.test=V(),b.consequent=U(),b.alternate=N(Vb)?U():null,L(b,"IfStatement");case $b:return Gb||c(ub,"'return' outside of function"),F(),N(tc)||O()?b.argument=null:(b.argument=$(),P()),L(b,"ReturnStatement");case _b:F(),b.discriminant=V(),b.cases=[],Q(oc),Hb.push(_c);for(var h,i;yb!=pc;)if(yb===Pb||yb===Tb){var j=yb===Pb;h&&L(h,"SwitchCase"),b.cases.push(h=J()),h.consequent=[],F(),j?h.test=$():(i&&c(Db,"Multiple default clauses"),i=!0,h.test=null),Q(uc)}else h||R(),h.consequent.push(U());return h&&L(h,"SwitchCase"),F(),Hb.pop(),L(b,"SwitchStatement");case ac:return F(),Yc.test(ob.slice(Eb,ub))&&c(Eb,"Illegal newline after throw"),b.argument=$(),P(),L(b,"ThrowStatement");case bc:if(F(),b.block=W(),b.handler=null,yb===Qb){var k=J();F(),Q(qc),k.param=mb(),Ib&&Rc(k.param.name)&&c(k.param.start,"Binding "+k.param.name+" in strict mode"),Q(rc),k.guard=null,k.body=W(),b.handler=L(k,"CatchClause")}return b.finalizer=N(Wb)?W():null,b.handler||b.finalizer||c(b.start,"Missing catch or finally clause"),L(b,"TryStatement");case cc:return F(),b=Z(b),P(),b;case dc:return F(),b.test=V(),Hb.push($c),b.body=U(),Hb.pop(),L(b,"WhileStatement");case ec:return Ib&&c(ub,"'with' in strict mode"),F(),b.object=V(),b.body=U(),L(b,"WithStatement");case oc:return W();case tc:return F(),L(b,"EmptyStatement");default:var l=zb,m=$();if(a===Mb&&"Identifier"===m.type&&N(uc)){for(var e=0;e<Hb.length;++e)Hb[e].name===l&&c(m.start,"Label '"+l+"' is already declared");var n=yb.isLoop?"loop":yb===_b?"switch":null;return Hb.push({name:l,kind:n}),b.body=U(),Hb.pop(),b.label=m,L(b,"LabeledStatement")}return b.expression=m,P(),L(b,"ExpressionStatement")}}function V(){Q(qc);var a=$();return Q(rc),a}function W(){var a,b=J(),c=!0,d=!1;for(b.body=[],Q(oc);!N(pc);){var e=U();b.body.push(e),c&&M(e)&&(a=d,G(d=!0)),c=!1}return d&&!a&&G(!1),L(b,"BlockStatement")}function X(a,b){return a.init=b,Q(tc),a.test=yb===tc?null:$(),Q(tc),a.update=yb===rc?null:$(),Q(rc),a.body=U(),Hb.pop(),L(a,"ForStatement")}function Y(a,b){return a.left=b,a.right=$(),Q(rc),a.body=U(),Hb.pop(),L(a,"ForInStatement")}function Z(a,b){for(a.declarations=[],a.kind="var";;){var d=J();if(d.id=mb(),Ib&&Rc(d.id.name)&&c(d.id.start,"Binding "+d.id.name+" in strict mode"),d.init=N(yc)?$(!0,b):null,a.declarations.push(L(d,"VariableDeclarator")),!N(sc))break}return L(a,"VariableDeclaration")}function $(a,b){var c=_(b);if(!a&&yb===sc){var d=K(c);for(d.expressions=[c];N(sc);)d.expressions.push(_(b));return L(d,"SequenceExpression")}return c}function _(a){var b=ab(a);if(yb.isAssign){var c=K(b);return c.operator=zb,c.left=b,F(),c.right=_(a),S(b),L(c,"AssignmentExpression")}return b}function ab(a){var b=bb(a);if(N(wc)){var c=K(b);return c.test=b,c.consequent=$(!0),Q(uc),c.alternate=$(!0,a),L(c,"ConditionalExpression")}return b}function bb(a){return cb(db(a),-1,a)}function cb(a,b,c){var d=yb.binop;if(null!=d&&(!c||yb!==kc)&&d>b){var e=K(a);e.left=a,e.operator=zb,F(),e.right=cb(db(c),d,c);var e=L(e,/&&|\|\|/.test(e.operator)?"LogicalExpression":"BinaryExpression");return cb(e,b,c)}return a}function db(a){if(yb.prefix){var b=J(),d=yb.isUpdate;return b.operator=zb,b.prefix=!0,F(),b.argument=db(a),d?S(b.argument):Ib&&"delete"===b.operator&&"Identifier"===b.argument.type&&c(b.start,"Deleting local variable in strict mode"),L(b,d?"UpdateExpression":"UnaryExpression")}for(var e=eb();yb.postfix&&!O();){var b=K(e);b.operator=zb,b.prefix=!1,b.argument=e,S(e),F(),e=L(b,"UpdateExpression")}return e}function eb(){return fb(gb())}function fb(a,b){if(N(vc)){var c=K(a);return c.object=a,c.property=mb(!0),c.computed=!1,fb(L(c,"MemberExpression"),b)}if(N(mc)){var c=K(a);return c.object=a,c.property=$(),c.computed=!0,Q(nc),fb(L(c,"MemberExpression"),b)}if(!b&&N(qc)){var c=K(a);return c.callee=a,c.arguments=lb(rc,!1),fb(L(c,"CallExpression"),b)}return a}function gb(){switch(yb){case gc:var a=J();return F(),L(a,"ThisExpression");case Mb:return mb();case Jb:case Lb:case Kb:var a=J();return a.value=zb,a.raw=ob.slice(ub,vb),F(),L(a,"Literal");case hc:case ic:case jc:var a=J();return a.value=yb.atomValue,a.raw=yb.keyword,F(),L(a,"Literal");case qc:var b=wb,c=ub;F();var d=$();return d.start=c,d.end=vb,nb.locations&&(d.loc.start=b,d.loc.end=xb),nb.ranges&&(d.range=[c,vb]),Q(rc),d;case mc:var a=J();return F(),a.elements=lb(nc,!0,!0),L(a,"ArrayExpression");case oc:return ib();case Yb:var a=J();return F(),kb(a,!1);case fc:return hb();default:R()}}function hb(){var a=J();return F(),a.callee=fb(gb(),!0),a.arguments=N(qc)?lb(rc,!1):[],L(a,"NewExpression")}function ib(){var a=J(),b=!0,d=!1;for(a.properties=[],F();!N(pc);){if(b)b=!1;else if(Q(sc),nb.allowTrailingCommas&&N(pc))break;var e,f={key:jb()},g=!1;if(N(uc)?(f.value=$(!0),e=f.kind="init"):nb.ecmaVersion>=5&&"Identifier"===f.key.type&&("get"===f.key.name||"set"===f.key.name)?(g=d=!0,e=f.kind=f.key.name,f.key=jb(),yb!==qc&&R(),f.value=kb(J(),!1)):R(),"Identifier"===f.key.type&&(Ib||d))for(var h=0;h<a.properties.length;++h){var i=a.properties[h];if(i.key.name===f.key.name){var j=e==i.kind||g&&"init"===i.kind||"init"===e&&("get"===i.kind||"set"===i.kind);j&&!Ib&&"init"===e&&"init"===i.kind&&(j=!1),j&&c(f.key.start,"Redefinition of property")}}a.properties.push(f)}return L(a,"ObjectExpression")}function jb(){return yb===Jb||yb===Lb?gb():mb(!0)}function kb(a,b){yb===Mb?a.id=mb():b?R():a.id=null,a.params=[];var d=!0;for(Q(qc);!N(rc);)d?d=!1:Q(sc),a.params.push(mb());var e=Gb,f=Hb;if(Gb=!0,Hb=[],a.body=W(!0),Gb=e,Hb=f,Ib||a.body.body.length&&M(a.body.body[0]))for(var g=a.id?-1:0;g<a.params.length;++g){var h=0>g?a.id:a.params[g];if((Qc(h.name)||Rc(h.name))&&c(h.start,"Defining '"+h.name+"' in strict mode"),g>=0)for(var i=0;g>i;++i)h.name===a.params[i].name&&c(h.start,"Argument name clash in strict mode")}return L(a,b?"FunctionDeclaration":"FunctionExpression")}function lb(a,b,c){for(var d=[],e=!0;!N(a);){if(e)e=!1;else if(Q(sc),b&&nb.allowTrailingCommas&&N(a))break;d.push(c&&yb===sc?null:$(!0))}return d}function mb(a){var b=J();return b.name=yb===Mb?zb:a&&!nb.forbidReserved&&yb.keyword||R(),F(),L(b,"Identifier")}a.version="0.1.01";var nb,ob,pb,qb;a.parse=function(a,c){return ob=String(a),pb=ob.length,b(c),h(),T(nb.program)};var rb=a.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null},sb=a.getLineInfo=function(a,b){for(var c=1,d=0;;){Zc.lastIndex=d;var e=Zc.exec(a);if(!(e&&e.index<b))break;++c,d=e.index+e[0].length}return{line:c,column:b-d}};a.tokenize=function(a,c){function d(a){return v(a),e.start=ub,e.end=vb,e.startLoc=wb,e.endLoc=xb,e.type=yb,e.value=zb,e}ob=String(a),pb=ob.length,b(c),h();var e={};return d.jumpTo=function(a,b){if(tb=a,nb.locations){Bb=Cb=Zc.lastIndex=0;for(var c;(c=Zc.exec(ob))&&c.index<a;)++Bb,Cb=c.index+c[0].length}ob.charAt(a-1);Ab=b,l()},d};var tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb,Ib,Jb={type:"num"},Kb={type:"regexp"},Lb={type:"string"},Mb={type:"name"},Nb={type:"eof"},Ob={keyword:"break"},Pb={keyword:"case",beforeExpr:!0},Qb={keyword:"catch"},Rb={keyword:"continue"},Sb={keyword:"debugger"},Tb={keyword:"default"},Ub={keyword:"do",isLoop:!0},Vb={keyword:"else",beforeExpr:!0},Wb={keyword:"finally"},Xb={keyword:"for",isLoop:!0},Yb={keyword:"function"},Zb={keyword:"if"},$b={keyword:"return",beforeExpr:!0},_b={keyword:"switch"},ac={keyword:"throw",beforeExpr:!0},bc={keyword:"try"},cc={keyword:"var"},dc={keyword:"while",isLoop:!0},ec={keyword:"with"},fc={keyword:"new",beforeExpr:!0},gc={keyword:"this"},hc={keyword:"null",atomValue:null},ic={keyword:"true",atomValue:!0},jc={keyword:"false",atomValue:!1},kc={keyword:"in",binop:7,beforeExpr:!0},lc={"break":Ob,"case":Pb,"catch":Qb,"continue":Rb,"debugger":Sb,"default":Tb,"do":Ub,"else":Vb,"finally":Wb,"for":Xb,"function":Yb,"if":Zb,"return":$b,"switch":_b,"throw":ac,"try":bc,"var":cc,"while":dc,"with":ec,"null":hc,"true":ic,"false":jc,"new":fc,"in":kc,"instanceof":{keyword:"instanceof",binop:7,beforeExpr:!0},"this":gc,"typeof":{keyword:"typeof",prefix:!0,beforeExpr:!0},"void":{keyword:"void",prefix:!0,beforeExpr:!0},"delete":{keyword:"delete",prefix:!0,beforeExpr:!0}},mc={type:"[",beforeExpr:!0},nc={type:"]"},oc={type:"{",beforeExpr:!0},pc={type:"}"},qc={type:"(",beforeExpr:!0},rc={type:")"},sc={type:",",beforeExpr:!0},tc={type:";",beforeExpr:!0},uc={type:":",beforeExpr:!0},vc={type:"."},wc={type:"?",beforeExpr:!0},xc={binop:10,beforeExpr:!0},yc={isAssign:!0,beforeExpr:!0},zc={isAssign:!0,beforeExpr:!0},Ac={binop:9,prefix:!0,beforeExpr:!0},Bc={postfix:!0,prefix:!0,isUpdate:!0},Cc={prefix:!0,beforeExpr:!0},Dc={binop:1,beforeExpr:!0},Ec={binop:2,beforeExpr:!0},Fc={binop:3,beforeExpr:!0},Gc={binop:4,beforeExpr:!0},Hc={binop:5,beforeExpr:!0},Ic={binop:6,beforeExpr:!0},Jc={binop:7,beforeExpr:!0},Kc={binop:8,beforeExpr:!0},Lc={binop:10,beforeExpr:!0};
a.tokTypes={bracketL:mc,bracketR:nc,braceL:oc,braceR:pc,parenL:qc,parenR:rc,comma:sc,semi:tc,colon:uc,dot:vc,question:wc,slash:xc,eq:yc,name:Mb,eof:Nb,num:Jb,regexp:Kb,string:Lb};for(var Mc in lc)a.tokTypes[Mc]=lc[Mc];var Nc,Oc=d("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),Pc=d("class enum extends super const export import"),Qc=d("implements interface let package private protected public static yield"),Rc=d("eval arguments"),Sc=d("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),Tc=/[\u1680\u180e\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]/,Uc="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",Vc="ͱ-ʹ҃-֑҇-ׇֽֿׁׂׅׄؐ-ؚؠ-ىٲ-ۓۧ-ۨۻ-ۼܰ-݊ࠀ-ࠔࠛ-ࠣࠥ-ࠧࠩ-࠭ࡀ-ࡗࣤ-ࣾऀ-ःऺ-़ा-ॏ॑-ॗॢ-ॣ०-९ঁ-ঃ়া-ৄেৈৗয়-ৠਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢ-ૣ૦-૯ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୟ-ୠ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఁ-ఃె-ైొ-్ౕౖౢ-ౣ౦-౯ಂಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢ-ೣ೦-೯ംഃെ-ൈൗൢ-ൣ൦-൯ංඃ්ා-ුූෘ-ෟෲෳิ-ฺเ-ๅ๐-๙ິ-ູ່-ໍ໐-໙༘༙༠-༩༹༵༷ཁ-ཇཱ-྄྆-྇ྍ-ྗྙ-ྼ࿆က-ဩ၀-၉ၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟ᜎ-ᜐᜠ-ᜰᝀ-ᝐᝲᝳក-ឲ៝០-៩᠋-᠍᠐-᠙ᤠ-ᤫᤰ-᤻ᥑ-ᥭᦰ-ᧀᧈ-ᧉ᧐-᧙ᨀ-ᨕᨠ-ᩓ᩠-᩿᩼-᪉᪐-᪙ᭆ-ᭋ᭐-᭙᭫-᭳᮰-᮹᯦-᯳ᰀ-ᰢ᱀-᱉ᱛ-ᱽ᳐-᳒ᴀ-ᶾḁ-ἕ‌‍‿⁀⁔⃐-⃥⃜⃡-⃰ⶁ-ⶖⷠ-ⷿ〡-〨゙゚Ꙁ-ꙭꙴ-꙽ꚟ꛰-꛱ꟸ-ꠀ꠆ꠋꠣ-ꠧꢀ-ꢁꢴ-꣄꣐-꣙ꣳ-ꣷ꤀-꤉ꤦ-꤭ꤰ-ꥅꦀ-ꦃ꦳-꧀ꨀ-ꨧꩀ-ꩁꩌ-ꩍ꩐-꩙ꩻꫠ-ꫩꫲ-ꫳꯀ-ꯡ꯬꯭꯰-꯹ﬠ-ﬨ︀-️︠-︦︳︴﹍-﹏０-９＿",Wc=new RegExp("["+Uc+"]"),Xc=new RegExp("["+Uc+Vc+"]"),Yc=/[\n\r\u2028\u2029]/,Zc=/\r\n|[\n\r\u2028\u2029]/g,$c={kind:"loop"},_c={kind:"switch"}}),function(){"undefined"==typeof window&&(window=this),$data=window.$data||(window.$data=function a(){if(this instanceof a){var b=a.implementation.apply(this,arguments);return new b(arguments[1])}return a.implementation.apply(this,arguments)})}(this),"undefined"==typeof console&&(console={warn:function(){},error:function(){},log:function(){},dir:function(){},time:function(){},timeEnd:function(){}}),console.warn||(console.warn=function(){}),console.error||(console.error=function(){}),function(a){a.__namespace=!0,a.version="JayData 1.3.6",a.versionNumber="1.3.6",a.root={},a.Acorn=a.Acorn||("object"==typeof acorn?acorn:void 0),a.Esprima=a.Esprima||("object"==typeof esprima?esprima:void 0)}($data),Exception=function(a,b,c){Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name=b||"Exception",this.message=a,this.data=c},Exception.prototype.__proto__=Error.prototype,Exception.prototype._getStackTrace=function(){},Guard={},Guard.requireValue=function(a,b){("undefined"==typeof b||null===b)&&Guard.raise(a+" requires a value other than undefined or null")},Guard.requireType=function(a,b,c){var d=c instanceof Array?c:[c];return d.some(function(c){switch(typeof c){case"string":return typeof b===c;case"function":return b instanceof c;default:Guard.raise("Unknown type format : "+typeof c+" for: "+a)}})},Guard.raise=function(a){if("undefined"==typeof intellisense)throw a instanceof Exception?console.error(a.name+":",a.message+"\n",a):console.error(a),a},Object.isNullOrUndefined=function(a){return void 0===a||null===a},function(){if(Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b}),Object.create||(Object.create=function(a){function b(){}return arguments.length>1&&Guard.raise(new Error("Object.create implementation only accepts the first parameter.")),b.prototype=a,new b}),!Object.keys){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;Object.keys=function(e){("object"!=typeof e&&"function"!=typeof e||null===e)&&Guard.raise(new TypeError("Object.keys called on non-object"));var f=[];for(var g in e)a.call(e,g)&&f.push(g);if(b)for(var h=0;d>h;h++)a.call(e,c[h])&&f.push(c[h]);return f}}Object.defineProperty||(Object.defineProperty=function(a,b,c){a[b]=c.value||{}}),Object.defineProperties||(Object.defineProperties=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c].value||{})}),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;d>c;c++)b?a.call(b,this[c],c,this):a(this[c],c,this)}),Array.prototype.filter||(Array.prototype.filter=function(a,b){for(var c=[],d=0,e=this.length;e>d;d++){var f=b?a.call(b,this[d],d,this):a(this[d],d,this);f===!0&&c.push(this[d])}return c}),Array.prototype.map||(Array.prototype.map=function(a,b){for(var c=[],d=0,e=this.length;e>d;d++){var f=b?a.call(b,this[d],d,this):a(this[d],d,this);c.push(f)}return c}),Array.prototype.some||(Array.prototype.some=function(a,b){for(var c=0,d=this.length;d>c;c++){var e=b?a.call(b,this[c],c,this):a(this[c],c,this);if(e)return!0}return!1}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1}),String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")}),String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/,"")}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),"undefined"==typeof Uint8Array&&(Uint8Array=function(a){if(a instanceof Uint8Array)return a;var b=this,c=Array.isArray(a)?a:new Array(a);this.length=c.length,this.byteLength=this.length,this.byteOffset=0,this.buffer={byteLength:b.length};for(var d=function(a){return c[a]},e=function(a,b){c[a]=255&(0|b)},f=function(a){c[a]=c[a]||0,Object.defineProperty(b,a,{enumerable:!0,configurable:!1,get:function(){if(isNaN(+a)||0>(0|a)||(0|a)>=b.length)try{return"undefined"!=typeof document&&document.createTextNode("").splitText(1),new RangeError("INDEX_SIZE_ERR")}catch(c){return c}return d(a)},set:function(c){if(isNaN(+a)||0>(0|a)||(0|a)>=b.length)try{return"undefined"!=typeof document&&document.createTextNode("").splitText(1),new RangeError("INDEX_SIZE_ERR")}catch(d){return d}e(0|a,c)}})},g=0;g<b.length;g++)f(g)})}(),function(a,b){function c(b,c){if(this.kind=f.property,Object.defineProperty(this,"definedBy",{value:c,enumerable:!1,configurable:!1,writable:!1}),b){if("function"==typeof b||"function"==typeof b.asFunction)this.method=b,this.kind=f.method;else if(this.enumerable=!0,this.configurable=!0,"number"==typeof b)this.value=b,this.type=a.Number,this.dataType=a.Number;else if("string"==typeof b)this.value=b,this.dataType=a.String,this.type=a.String;else for(var d in b)b.hasOwnProperty(d)&&(this[d]=b[d]);void 0!==this.type?this.dataType=this.dataType||this.type:this.type=this.dataType,this.originalType=this.type,void 0!==this.elementType&&(this.originalElementType=this.elementType)}}function d(){}function e(){this.classNames={}}function f(){}function g(b){function c(a,b){k[a]=k[a]||[],k[a].push(b)}var d=b;d&&d.addChildContainer(this);var e={},f=[],g=[];this.classNames=e,this.consolidatedClassNames=f,this.classTypes=g;var h=[];this.mappedTo=h;var i=this;this.holder=null;var j=function(a,b){var c=i.resolveType(a),d=Object.create(c.prototype);return c.apply(d,b),d},k={};this.pendingResolutions=k,this.addChildContainer=function(){},this.createInstance=function(a,b){return j(a,b)},this.mapType=function(a,b){Guard.requireValue("aliasType",a),Guard.requireValue("realType",b);var c=this.getType(a),d=this.getType(b),e=g.indexOf(c),f=g.indexOf(d);h[e]=f},this.isPrimitiveType=function(b){var c=this.resolveType(b);switch(!0){case c===Number:case c===String:case c===Date:case c===Boolean:case c===Array:case c===Object:case c===a.Number:case c===a.Integer:case c===a.Date:case c===a.String:case c===a.Boolean:case c===a.Array:case c===a.Object:case c===a.Guid:case c===a.Byte:case c===a.SByte:case c===a.Decimal:case c===a.Float:case c===a.Int16:case c===a.Int32:case c===a.Int64:case c===a.DateTimeOffset:case c===a.Time:case c===a.SimpleBase:case c===a.Geospatial:case c===a.GeographyBase:case c===a.GeographyPoint:case c===a.GeographyLineString:case c===a.GeographyPolygon:case c===a.GeographyMultiPoint:case c===a.GeographyMultiLineString:case c===a.GeographyMultiPolygon:case c===a.GeographyCollection:case c===a.GeometryBase:case c===a.GeometryPoint:case c===a.GeometryLineString:case c===a.GeometryPolygon:case c===a.GeometryMultiPoint:case c===a.GeometryMultiLineString:case c===a.GeometryMultiPolygon:case c===a.GeometryCollection:return!0;default:return!1}},this.resolveName=function(a){var b=this.resolveType(a),c=g.indexOf(b);return f[c]},this.resolveType=function(a,b){var c=a;c=this.getType(c,b?!0:!1,b);var d=g.indexOf(c);return"undefined"==typeof h[d]?c:g[h[d]]},this.getType=function(a,b,f){if(Guard.requireValue("typeOrName",a),"function"==typeof a)return a;if(!(a in e)){if(d){var h=d.getType(a,!0);if(h)return h}if(f)return void c(a,f);if(b)return void 0;Guard.raise(new Exception("Unable to resolve type:"+a))}var i=g[e[a]];return f&&f(i),i},this.getName=function(a){var b=this.getType(a),c=g.indexOf(b);return-1==c&&Guard.raise("unknown type to request name for: "+a),f[c]},this.getTypes=function(){for(var a=Object.keys(e),b=[],c=0;c<a.length;c++){var d=a[c];b.push({name:d,type:g[e[d]],toString:function(){return this.name}})}return b},this.getTypeName=function(b){switch(typeof b){case"object":if(null==b)return"$data.Object";if(b instanceof Array)return"$data.Array";if(b.getType)return b.getType().fullName;if(b instanceof Date)return"$data.Date";if(b instanceof a.Guid)return"$data.Guid";if(b instanceof a.DateTimeOffset)return"$data.DateTimeOffset";if(b instanceof a.GeographyPoint)return"$data.GeographyPoint";if(b instanceof a.GeographyLineString)return"$data.GeographyLineString";if(b instanceof a.GeographyPolygon)return"$data.GeographyPolygon";if(b instanceof a.GeographyMultiPoint)return"$data.GeographyMultiPoint";if(b instanceof a.GeographyMultiLineString)return"$data.GeographyMultiLineString";if(b instanceof a.GeographyMultiPolygon)return"$data.GeographyMultiPolygon";if(b instanceof a.GeographyCollection)return"$data.GeographyCollection";if(b instanceof a.GeographyBase)return"$data.GeographyBase";if(b instanceof a.GeometryPoint)return"$data.GeometryPoint";if(b instanceof a.GeometryLineString)return"$data.GeometryLineString";if(b instanceof a.GeometryPolygon)return"$data.GeometryPolygon";if(b instanceof a.GeometryMultiPoint)return"$data.GeometryMultiPoint";if(b instanceof a.GeometryMultiLineString)return"$data.GeometryMultiLineString";if(b instanceof a.GeometryMultiPolygon)return"$data.GeometryMultiPolygon";if(b instanceof a.GeometryCollection)return"$data.GeometryCollection";if(b instanceof a.GeometryBase)return"$data.GeometryBase";if(b instanceof a.Geospatial)return"$data.Geospatial";if(b instanceof a.SimpleBase)return"$data.SimpleBase";if("function"==typeof b.toHexString)return"$data.ObjectID";default:return typeof b}},this.isTypeRegistered=function(a){return"function"==typeof a?g.indexOf(a)>-1:a in e},this.unregisterType=function(){Guard.raise("Unimplemented")},this.getDefault=function(b){var c=this.resolveType(b);switch(c){case a.Number:return 0;case a.Float:return 0;case a.Decimal:return"0.0";case a.Integer:return 0;case a.Int16:return 0;case a.Int32:return 0;case a.Int64:return"0";case a.Byte:return 0;case a.SByte:return 0;case a.String:return null;case a.Boolean:return!1;default:return null}},this.getIndex=function(a){var b=this.resolveType(a);return g.indexOf(b)},this.resolveByIndex=function(a){return g[a]},this.registerType=function(a,b,c){if(a){"string"==typeof b&&(b=i.resolveType(b));var h=[];if("string"==typeof a){var l=[];l.push(a),h=l}else h=a;for(var m=0;m<h.length;m++){var n=h[m].split("."),o={};o.shortName=n[n.length-1],o.fullName=h[m],h[m]=o}var p=function(){return j(b,arguments)};"undefined"!=typeof intellisense&&intellisense.annotate(p,b);for(var m=0,q=h.length;q>m;m++){var o=h[m];"create"+o.shortName in i||(i["create"+o.shortName]="function"==typeof c?c:p);var r=g.indexOf(b);if(-1==r){r=g.push(b)-1;{o.fullName}f[r]=o.fullName}e[o.fullName]=r;var s=k[o.fullName]||[];s.length>0&&(s.forEach(function(a){a(b)}),k[o.fullName]=[])}d&&d.registerType.apply(d,arguments),b.name||(b.name=h[0].shortName)}};var l={from:{},to:{}};this.converters=l,this.convertTo=function(b,c,d,e){if(Guard.requireValue("typeOrName",c),Object.isNullOrUndefined(b))return b;var f,g=Container.getTypeName(b),h=Container.resolveType(g),g=Container.resolveName(h),i=Container.resolveType(c),j=Container.resolveName(i);try{if("function"==typeof i["from"+g])f=i["from"+g].apply(i,arguments);else if("function"==typeof h["to"+j])f=h["to"+j].apply(h,arguments);else if(l.to[j]&&l.to[j][g])f=l.to[j][g].apply(l,arguments);else if(l.from[g]&&l.from[g][j])f=l.from[g][j].apply(l,arguments);else if(j===g||b instanceof i)f=b;else{if(!l.to[j]||!l.to[j]["default"])throw"converter not found";f=l.to[j]["default"].apply(l,arguments)}}catch(k){Guard.raise(new Exception("Value '"+g+"' not convertable to '"+j+"'","TypeError",b))}if(i===a.Array&&d&&Array.isArray(f))for(var m=0;m<f.length;m++)f[m]=this.convertTo.call(this,f[m],d,void 0,e);return f},this.registerConverter=function(b,c,d,e){var f=Container.resolveName(b);if(Container.isTypeRegistered(c)){l.to[f]=l.to[f]||{},l.from[f]=l.from[f]||{};var g=Container.resolveName(c);d&&(l.to[f][g]=d),e&&(l.from[f][g]=e)}else l.to[f]=l.to[f]?a.typeSystem.extend(l.to[f],c):c,l.from[f]=l.from[f]?a.typeSystem.extend(l.from[f],d):d}}c.prototype.createPropertyDescriptor=function(a,b){var c=this,d={enumerable:void 0==this.enumerable?!0:this.enumerable,configurable:void 0==this.configurable?!0:this.configurable};return this.set&&this.get?(d.set=this.set,d.get=this.get):"value"in this||b?(d.value=b||this.value,d.writable=!0):(d.set=function(a){this.storeProperty(c,a)},d.get=function(){return this.retrieveProperty(c)}),d},c.prototype.createStorePropertyDescriptor=function(a){var b=this;return{enumerable:!1,writable:!0,configurable:b.configurable,value:a}},c.prototype.createGetMethod=function(){var a=this;return{enumerable:!1,writable:!1,configurable:!1,value:function(b,c){return this.getProperty(a,b,c)}}},c.prototype.createSetMethod=function(){var a=this;return{enumerable:!1,writable:!1,configurable:!1,value:function(b,c,d){return this.setProperty(a,b,c,d)}}},c.translateDefinition=function(b,d,e){function f(b){b&&b.isAssignableTo&&a.Entity&&b.isAssignableTo(a.Entity)&&e.childResolverThunks.push(function(){b.resolveForwardDeclarations&&b.resolveForwardDeclarations()})}var g,h=e;b.type&&Container.isTypeRegistered(b.type)&&(h=Container.resolveType(b.type),"function"==typeof h.translateDefinition?(g=h.translateDefinition.apply(h,arguments),g.name=g.name||d):h=e),g instanceof c||(g=new c(g||b,h),g.name=d),e.resolverThunks=e.resolverThunks||[],e.childResolverThunks=e.childResolverThunks||[];var i=g.type,j=g.elementType;return f(i),f(j),"string"==typeof i&&("@"===i[0]?(g.type=i.substr(1),g.dataType=i.substr(1)):e.resolverThunks.push(function(){var a=e.container.resolveType(i);f(a),g.type=a,g.dataType=a})),j&&"string"==typeof j&&("@"===j[0]?g.elementType=j.substr(1):e.resolverThunks.push(function(){var a=e.container.resolveType(j);f(a),g.elementType=a})),e.resolveForwardDeclarations=function(){e.resolveForwardDeclarations=function(){},a.Trace.log("resolving: "+e.fullName),this.resolverThunks.forEach(function(a){a()}),this.childResolverThunks.forEach(function(a){a()})},g},c.prototype.toJSON=function(){var a={};for(var b in this)if("defineBy"!==b&&"storageModel"!==b)if("type"!==b&&"dataType"!==b||!this[b]||"function"!=typeof this[b])a[b]=this[b];else try{a[b]=Container.resolveName(this[b])}catch(c){a[b]=this[b]}return a},a.MemberDefinition=window.MemberDefinition=c;var h="$";d.prototype={clearCache:function(){this.arrayCache=void 0,this.pubMapPropsCache=void 0,this.keyPropsCache=void 0,this.propByTypeCache=void 0,this.pubMapMethodsCache=void 0,this.pubMapPropNamesCache=void 0},asArray:function(){if(!this.arrayCache){this.arrayCache=[];for(var a in this)0===a.indexOf(h)&&this.arrayCache.push(this[a])}return this.arrayCache},getPublicMappedProperties:function(){if(!this.pubMapPropsCache){this.pubMapPropsCache=[];for(var a in this)0===a.indexOf(h)&&"property"==this[a].kind&&!this[a].notMapped&&this[a].enumerable&&this.pubMapPropsCache.push(this[a])}return this.pubMapPropsCache},getPublicMappedPropertyNames:function(){if(!this.pubMapPropNamesCache){this.pubMapPropNamesCache=[];for(var a in this)0===a.indexOf(h)&&"property"==this[a].kind&&!this[a].notMapped&&this[a].enumerable&&this.pubMapPropNamesCache.push(this[a].name)}return this.pubMapPropNamesCache},getKeyProperties:function(){if(!this.keyPropsCache){this.keyPropsCache=[];for(var a in this)0===a.indexOf(h)&&"property"==this[a].kind&&this[a].key&&this.keyPropsCache.push(this[a])}return this.keyPropsCache},getPublicMappedMethods:function(){if(!this.pubMapMethodsCache){this.pubMapMethodsCache=[];for(var a in this)0===a.indexOf(h)&&"method"==this[a].kind&&this[a].method&&this.pubMapMethodsCache.push(this[a])}return this.pubMapMethodsCache},getPropertyByType:function(a){if(!this.propByTypeCache){this.propByTypeCache=[];for(var b in this)0===b.indexOf(h)&&this[b].dataType==a&&this.propByTypeCache.push(this[b])}return this.propByTypeCache},getMember:function(a){return this[h+a]},setMember:function(a){this[h+a.name]=a}},d.prototype.constructor=d,a.MemberDefinitionCollection=window.MemberDefinitionCollection=d,f.__enum=!0,f.method="method",f.property="property",f.navProperty="navProperty",f.complexProperty="complexProperty",f.field="field",a.MemberTypes=f,e.prototype={define:function(a,b,c,d,e){return this.defineEx(a,[{type:b}],c,d,e)},defineEx:function(b,c,d,e,f){d=d||a.Container,0==c.length?c.push({type:a.Base}):c.length>0&&!c[0].type&&(c[0].type=a.Base);for(var g=0,h=c.length;h>g;g++)"function"==typeof c[g]&&(c[g]={type:c[g]});for(var i=(e?e.constructor:void 0,b.split(".")),j=i.splice(i.length-1,1)[0],k=d===a.Container?window:d,g=0;g<i.length;g++){var l=i[g];if(!k[l]){var m={};m.__namespace=!0,k[l]=m}k=k[l]}var n=null;n=this.classFunctionBuilder(j,c,f,e),n.fullName=b,n.namespace=i.join("."),n.name=j,n.container=d,n.container.registerType(b,n),this.buildType(n,c,e,f),"undefined"!=typeof intellisense&&e&&e.constructor&&intellisense.annotate(n,e.constructor),k[j]=this.classNames[b]=n;for(var o=n.baseTypes.length,g=0;o>g;g++){var p=n.baseTypes[g];"inheritedTypeProcessor"in p&&p.inheritedTypeProcessor(n)}return n},classFunctionBuilder:function(a,b,c,d){var e=this.bodyBuilder(b,c,d);return new Function("base","classDefinition","instanceDefinition","name","return function "+a+" (){ "+e+" \n}; ")(b,c,d,a)},bodyBuilder:function(b,c,d){for(var e="",f="",g="",h=0,i=b.length;i>h;h++){var j=b[h],k=h;0==k?j&&j.type&&j.type!==a.Base&&j.type.fullName&&(f+="    var baseArguments = $data.typeSystem.createCtorParams(arguments, base["+k+"].params, this); \n",f+="    "+j.type.fullName+".apply(this, baseArguments); \n"):j&&j.type&&j.propagateTo?(g+="    "+(g?"":"var ")+"propagationArguments = $data.typeSystem.createCtorParams(arguments, base["+k+"].params, this); \n",g+='    this["'+j.propagateTo+'"] =  Object.create('+j.type.fullName+".prototype); \n    "+j.type.fullName+'.apply(this["'+j.propagateTo+'"], propagationArguments); \n'):j&&j.type&&j.type.memberDefinitions&&j.type.memberDefinitions.$constructor&&!j.propagateTo&&(e+="    "+j.type.fullName+".memberDefinitions.$constructor.method.apply(this); \n")}return d&&d.constructor!=Object&&(f+="    instanceDefinition.constructor.apply(this, arguments); \n"),"\n    //mixins \n"+e+"\n    //construction \n"+f+"\n    //propagations \n"+g},buildType:function(a,b,c,e){var f=b[0].type;if(a.inheritsFrom=f,f){a.prototype=Object.create(f.prototype),a.memberDefinitions=Object.create(f.memberDefinitions||new d),a.memberDefinitions.clearCache();var g=f.staticDefinitions;if(g&&(g=g.asArray()))for(var h=0;h<g.length;h++)this.buildMember(a,g[h],void 0,"staticDefinitions");a.baseTypes=f.baseTypes?[].concat(f.baseTypes):[];for(var h=0;h<b.length;h++)a.baseTypes.push(b[h].type);a.isAssignableTo||Object.defineProperty(a,"isAssignableTo",{value:function(a){return this===a||this.baseTypes.indexOf(a)>=0},writable:!1,enumerable:!1,configurable:!1})}e&&(this.buildStaticMembers(a,e),e.constructor&&(a.classConstructor=e.constructor)),c&&this.buildInstanceMembers(a,c);var i=[].concat(b);i.shift(),Object.keys(i).length>0&&this.buildInstanceMixins(a,i),a.__class=!0,a.prototype.constructor=a,Object.defineProperty(a.prototype,"getType",{value:function(){return a},writable:!1,enumerable:!1,configurable:!1})},addMethod:function(a,b,c,d){a[b]=d&&"undefined"==typeof intellisense?function(){return c.apply(this[d],arguments)}:c},addProperty:function(a,b,c,d){if(d){if(c.configurable=!0,c.get){var e=c.get;c.get=function(){return this[d]||Guard.raise(new Exception("not inicialized")),e.apply(this[d],arguments)}}if(c.set){var f=c.set;c.set=function(){this[d]||Guard.raise(new Exception("not inicialized")),f.apply(this[d],arguments)}}}Object.defineProperty(a,b,c)},addField:function(){Guard.raise("not implemented")},buildMethod:function(a,b,c){var d=b.classMember?a:a.prototype;this.addMethod(d,b.name,b.method,c)},buildProperty:function(a,b,c){var d=b.classMember?a:a.prototype,e=b.createPropertyDescriptor(a);if(this.addProperty(d,b.name,e,c),!b.classMember&&1==a.__setPropertyfunctions&&b.withoutGetSetMethod!==!0&&!("get_"+b.name in d||"set_"+b.name in d)){var f=b.createGetMethod();this.addProperty(d,"get_"+b.name,f,c);var g=b.createSetMethod();this.addProperty(d,"set_"+b.name,g,c)}},buildMember:function(a,b,c,e){switch(e=e||"memberDefinitions",a[e]=a[e]||new d,a[e].setMember(b),b.kind){case f.method:this.buildMethod(a,b,c);break;case f.navProperty:case f.complexProperty:case f.property:this.buildProperty(a,b,c);break;default:Guard.raise("Unknown member type: "+b.kind+","+b.name)}},buildStaticMembers:function(a,b){var d=this;for(var e in b)if(b.hasOwnProperty(e)){var f=c.translateDefinition(b[e],e,a);f.classMember=!0,d.buildMember(a,f,void 0,"staticDefinitions")}},buildInstanceMembers:function(a,b){var d=this;for(var e in b)if(b.hasOwnProperty(e)){var f=c.translateDefinition(b[e],e,a);d.buildMember(a,f,void 0,"memberDefinitions")}},copyMembers:function(a,b){function c(a){"undefined"!=typeof intellisense&&intellisense.logMessage(a)}Object.keys(a.prototype).forEach(function(d){"constructor"!==d&&"toString"!==d&&(c("copying item:"+d),b.prototype[d]=a[d])})},buildInstanceMixins:function(a,b){a.mixins=a.mixins||[],a.propagations=a.propagations||[];for(var c=0;c<b.length;c++){var d=b[c];d.propagateTo?(this.buildInstancePropagation(a,d),a.propagations.push(d),a.propagations[d.type.name]=!0):(this.buildInstanceMixin(a,d),a.mixins.push(d),a.mixins[d.type.name]=!0)}},buildInstanceMixin:function(a,b){for(var c=b.type.memberDefinitions.asArray(),d=0,e=c.length;e>d;d++){var f=c[d].name;"constructor"===f||a.memberDefinitions.getMember(f)||this.buildMember(a,c[d])}if(b.type.staticDefinitions)for(var g=b.type.staticDefinitions.asArray(),d=0,e=g.length;e>d;d++){var f=g[d].name;"constructor"===f||a.memberDefinitions.getMember(f)||this.buildMember(a,g[d],void 0,"staticDefinitions")}},buildInstancePropagation:function(a,b){for(var c=b.type.memberDefinitions.asArray(),d=0,e=c.length;e>d;d++){var f=c[d].name;"constructor"===f||a.memberDefinitions.getMember(f)||this.buildMember(a,c[d],b.propagateTo)}}},a.Class=Class=new e,b=window,a.ContainerClass=g;var i;b.Container=a.Container=i=b.C$=new g,a.createContainer=function(){return new g(a.Container)},b.$C=function(){Class.define.apply(Class,arguments)};var j=function(a,b){var c="_"+a.name;this[c]?this[c]=b:Object.defineProperty(this,c,a.createStorePropertyDescriptor(b))},k=function(a){var b="_"+a.name;return this[b]};a.Class.define("$data.Base",function(){},null,{storeProperty:j,retrieveProperty:k,setProperty:function(a,b,c){this[a.name]=b,c()},getProperty:function(a,b){b.apply(this,[this[a.name]])}},{create:function(){return Container.createInstance(this,arguments)},extend:function(b,c,d,e){return!c||c instanceof g||(e=d,d=c,c=void 0),a.Class.define(b,this,c,d,e)},getMemberDefinition:function(a){return this.memberDefinitions.getMember(a)},addProperty:function(b,d,e,f){var g,h=d,i=e;"string"==typeof h&&(g=d,h=e,i=f);var j={notMapped:!0,storeOnObject:!0,get:"function"==typeof h?h:function(){},set:"function"==typeof i?i:function(){},type:g},k=c.translateDefinition(j,b,this);return a.Class.buildMember(this,k),this.memberDefinitions.clearCache(),this},addMember:function(b,d,e){var f=c.translateDefinition(d,b,this);return e?(f.classMember=!0,a.Class.buildMember(this,f,void 0,"staticDefinitions"),this.staticDefinitions.clearCache()):(a.Class.buildMember(this,f),this.memberDefinitions.clearCache()),this},describeField:function(a,b){var c=this.memberDefinitions.getMember(a);return c?Guard.raise(new Exception("Field '"+a+"' already defined!","Invalid operation")):this.addMember(a,b),this},storeProperty:j,retrieveProperty:k,"from$data.Object":function(a){return a}}),a.Class.ConstructorParameter=ConstructorParameter=a.Class.define("ConstructorParameter",null,null,{constructor:function(a){this.paramIndex=a},paramIndex:{}})}($data,window),$data.defaultErrorCallback=function(){arguments.length>0&&arguments[arguments.length-1]&&"function"==typeof arguments[arguments.length-1].reject?((console.error||console.log).call(console,arguments[0]),arguments[arguments.length-1].reject.apply(arguments[arguments.length-1],arguments)):Guard.raise(arguments[0]instanceof Error?arguments[0]:new Exception("DEFAULT ERROR CALLBACK!","DefaultError",arguments))},$data.defaultSuccessCallback=function(){},$data.defaultNotifyCallback=function(){},$data.typeSystem={__namespace:!0,extend:function(a){"object"!=typeof a&&"function"!=typeof a&&Guard.raise("Target must be object or function");for(var b=1;b<arguments.length;b++){var c=arguments[b];if(null!==c&&"undefined"!=typeof c)for(key in c)a[key]=c[key]}return a},createCallbackSetting:function(a,b){function c(a){function b(){a.apply(c,arguments),a=function(){}}var c=this;return b}var d={success:$data.defaultSuccessCallback,error:$data.defaultErrorCallback,notify:$data.defaultNotifyCallback};void 0!=b&&null!=b&&(d=b);var e;return e=null==a||void 0==a?d:"function"==typeof a?this.extend(d,{success:a}):this.extend(d,a),"function"==typeof e.error&&(e.error=c(e.error)),e},createCtorParams:function(a,b,c){if(b){for(var d=[],e=0,f=b.length;f>e;e++){var g=e;d.push(b[g]instanceof ConstructorParameter?a[b[g].paramIndex]:"function"==typeof b[g]?b[g].apply(c):b[g])}return d}return a},writePropertyValues:function(a){a&&a.getType&&a.getType().memberDefinitions&&this.writeProperties(a,a.getType().memberDefinitions.asArray().filter(function(a){return("property"==a.kind||"navProperty"==a.kind||"complexProperty"==a.kind)&&!a.prototypeProperty}))},writeProperties:function(a,b){for(var c={},d=0,e=b.length;e>d;d++){var f=b[d];c[f.name]=f.createPropertyDescriptor(null,f.value)}Object.defineProperties(a,c)},writeProperty:function(a,b,c){var d="string"==typeof b?a.getType().memberDefinitions.getMember(b):b;if(d){var e=d.createPropertyDescriptor(null,c);Object.defineProperty(a,d.name,e)}}},$data.debug=function(){(console.debug||console.log).apply(console,arguments)},$data.debugWith=function(){var a=arguments;return function(b){(console.debug||console.log).apply(console,a),"undefined"!=typeof Error&&b instanceof Error||"undefined"!=typeof Exception&&b instanceof Exception?(console.error||console.log).apply(console,arguments):(console.debug||console.log).apply(console,arguments)}},$data.fdebug={success:$data.debugWith("success"),error:$data.debugWith("error")},$data.Number="undefined"!=typeof Number?Number:function(){},$data.Date="undefined"!=typeof Date?Date:function(){},$data.String="undefined"!=typeof String?String:function(){},$data.Boolean="undefined"!=typeof Boolean?Boolean:function(){},$data.Array="undefined"!=typeof Array?Array:function(){},$data.Object="undefined"!=typeof Object?Object:function(){},$data.Function=Function,$data.Byte=function(){},$data.SByte=function(){},$data.Decimal=function(){},$data.Float=$data.Single=function(){},$data.Integer=function(){},$data.Int16=function(){},$data.Int32=function(){},$data.Int64=function(){},$data.ObjectID="undefined"!=typeof $data.mongoDBDriver&&"undefined"!=typeof $data.mongoDBDriver.ObjectID?$data.mongoDBDriver.ObjectID:function(){},$data.Time=function(){},$data.DateTimeOffset=function(a){this.value=a},$data.DateTimeOffset.prototype.toJSON=function(){return this.value instanceof Date?this.value.toISOString():this.value},$data.Container.registerType(["$data.Number","number","JayNumber","double"],$data.Number),$data.Container.registerType(["$data.Integer","int","integer","JayInteger"],$data.Integer),$data.Container.registerType(["$data.Int32","int32","JayInt32"],$data.Int32),$data.Container.registerType(["$data.Byte","byte","JayByte"],$data.Byte),$data.Container.registerType(["$data.SByte","sbyte","JaySByte"],$data.SByte),$data.Container.registerType(["$data.Decimal","decimal","JayDecimal"],$data.Decimal),$data.Container.registerType(["$data.Float","$data.Single","float","single","JayFloat"],$data.Float),$data.Container.registerType(["$data.Int16","int16","word","JayInt16"],$data.Int16),$data.Container.registerType(["$data.Int64","int64","long","JayInt64"],$data.Int64),$data.Container.registerType(["$data.String","string","text","character","JayString"],$data.String),$data.Container.registerType(["$data.Array","array","Array","[]","JayArray"],$data.Array,function(){return $data.Array.apply(void 0,arguments)}),$data.Container.registerType(["$data.Date","datetime","date","JayDate"],$data.Date),$data.Container.registerType(["$data.Time","time","JayTime"],$data.Time),$data.Container.registerType(["$data.DateTimeOffset","offset","datetimeoffset","JayDateTimeOffset"],$data.DateTimeOffset),$data.Container.registerType(["$data.Boolean","bool","boolean","JayBoolean"],$data.Boolean),$data.Container.registerType(["$data.Object","Object","object","{}","JayObject"],$data.Object),$data.Container.registerType(["$data.Function","Function","function"],$data.Function),$data.Container.registerType(["$data.ObjectID","ObjectID","objectId","objectid","ID","Id","id","JayObjectID"],$data.ObjectID),$data.Class.define("$data.TraceBase",null,null,{log:function(){},warn:function(){},error:function(){}}),$data.Trace=new $data.TraceBase,$data.Class.define("$data.Logger",$data.TraceBase,null,{log:function(){Array.prototype.unshift.call(arguments,this.getDateFormat()),console.log.apply(console,arguments)},warn:function(){Array.prototype.unshift.call(arguments,this.getDateFormat()),console.warn.apply(console,arguments)},error:function(){Array.prototype.unshift.call(arguments,this.getDateFormat()),console.error.apply(console,arguments)},getDateFormat:function(){var a=new Date;return a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+"."+a.getMilliseconds()
}}),$data.Number="undefined"!=typeof Number?Number:function(){},$data.Date="undefined"!=typeof Date?Date:function(){},$data.String="undefined"!=typeof String?String:function(){},$data.Boolean="undefined"!=typeof Boolean?Boolean:function(){},$data.Array="undefined"!=typeof Array?Array:function(){},$data.Object="undefined"!=typeof Object?Object:function(){},$data.Function=Function,$data.Byte=function(){},$data.SByte=function(){},$data.Decimal=function(){},$data.Float=$data.Single=function(){},$data.Integer=function(){},$data.Int16=function(){},$data.Int32=function(){},$data.Int64=function(){},$data.ObjectID="undefined"!=typeof $data.mongoDBDriver&&"undefined"!=typeof $data.mongoDBDriver.ObjectID?$data.mongoDBDriver.ObjectID:function(){},$data.Time=function(){},$data.DateTimeOffset=function(a){this.value=a},$data.DateTimeOffset.prototype.toJSON=function(){return this.value instanceof Date?this.value.toISOString():this.value},$data.Container.registerType(["$data.Number","number","JayNumber","double"],$data.Number),$data.Container.registerType(["$data.Integer","int","integer","JayInteger"],$data.Integer),$data.Container.registerType(["$data.Int32","int32","JayInt32"],$data.Int32),$data.Container.registerType(["$data.Byte","byte","JayByte"],$data.Byte),$data.Container.registerType(["$data.SByte","sbyte","JaySByte"],$data.SByte),$data.Container.registerType(["$data.Decimal","decimal","JayDecimal"],$data.Decimal),$data.Container.registerType(["$data.Float","$data.Single","float","single","JayFloat"],$data.Float),$data.Container.registerType(["$data.Int16","int16","word","JayInt16"],$data.Int16),$data.Container.registerType(["$data.Int64","int64","long","JayInt64"],$data.Int64),$data.Container.registerType(["$data.String","string","text","character","JayString"],$data.String),$data.Container.registerType(["$data.Array","array","Array","[]","JayArray"],$data.Array,function(){return $data.Array.apply(void 0,arguments)}),$data.Container.registerType(["$data.Date","datetime","date","JayDate"],$data.Date),$data.Container.registerType(["$data.Time","time","JayTime"],$data.Time),$data.Container.registerType(["$data.DateTimeOffset","offset","datetimeoffset","JayDateTimeOffset"],$data.DateTimeOffset),$data.Container.registerType(["$data.Boolean","bool","boolean","JayBoolean"],$data.Boolean),$data.Container.registerType(["$data.Object","Object","object","{}","JayObject"],$data.Object),$data.Container.registerType(["$data.Function","Function","function"],$data.Function),$data.Container.registerType(["$data.ObjectID","ObjectID","objectId","objectid","ID","Id","id","JayObjectID"],$data.ObjectID),$data.SimpleBase=function(a){if("object"==typeof a&&a)if(Array.isArray(this.constructor.validMembers))for(var b=0;b<this.constructor.validMembers.length;b++){var c=this.constructor.validMembers[b];void 0!==a[c]&&(this[c]=a[c])}else delete a.type,$data.typeSystem.extend(this,a)},$data.SimpleBase.registerType=function(a,b,c){c=c||$data.SimpleBase,b.type=a,b.prototype=Object.create(c.prototype),b.prototype.constructor=b},$data.Container.registerType(["$data.SimpleBase","SimpleBase"],$data.SimpleBase),$data.Geospatial=function(){if(this.type=this.constructor.type,Array.isArray(this.constructor.validMembers))for(var a=0;a<this.constructor.validMembers.length;a++){var b=this.constructor.validMembers[a];this[b]=void 0}$data.SimpleBase.apply(this,arguments),this.type=this.constructor.type||"Unknown"},$data.SimpleBase.registerType("Geospatial",$data.Geospatial),$data.Container.registerType(["$data.Geospatial","Geospatial"],$data.Geospatial),$data.point=function(a){if(a&&a.crs)return a.crs.properties&&a.crs.properties.name===$data.GeometryBase.defaultCrs.properties.name?new $data.GeometryPoint(a):new $data.GeographyPoint(a);if(a){if("x"in a&&"y"in a)return new $data.GeometryPoint(a.x,a.y);if("longitude"in a&&"latitude"in a)return new $data.GeographyPoint(a.longitude,a.latitude);if("lng"in a&&"lat"in a)return new $data.GeographyPoint(a.lng,a.lat)}},$data.GeographyBase=function(){$data.Geospatial.apply(this,arguments),this.crs=$data.GeographyBase.defaultCrs,$data.GeographyBase.validateGeoJSON(this)},$data.GeographyBase.defaultCrs={properties:{name:"EPSG:4326"},type:"name"},$data.GeographyBase.parseFromString=function(a){var b=a.indexOf("(");if(b>=0){var c=a.substring(0,b).toLowerCase(),d=$data.GeographyBase.registered[c];if(d&&d.parseFromString&&d!=$data.GeographyBase)return d.parseFromString(a);Guard.raise(new Exception("parseFromString","Not Implemented",a))}},$data.GeographyBase.stringifyToUrl=function(a){function b(a){if(Array.isArray(a[0]))for(var d=0;d<a.length;d++)d>0&&(c+=","),Array.isArray(a[d][0])&&(c+="("),b(a[d]),Array.isArray(a[d][0])&&(c+=")");else c+=a.join(" ")}if(a instanceof $data.GeographyBase&&a.constructor&&a.constructor.stringifyToUrl)return a.constructor.stringifyToUrl(a);if(a instanceof $data.GeographyBase&&a.constructor&&Array.isArray(a.constructor.validMembers)&&"coordinates"===a.constructor.validMembers[0]){var c="geography'"+a.type.toUpperCase()+"(";return b(a.coordinates,c),c+=")'"}Guard.raise(new Exception("stringifyToUrl on instance type","Not Implemented",a))},$data.GeographyBase.registerType=function(a,b,c){$data.SimpleBase.registerType(a,b,c||$data.GeographyBase),$data.GeographyBase.registered=$data.GeographyBase.registered||{},$data.GeographyBase.registered[a.toLowerCase()]=b},$data.GeographyBase.validateGeoJSON=function(a){var b=a.type;if(b){var c=$data.GeographyBase.registered[b.toLowerCase()];if("function"==typeof c.validateGeoJSON){var d=c.validateGeoJSON(a);if(d)return d;Guard.raise(new Exception("Invalid '"+b+"' format!","Format Exception",a))}}console.log("GeoJSON validation missing",a)},$data.SimpleBase.registerType("GeographyBase",$data.GeographyBase,$data.Geospatial),$data.Container.registerType(["$data.GeographyBase"],$data.GeographyBase),$data.GeographyPoint=function(a,b){a&&"object"==typeof a&&Array.isArray(a)?$data.GeographyBase.call(this,{coordinates:a}):a&&"object"==typeof a&&("longitude"in a||"latitude"in a)?$data.GeographyBase.call(this,{coordinates:[a.longitude,a.latitude]}):a&&"object"==typeof a&&("lng"in a||"lat"in a)?$data.GeographyBase.call(this,{coordinates:[a.lng,a.lat]}):a&&"object"==typeof a?$data.GeographyBase.call(this,a):$data.GeographyBase.call(this,{coordinates:[a||0,b||0]})},$data.GeographyPoint.validateGeoJSON=function(a){return a&&Array.isArray(a.coordinates)&&2==a.coordinates.length&&"number"==typeof a.coordinates[0]&&"number"==typeof a.coordinates[1]},$data.GeographyPoint.parseFromString=function(a){var b=a.substring(a.indexOf("(")+1,a.lastIndexOf(")")),c=b.split(" ");return new $data.GeographyPoint(parseFloat(c[0]),parseFloat(c[1]))},$data.GeographyPoint.validMembers=["coordinates"],$data.GeographyBase.registerType("Point",$data.GeographyPoint),Object.defineProperty($data.GeographyPoint.prototype,"longitude",{get:function(){return this.coordinates[0]},set:function(a){this.coordinates[0]=a}}),Object.defineProperty($data.GeographyPoint.prototype,"latitude",{get:function(){return this.coordinates[1]},set:function(a){this.coordinates[1]=a}}),$data.Container.registerType(["$data.GeographyPoint","GeographyPoint","$data.Geography","Geography","geography","geo"],$data.GeographyPoint),$data.Geography=$data.GeographyPoint,$data.GeographyLineString=function(a){Array.isArray(a)?$data.GeographyBase.call(this,{coordinates:a}):$data.GeographyBase.call(this,a)},$data.GeographyLineString.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.coordinates),c=0;b&&c<a.coordinates.length;c++){var d=a.coordinates[c];b=b&&Array.isArray(d)&&2==d.length&&"number"==typeof d[0]&&"number"==typeof d[1]}return b},$data.GeographyLineString.validMembers=["coordinates"],$data.GeographyBase.registerType("LineString",$data.GeographyLineString),$data.Container.registerType(["$data.GeographyLineString","GeographyLineString"],$data.GeographyLineString),$data.GeographyPolygon=function(a){if("object"==typeof a&&("topLeft"in a&&"bottomRight"in a||"topRight"in a&&"bottomLeft"in a)){var b,c,d,e;"topLeft"in a&&"bottomRight"in a?(b=a.topLeft instanceof $data.GeographyPoint?a.topLeft:new $data.GeographyPoint(a.topLeft),e=a.bottomRight instanceof $data.GeographyPoint?a.bottomRight:new $data.GeographyPoint(a.bottomRight),c=new $data.GeographyPoint([e.coordinates[0],b.coordinates[1]]),d=new $data.GeographyPoint([b.coordinates[0],e.coordinates[1]])):(c=a.topRight instanceof $data.GeographyPoint?a.topRight:new $data.GeographyPoint(a.topRight),d=a.bottomLeft instanceof $data.GeographyPoint?a.bottomLeft:new $data.GeographyPoint(a.bottomLeft),b=new $data.GeographyPoint([d.coordinates[0],c.coordinates[1]]),e=new $data.GeographyPoint([c.coordinates[0],d.coordinates[1]]));var f=[];f.push([].concat(b.coordinates)),f.push([].concat(c.coordinates)),f.push([].concat(e.coordinates)),f.push([].concat(d.coordinates)),f.push([].concat(b.coordinates)),$data.GeographyBase.call(this,{coordinates:[f]})}else Array.isArray(a)?$data.GeographyBase.call(this,{coordinates:a}):$data.GeographyBase.call(this,a)},$data.GeographyPolygon.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.coordinates),c=0;b&&c<a.coordinates.length;c++)for(var d=a.coordinates[c],b=b&&Array.isArray(d),e=0;b&&e<d.length;e++){var f=d[e];b=b&&Array.isArray(f)&&2==f.length&&"number"==typeof f[0]&&"number"==typeof f[1]}return b},$data.GeographyPolygon.parseFromString=function(a){for(var b=a.substring(a.indexOf("(")+1,a.lastIndexOf(")")),c=b.substring(b.indexOf("(")+1,b.lastIndexOf(")")).split("),("),b=[],d=0;d<c.length;d++){for(var e=[],f=c[d].split(","),g=0;g<f.length;g++){var h=f[g].split(" ");e.push([parseFloat(h[0]),parseFloat(h[1])])}b.push(e)}return new $data.GeographyPolygon(b)},$data.GeographyPolygon.validMembers=["coordinates"],$data.GeographyBase.registerType("Polygon",$data.GeographyPolygon),$data.Container.registerType(["$data.GeographyPolygon","GeographyPolygon"],$data.GeographyPolygon),$data.GeographyMultiPoint=function(a){Array.isArray(a)?$data.GeographyBase.call(this,{coordinates:a}):$data.GeographyBase.call(this,a)},$data.GeographyMultiPoint.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.coordinates),c=0;b&&c<a.coordinates.length;c++){var d=a.coordinates[c];b=b&&Array.isArray(d)&&2==d.length&&"number"==typeof d[0]&&"number"==typeof d[1]}return b},$data.GeographyMultiPoint.validMembers=["coordinates"],$data.GeographyBase.registerType("MultiPoint",$data.GeographyMultiPoint),$data.Container.registerType(["$data.GeographyMultiPoint","GeographyMultiPoint"],$data.GeographyMultiPoint),$data.GeographyMultiLineString=function(a){Array.isArray(a)?$data.GeographyBase.call(this,{coordinates:a}):$data.GeographyBase.call(this,a)},$data.GeographyMultiLineString.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.coordinates),c=0;b&&c<a.coordinates.length;c++)for(var d=a.coordinates[c],b=b&&Array.isArray(d),e=0;b&&e<d.length;e++){var f=d[e];b=b&&Array.isArray(f)&&2==f.length&&"number"==typeof f[0]&&"number"==typeof f[1]}return b},$data.GeographyMultiLineString.validMembers=["coordinates"],$data.GeographyBase.registerType("MultiLineString",$data.GeographyMultiLineString),$data.Container.registerType(["$data.GeographyMultiLineString","GeographyMultiLineString"],$data.GeographyMultiLineString),$data.GeographyMultiPolygon=function(a){Array.isArray(a)?$data.GeographyBase.call(this,{coordinates:a}):$data.GeographyBase.call(this,a)},$data.GeographyMultiPolygon.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.coordinates),c=0;b&&c<a.coordinates.length;c++)for(var d=a.coordinates[c],b=b&&Array.isArray(d),e=0;b&&e<d.length;e++)for(var f=d[e],b=b&&Array.isArray(f),g=0;b&&g<f.length;g++){var h=f[g];b=b&&Array.isArray(h)&&2==h.length&&"number"==typeof h[0]&&"number"==typeof h[1]}return b},$data.GeographyMultiPolygon.validMembers=["coordinates"],$data.GeographyBase.registerType("MultiPolygon",$data.GeographyMultiPolygon),$data.Container.registerType(["$data.GeographyMultiPolygon","GeographyMultiPolygon"],$data.GeographyMultiPolygon),$data.GeographyCollection=function(a){Array.isArray(a)?$data.GeographyBase.call(this,{geometries:a}):$data.GeographyBase.call(this,a)},$data.GeographyCollection.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.geometries),c=0;b&&c<a.geometries.length;c++){var d=a.geometries[c];try{b=b&&$data.GeographyBase.validateGeoJSON(d)}catch(e){b=!1}}return b},$data.GeographyCollection.validMembers=["geometries"],$data.GeographyBase.registerType("GeometryCollection",$data.GeographyCollection),$data.Container.registerType(["$data.GeographyCollection","GeographyCollection"],$data.GeographyCollection),$data.Container.registerConverter($data.GeographyPoint,$data.Object,function(a){return a?new $data.GeographyPoint(a):a}),$data.Container.registerConverter($data.GeographyLineString,$data.Object,function(a){return a?new $data.GeographyLineString(a):a}),$data.Container.registerConverter($data.GeographyPolygon,$data.Object,function(a){return a?new $data.GeographyPolygon(a):a}),$data.Container.registerConverter($data.GeographyMultiPoint,$data.Object,function(a){return a?new $data.GeographyMultiPoint(a):a}),$data.Container.registerConverter($data.GeographyMultiLineString,$data.Object,function(a){return a?new $data.GeographyMultiLineString(a):a}),$data.Container.registerConverter($data.GeographyMultiPolygon,$data.Object,function(a){return a?new $data.GeographyMultiPolygon(a):a}),$data.Container.registerConverter($data.GeographyCollection,$data.Object,function(a){return a?new $data.GeographyCollection(a):a}),$data.GeometryBase=function(){$data.Geospatial.apply(this,arguments),this.crs=$data.GeometryBase.defaultCrs,$data.GeometryBase.validateGeoJSON(this)},$data.GeometryBase.defaultCrs={properties:{name:"EPSG:0"},type:"name"},$data.GeometryBase.parseFromString=function(a){var b=a.indexOf("(");if(b>=0){var c=a.substring(0,b).toLowerCase(),d=$data.GeometryBase.registered[c];if(d&&d.parseFromString&&d!=$data.GeometryBase)return d.parseFromString(a);Guard.raise(new Exception("parseFromString","Not Implemented",a))}},$data.GeometryBase.stringifyToUrl=function(a){function b(a){if(Array.isArray(a[0]))for(var d=0;d<a.length;d++)d>0&&(c+=","),Array.isArray(a[d][0])&&(c+="("),b(a[d]),Array.isArray(a[d][0])&&(c+=")");else c+=a.join(" ")}if(a instanceof $data.GeometryBase&&a.constructor&&a.constructor.stringifyToUrl)return a.constructor.stringifyToUrl(a);if(a instanceof $data.GeometryBase&&a.constructor&&Array.isArray(a.constructor.validMembers)&&"coordinates"===a.constructor.validMembers[0]){var c="geometry'"+a.type.toUpperCase()+"(";return b(a.coordinates,c),c+=")'"}Guard.raise(new Exception("stringifyToUrl on instance type","Not Implemented",a))},$data.GeometryBase.registerType=function(a,b,c){$data.SimpleBase.registerType(a,b,c||$data.GeometryBase),$data.GeometryBase.registered=$data.GeometryBase.registered||{},$data.GeometryBase.registered[a.toLowerCase()]=b},$data.GeometryBase.validateGeoJSON=function(a){var b=a.type;if(b){var c=$data.GeometryBase.registered[b.toLowerCase()];if("function"==typeof c.validateGeoJSON){var d=c.validateGeoJSON(a);if(d)return d;Guard.raise(new Exception("Invalid '"+b+"' format!","Format Exception",a))}}console.log("GeoJSON validation missing",a)},$data.SimpleBase.registerType("GeometryBase",$data.GeometryBase,$data.Geospatial),$data.Container.registerType(["$data.GeometryBase"],$data.GeometryBase),$data.GeometryPoint=function(a,b){var c=a;c&&"object"==typeof c&&Array.isArray(c)?$data.GeometryBase.call(this,{coordinates:c}):c&&"object"==typeof c&&("x"in c||"y"in c)?$data.GeometryBase.call(this,{coordinates:[c.x,c.y]}):c&&"object"==typeof c?$data.GeometryBase.call(this,c):$data.GeometryBase.call(this,{coordinates:[a||0,b||0]})},$data.GeometryPoint.validateGeoJSON=function(a){return a&&Array.isArray(a.coordinates)&&2==a.coordinates.length&&"number"==typeof a.coordinates[0]&&"number"==typeof a.coordinates[1]},$data.GeometryPoint.parseFromString=function(a){var b=a.substring(a.indexOf("(")+1,a.lastIndexOf(")")),c=b.split(" ");return new $data.GeometryPoint(parseFloat(c[0]),parseFloat(c[1]))},$data.GeometryPoint.validMembers=["coordinates"],$data.GeometryBase.registerType("Point",$data.GeometryPoint),Object.defineProperty($data.GeometryPoint.prototype,"x",{get:function(){return this.coordinates[0]},set:function(a){this.coordinates[0]=a}}),Object.defineProperty($data.GeometryPoint.prototype,"y",{get:function(){return this.coordinates[1]},set:function(a){this.coordinates[1]=a}}),$data.Container.registerType(["$data.GeometryPoint","GeometryPoint"],$data.GeometryPoint),$data.GeometryLineString=function(a){Array.isArray(a)?$data.GeometryBase.call(this,{coordinates:a}):$data.GeometryBase.call(this,a)},$data.GeometryLineString.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.coordinates),c=0;b&&c<a.coordinates.length;c++){var d=a.coordinates[c];b=b&&Array.isArray(d)&&2==d.length&&"number"==typeof d[0]&&"number"==typeof d[1]}return b},$data.GeometryLineString.validMembers=["coordinates"],$data.GeometryBase.registerType("LineString",$data.GeometryLineString),$data.Container.registerType(["$data.GeometryLineString","GeometryLineString"],$data.GeometryLineString),$data.GeometryPolygon=function(a){if("object"==typeof a&&("topLeft"in a&&"bottomRight"in a||"topRight"in a&&"bottomLeft"in a)){var b,c,d,e;"topLeft"in a&&"bottomRight"in a?(b=a.topLeft instanceof $data.GeometryPoint?a.topLeft:new $data.GeometryPoint(a.topLeft),e=a.bottomRight instanceof $data.GeometryPoint?a.bottomRight:new $data.GeometryPoint(a.bottomRight),c=new $data.GeometryPoint([e.coordinates[0],b.coordinates[1]]),d=new $data.GeometryPoint([b.coordinates[0],e.coordinates[1]])):(c=a.topRight instanceof $data.GeometryPoint?a.topRight:new $data.GeometryPoint(a.topRight),d=a.bottomLeft instanceof $data.GeometryPoint?a.bottomLeft:new $data.GeometryPoint(a.bottomLeft),b=new $data.GeometryPoint([d.coordinates[0],c.coordinates[1]]),e=new $data.GeometryPoint([c.coordinates[0],d.coordinates[1]]));var f=[];f.push([].concat(b.coordinates)),f.push([].concat(c.coordinates)),f.push([].concat(e.coordinates)),f.push([].concat(d.coordinates)),f.push([].concat(b.coordinates)),$data.GeometryBase.call(this,{coordinates:[f]})}else Array.isArray(a)?$data.GeometryBase.call(this,{coordinates:a}):$data.GeometryBase.call(this,a)},$data.GeometryPolygon.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.coordinates),c=0;b&&c<a.coordinates.length;c++)for(var d=a.coordinates[c],b=b&&Array.isArray(d),e=0;b&&e<d.length;e++){var f=d[e];b=b&&Array.isArray(f)&&2==f.length&&"number"==typeof f[0]&&"number"==typeof f[1]}return b},$data.GeometryPolygon.parseFromString=function(a){for(var b=a.substring(a.indexOf("(")+1,a.lastIndexOf(")")),c=b.substring(b.indexOf("(")+1,b.lastIndexOf(")")).split("),("),b=[],d=0;d<c.length;d++){for(var e=[],f=c[d].split(","),g=0;g<f.length;g++){var h=f[g].split(" ");e.push([parseFloat(h[0]),parseFloat(h[1])])}b.push(e)}return new $data.GeometryPolygon(b)},$data.GeometryPolygon.validMembers=["coordinates"],$data.GeometryBase.registerType("Polygon",$data.GeometryPolygon),$data.Container.registerType(["$data.GeometryPolygon","GeometryPolygon"],$data.GeometryPolygon),$data.GeometryMultiPoint=function(a){Array.isArray(a)?$data.GeometryBase.call(this,{coordinates:a}):$data.GeometryBase.call(this,a)},$data.GeometryMultiPoint.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.coordinates),c=0;b&&c<a.coordinates.length;c++){var d=a.coordinates[c];b=b&&Array.isArray(d)&&2==d.length&&"number"==typeof d[0]&&"number"==typeof d[1]}return b},$data.GeometryMultiPoint.validMembers=["coordinates"],$data.GeometryBase.registerType("MultiPoint",$data.GeometryMultiPoint),$data.Container.registerType(["$data.GeometryMultiPoint","GeometryMultiPoint"],$data.GeometryMultiPoint),$data.GeometryMultiLineString=function(a){Array.isArray(a)?$data.GeometryBase.call(this,{coordinates:a}):$data.GeometryBase.call(this,a)},$data.GeometryMultiLineString.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.coordinates),c=0;b&&c<a.coordinates.length;c++)for(var d=a.coordinates[c],b=b&&Array.isArray(d),e=0;b&&e<d.length;e++){var f=d[e];b=b&&Array.isArray(f)&&2==f.length&&"number"==typeof f[0]&&"number"==typeof f[1]}return b},$data.GeometryMultiLineString.validMembers=["coordinates"],$data.GeometryBase.registerType("MultiLineString",$data.GeometryMultiLineString),$data.Container.registerType(["$data.GeometryMultiLineString","GeometryMultiLineString"],$data.GeometryMultiLineString),$data.GeometryMultiPolygon=function(a){Array.isArray(a)?$data.GeometryBase.call(this,{coordinates:a}):$data.GeometryBase.call(this,a)},$data.GeometryMultiPolygon.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.coordinates),c=0;b&&c<a.coordinates.length;c++)for(var d=a.coordinates[c],b=b&&Array.isArray(d),e=0;b&&e<d.length;e++)for(var f=d[e],b=b&&Array.isArray(f),g=0;b&&g<f.length;g++){var h=f[g];b=b&&Array.isArray(h)&&2==h.length&&"number"==typeof h[0]&&"number"==typeof h[1]}return b},$data.GeometryMultiPolygon.validMembers=["coordinates"],$data.GeometryBase.registerType("MultiPolygon",$data.GeometryMultiPolygon),$data.Container.registerType(["$data.GeometryMultiPolygon","GeometryMultiPolygon"],$data.GeometryMultiPolygon),$data.GeometryCollection=function(a){Array.isArray(a)?$data.GeometryBase.call(this,{geometries:a}):$data.GeometryBase.call(this,a)},$data.GeometryCollection.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.geometries),c=0;b&&c<a.geometries.length;c++){var d=a.geometries[c];try{b=b&&$data.GeometryBase.validateGeoJSON(d)}catch(e){b=!1}}return b},$data.GeometryCollection.validMembers=["geometries"],$data.GeometryBase.registerType("GeometryCollection",$data.GeometryCollection),$data.Container.registerType(["$data.GeometryCollection","GeometryCollection"],$data.GeometryCollection),$data.Container.registerConverter($data.GeometryPoint,$data.Object,function(a){return a?new $data.GeometryPoint(a):a}),$data.Container.registerConverter($data.GeometryLineString,$data.Object,function(a){return a?new $data.GeometryLineString(a):a}),$data.Container.registerConverter($data.GeometryPolygon,$data.Object,function(a){return a?new $data.GeometryPolygon(a):a}),$data.Container.registerConverter($data.GeometryMultiPoint,$data.Object,function(a){return a?new $data.GeometryMultiPoint(a):a}),$data.Container.registerConverter($data.GeometryMultiLineString,$data.Object,function(a){return a?new $data.GeometryMultiLineString(a):a}),$data.Container.registerConverter($data.GeometryMultiPolygon,$data.Object,function(a){return a?new $data.GeometryMultiPolygon(a):a}),$data.Container.registerConverter($data.GeometryCollection,$data.Object,function(a){return a?new $data.GeometryCollection(a):a}),$data.Guid=function(a){if(!(void 0===a||"string"==typeof a&&/^[a-zA-z0-9]{8}-[a-zA-z0-9]{4}-[a-zA-z0-9]{4}-[a-zA-z0-9]{4}-[a-zA-z0-9]{12}$/.test(a)))throw Guard.raise(new Exception("TypeError: ","value not convertable to $data.Guid",a));this.value=a||"00000000-0000-0000-0000-000000000000"},$data.Container.registerType(["$data.Guid","Guid","guid"],$data.Guid),$data.Container.registerConverter("$data.Guid",{"$data.String":function(a){return a?$data.parseGuid(a).toString():a},"$data.Guid":function(a){return a?a.toString():a}},{"$data.String":function(a){return a?a.toString():a}}),$data.Guid.prototype.toJSON=function(){return this.value},$data.Guid.prototype.valueOf=function(){return this.value},$data.Guid.prototype.toString=function(){return this.value},$data.Guid.NewGuid=function(){return $data.createGuid()},$data.parseGuid=function(a){return new $data.Guid(a)},function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");$data.createGuid=function(b){if(b)return new $data.Guid(b);var c,d,e=a,f=[],g=e.length;if(c)for(d=0;c>d;d++)f[d]=e[0|Math.random()*g];else{var h;for(f[8]=f[13]=f[18]=f[23]="-",f[14]="4",d=0;36>d;d++)f[d]||(h=0|16*Math.random(),f[d]=e[19==d?3&h|8:h])}return $data.parseGuid(f.join(""))}}(),$data.Blob=function(){},$data.Blob.createFromHexString=function(a){if(a==a.match(new RegExp("[0-9a-fA-F]+"))[0]){for(var b=new("undefined"!=typeof Buffer?Buffer:Uint8Array)(a.length>>1),c=0,d=1,e=0;c<a.length;c+=2,d+=2,e++)b[e]=parseInt("0x"+a[c]+a[d],16);return b}Guard.raise(new Exception("TypeError: ","value not convertable to $data.Blob",a))},$data.Blob.toString=function(a){if(!a||!a.length)return null;for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},$data.Blob.toBase64=function(a){return a&&a.length?btoa($data.Blob.toString(a)):null},$data.Blob.toArray=function(a){if(!a||!a.length)return null;for(var b=new Array(a.length),c=0;c<a.length;c++)b[c]=a[c];return b},$data.Blob.toHexString=function(a){if(!a||!a.length)return null;for(var b="",c=0;c<a.length;c++)b+=("00"+a[c].toString(16)).slice(-2);return b.toUpperCase()},$data.Blob.toDataURL=function(a){return a&&a.length?"data:application/octet-stream;base64,"+btoa($data.Blob.toString(a)):null},$data.Container.registerType(["$data.Blob","blob","JayBlob"],$data.Blob),$data.Container.registerConverter("$data.Blob",{"$data.String":function(a){if(a&&a.length){for(var b=new("undefined"!=typeof Buffer?Buffer:Uint8Array)(a.length),c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}return null},"$data.Array":function(a){return new("undefined"!=typeof Buffer?Buffer:Uint8Array)(a)},"$data.Number":function(a){return new("undefined"!=typeof Buffer?Buffer:Uint8Array)($data.packIEEE754(a,11,52).reverse())},"$data.Boolean":function(a){return new("undefined"!=typeof Buffer?Buffer:Uint8Array)([0|a])},"default":function(a){if("undefined"!=typeof Blob&&a instanceof Blob){var b=new XMLHttpRequest;return b.open("GET",URL.createObjectURL(a),!1),b.responseType="arraybuffer",b.send(null),$data.Container.convertTo(b.response,$data.Blob)}if("undefined"!=typeof ArrayBuffer&&a instanceof ArrayBuffer)return new("undefined"!=typeof Buffer?Buffer:Uint8Array)(new Uint8Array(a));if(a instanceof Uint8Array)return"undefined"!=typeof Buffer?new Buffer(a):a;if("undefined"!=typeof Buffer?a instanceof Buffer:!1)return a;if(a.buffer)return new("undefined"!=typeof Buffer?Buffer:Uint8Array)(a);if("object"==typeof a&&a instanceof Object){var c=[];for(var d in a)c[d]=a[d];if(!c.length)throw 0;return new("undefined"!=typeof Buffer?Buffer:Uint8Array)(c)}throw 0}},{"$data.String":function(a){return $data.Blob.toString(a)},"$data.Array":function(a){return $data.Blob.toArray(a)}}),function(a){function b(){}function c(){}function d(){}function e(){}function f(){}function g(){}function h(){}function i(){}function j(){}function k(){}function l(){}function m(){}function n(){}function o(){}function p(){}function q(){}function r(){}function s(){}function t(){}function u(){}function v(){}function w(){}function x(){}function y(){}function z(){}function A(){}function B(){}function C(){}function D(){}function E(){}a.Container.registerType("Edm.Boolean",b),a.Container.mapType(b,a.Boolean),a.Container.registerType("Edm.Binary",c),a.Container.mapType(c,a.Blob),a.Container.registerType("Edm.DateTime",d),a.Container.mapType(d,a.Date),a.Container.registerType("Edm.DateTimeOffset",e),a.Container.mapType(e,a.DateTimeOffset),a.Container.registerType("Edm.Time",f),a.Container.mapType(f,a.Time),a.Container.registerType("Edm.Decimal",g),a.Container.mapType(g,a.Decimal),a.Container.registerType("Edm.Float",h),a.Container.mapType(h,a.Float),a.Container.registerType("Edm.Single",i),a.Container.mapType(i,a.Float),a.Container.registerType("Edm.Double",j),a.Container.mapType(j,a.Number),a.Container.registerType("Edm.Guid",k),a.Container.mapType(k,a.Guid),a.Container.registerType("Edm.Int16",l),a.Container.mapType(l,a.Int16),a.Container.registerType("Edm.Int32",m),a.Container.mapType(m,a.Integer),a.Container.registerType("Edm.Int64",n),a.Container.mapType(n,a.Int64),a.Container.registerType("Edm.Byte",o),a.Container.mapType(o,a.Byte),a.Container.registerType("Edm.SByte",p),a.Container.mapType(p,a.SByte),a.Container.registerType("Edm.String",q),a.Container.mapType(q,a.String),a.Container.registerType("Edm.GeographyPoint",r),a.Container.mapType(r,a.GeographyPoint),a.Container.registerType("Edm.GeographyLineString",s),a.Container.mapType(s,a.GeographyLineString),a.Container.registerType("Edm.GeographyPolygon",t),a.Container.mapType(t,a.GeographyPolygon),a.Container.registerType("Edm.GeographyMultiPoint",u),a.Container.mapType(u,a.GeographyMultiPoint),a.Container.registerType("Edm.GeographyMultiLineString",v),a.Container.mapType(v,a.GeographyMultiLineString),a.Container.registerType("Edm.GeographyMultiPolygon",w),a.Container.mapType(w,a.GeographyMultiPolygon),a.Container.registerType("Edm.GeographyCollection",x),a.Container.mapType(x,a.GeographyCollection),a.Container.registerType("Edm.GeometryPoint",y),a.Container.mapType(y,a.GeometryPoint),a.Container.registerType("Edm.GeometryLineString",z),a.Container.mapType(z,a.GeometryLineString),a.Container.registerType("Edm.GeometryPolygon",A),a.Container.mapType(A,a.GeometryPolygon),a.Container.registerType("Edm.GeometryMultiPoint",B),a.Container.mapType(B,a.GeometryMultiPoint),a.Container.registerType("Edm.GeometryMultiLineString",C),a.Container.mapType(C,a.GeometryMultiLineString),a.Container.registerType("Edm.GeometryMultiPolygon",D),a.Container.mapType(D,a.GeometryMultiPolygon),a.Container.registerType("Edm.GeometryCollection",E),a.Container.mapType(E,a.GeometryCollection),a.oDataEdmMapping={"$data.Byte":"Edm.Byte","$data.SByte":"Edm.SByte","$data.Decimal":"Edm.Decimal","$data.Float":"Edm.Float","$data.Int16":"Edm.Int16","$data.Int64":"Edm.Int64","$data.DateTimeOffset":"Edm.DateTimeOffset","$data.Time":"Edm.Time","$data.Boolean":"Edm.Boolean","$data.Blob":"Edm.Binary","$data.Date":"Edm.DateTime","$data.Number":"Edm.Double","$data.Integer":"Edm.Int32","$data.Int32":"Edm.Int32","$data.String":"Edm.String","$data.ObjectID":"Edm.String","$data.GeographyPoint":"Edm.GeographyPoint","$data.GeographyLineString":"Edm.GeographyLineString","$data.GeographyPolygon":"Edm.GeographyPolygon","$data.GeographyMultiPoint":"Edm.GeographyMultiPoint","$data.GeographyMultiLineString":"Edm.GeographyMultiLineString","$data.GeographyMultiPolygon":"Edm.GeographyMultiPolygon","$data.GeographyCollection":"Edm.GeographyCollection","$data.GeometryPoint":"Edm.GeometryPoint","$data.GeometryLineString":"Edm.GeometryLineString","$data.GeometryPolygon":"Edm.GeometryPolygon","$data.GeometryMultiPoint":"Edm.GeometryMultiPoint","$data.GeometryMultiLineString":"Edm.GeometryMultiLineString","$data.GeometryMultiPolygon":"Edm.GeometryMultiPolygon","$data.GeometryCollection":"Edm.GeometryCollection","$data.Guid":"Edm.Guid"}}($data),$data.Container.registerConverter("$data.Boolean",{"$data.String":function(a){return"true"==a.toLowerCase()?!0:"false"==a.toLowerCase()?!1:!!a},"default":function(a){return!!a}}),$data.Container.registerConverter("$data.Integer",{"default":function(a){if(a===Number.POSITIVE_INFINITY||a===Number.NEGATIVE_INFINITY||a===Number.MAX_VALUE||a===Number.MIN_VALUE)return a;var b=parseInt(+a,10);if(isNaN(b))throw 0;return b}}),$data.Container.registerConverter("$data.Int32",{"default":function(a){return 0|a}}),$data.Container.registerConverter("$data.Number",{"default":function(a){var b=+a;if(isNaN(b))throw 0;return b}}),$data.Container.registerConverter("$data.Byte",{"default":function(a){return 255&(0|a)}}),$data.Container.registerConverter("$data.Date",{"default":function(a){var b=new Date(a);if(isNaN(b))throw 0;return b}}),$data.Container.registerConverter("$data.DateTimeOffset",{"$data.Date":function(a){return a},"default":function(a){var b=new Date(a);if(isNaN(b))throw 0;return b}}),function(){function a(a){var b=/^([0-9]|0[0-9]|1[0-9]|2[0-3]):([0-5][0-9]|[0-9])(:([0-5][0-9]|[0-9])(\.(\d+))?)?$/,c=b.exec(a);if(!c)throw 0;var d="";return d+=("00"+c[1]).slice(-2),d+=":"+("00"+c[2]).slice(-2),d+=c[4]?":"+("00"+c[4]).slice(-2):":00",c[6]&&(d+="."+(c[6]+"000").slice(0,3)),d}$data.Container.registerConverter("$data.Time",{"$data.String":a,"$data.Number":function(b){for(var c=[1e3,60,60],d=[0,0,0,0|b],e=0;e<c.length;e++)d[c.length-(e+1)]=d[c.length-e]/c[e]|0,d[c.length-e]-=d[c.length-(e+1)]*c[e];
for(var f="",e=0;e<d.length;e++)e<d.length-1?(f+=("00"+d[e]).slice(-2),e<d.length-2&&(f+=":")):f+="."+("000"+d[e]).slice(-3);return a(f)},"$data.Date":function(b){var c=b.getHours()+":"+b.getMinutes()+":"+b.getSeconds(),d=b.getMilliseconds();return d&&(c+="."+d),a(c)}})}(),$data.Container.registerConverter("$data.Decimal",{"$data.Boolean":function(a){return a?"1":"0"},"$data.Number":function(a){return a.toString()},"$data.String":function(a){if(!/^\-?([0-9]+(\.[0-9]+)?|Infinity)$/.test(a))throw 0;return a},"$data.Date":function(a){var b=a.valueOf();if(isNaN(b))throw 0;return b.toString()}}),$data.packIEEE754=function(a,b,c){var d,e,f,g,h,i,j,k,l=(1<<b-1)-1;for(a!==a?(e=(1<<l)-1,f=Math.pow(2,c-1),d=0):1/0===a||a===-1/0?(e=(1<<l)-1,f=0,d=0>a?1:0):0===a?(e=0,f=0,d=1/a===-1/0?1:0):(d=0>a,a=Math.abs(a),a>=Math.pow(2,1-l)?(g=Math.min(Math.floor(Math.log(a)/Math.LN2),l),e=g+l,f=Math.round(a*Math.pow(2,c-g)-Math.pow(2,c))):(e=0,f=Math.round(a/Math.pow(2,1-l-c)))),i=[],h=c;h;h-=1)i.push(f%2?1:0),f=Math.floor(f/2);for(h=b;h;h-=1)i.push(e%2?1:0),e=Math.floor(e/2);for(i.push(d?1:0),i.reverse(),j=i.join(""),k=[];j.length;)k.push(parseInt(j.substring(0,8),2)),j=j.substring(8);return k},$data.unpackIEEE754=function(a,b,c){var d,e,f,g,h,i,j,k,l=[];for(d=a.length;d;d-=1)for(f=a[d-1],e=8;e;e-=1)l.push(f%2?1:0),f>>=1;return l.reverse(),g=l.join(""),h=(1<<b-1)-1,i=parseInt(g.substring(0,1),2)?-1:1,j=parseInt(g.substring(1,1+b),2),k=parseInt(g.substring(1+b),2),j===(1<<b)-1?0!==k?0/0:1/0*i:j>0?i*Math.pow(2,j-h)*(1+k/Math.pow(2,c)):0!==k?i*Math.pow(2,-(h-1))*(k/Math.pow(2,c)):0>i?-0:0},$data.IEEE754=function(a,b,c){return $data.unpackIEEE754($data.packIEEE754(a,b,c),b,c)},$data.Container.registerConverter("$data.Float",{"default":function(a){var b=+a;if(isNaN(b))throw 0;return $data.IEEE754(b,8,23)}}),$data.Container.registerConverter("$data.Int16",{"default":function(a){var b=65535&(0|a);return b>=32768?b-65536:b}}),$data.Container.registerConverter("$data.Int64",{"$data.Boolean":function(a){return a?"1":"0"},"$data.Number":function(a){var b=a.toString();if(b.indexOf(".")>0)return b.split(".")[0];if(0==b.indexOf("."))throw 0;return b},"$data.String":function(a){if(!/^\-?([0-9]+(\.[0-9]+)?|Infinity)$/.test(a))throw 0;if(a.indexOf(".")>0)return a.split(".")[0];if(0==a.indexOf("."))throw 0;return a},"$data.Date":function(a){var b=a.valueOf();if(isNaN(b))throw 0;return b.toString()}}),$data.Container.registerConverter("$data.SByte",{"default":function(a){var b=255&(0|a);return b>=128?b-256:b}}),$data.Container.registerConverter("$data.String",{"$data.Date":function(a){return a.toISOString()},"$data.ObjectID":function(a){return btoa(a.toString())},"default":function(a){return"object"==typeof a?JSON.stringify(a):a.toString()}}),$data.Container.registerConverter("$data.Object",{"$data.String":function(a){return JSON.parse(a)},"$data.Function":function(){throw 0}}),$data.Container.registerConverter("$data.Array",{"$data.String":function(a){var b=JSON.parse(a);if(!Array.isArray(b))throw 0;return b}}),$data.Container.registerConverter("$data.ObjectID",{"$data.ObjectID":function(a){try{return btoa(a.toString())}catch(b){return a}},"$data.String":function(a){return a}}),$data.Container.proxyConverter=function(a){return a},$data.Container.defaultConverter=function(a){return function(b){return $data.Container.convertTo(b,a)}},$data.StringFunctions={startsWith:function(){var a,b;if(2==arguments.length)a=arguments[0],b=arguments[1];else if(1==arguments.length&&"string"==typeof this)a=this,b=arguments[0];else{if(!(this instanceof String))return!1;a=this.valueOf(),b=arguments[0]}return"string"!=typeof a?!1:0===a.indexOf(b)},endsWith:function(){var a,b;if(2==arguments.length)a=arguments[0],b=arguments[1];else if(1==arguments.length&&"string"==typeof this)a=this,b=arguments[0];else{if(!(this instanceof String))return!1;a=this.valueOf(),b=arguments[0]}return"string"!=typeof a?!1:a.slice(-b.length)===b},contains:function(){var a,b;if(2==arguments.length)a=arguments[0],b=arguments[1];else if(1==arguments.length&&"string"==typeof this)a=this,b=arguments[0];else{if(!(this instanceof String))return!1;a=this.valueOf(),b=arguments[0]}return"string"!=typeof a?!1:a.indexOf(b)>=0}},$data.Class.define("$data.Expressions.ExpressionType",null,null,{},{Constant:"constant",Variable:"variable",MemberAccess:"memberAccess",Call:"call",Equal:"equal",NotEqual:"notEqual",EqualTyped:"equalTyped",NotEqualTyped:"notEqualTyped",GreaterThen:"greaterThan",LessThen:"lessThan",GreaterThenOrEqual:"greaterThanOrEqual",LessThenOrEqual:"lessThenOrEqual",Or:"or",OrBitwise:"orBitwise",And:"and",AndBitwise:"andBitwise",In:"in",Add:"add",Divide:"divide",Multiply:"multiply",Subtract:"subtract",Modulo:"modulo",ArrayIndex:"arrayIndex",New:"new",Positive:"positive",Negative:"negative",Increment:"increment",Decrement:"decrement",Not:"not",This:"this",LambdaParameterReference:"lambdaParameterReference",LambdaParameter:"lambdaParameter",Parameter:"parameter",ArrayLiteral:"arrayLiteral",ObjectLiteral:"objectLiteral",ObjectField:"objectField",Function:"Function",Unknown:"UNKNOWN",EntitySet:"EntitySet",ServiceOperation:"ServiceOperation",EntityField:"EntityField",EntityContext:"EntityContext",Entity:"Entity",Filter:"Filter",First:"First",Count:"Count",InlineCount:"InlineCount",Single:"Single",Find:"Find",Some:"Some",Every:"Every",ToArray:"ToArray",BatchDelete:"BatchDelete",ForEach:"ForEach",Projection:"Projection",EntityMember:"EntityMember",EntityFieldOperation:"EntityFieldOperation",FrameOperation:"FrameOperation",EntityFunctionOperation:"EntityFunctionOperation",ContextFunctionOperation:"ContextFunctionOperation",EntityBinary:"EntityBinary",Code:"Code",ParametricQuery:"ParametricQuery",MemberInfo:"MemberInfo",QueryParameter:"QueryParameter",ComplexEntityField:"ComplexEntityField",Take:"Take",Skip:"Skip",OrderBy:"OrderBy",OrderByDescending:"OrderByDescending",Include:"Include",IndexedPhysicalAnd:"IndexedDBPhysicalAndFilterExpression",IndexedLogicalAnd:"IndexedDBLogicalAndFilterExpression",IndexedLogicalOr:"IndexedDBLogicalOrFilterExpression",IndexedLogicalIn:"IndexedDBLogicalInFilterExpression"}),$data.BinaryOperator=function(){},$data.binaryOperators=[{operator:"==",expressionType:$data.Expressions.ExpressionType.Equal,type:"boolean",implementation:function(a,b){return a==b}},{operator:"===",expressionType:$data.Expressions.ExpressionType.EqualTyped,type:"boolean",implementation:function(a,b){return a===b}},{operator:"!=",expressionType:$data.Expressions.ExpressionType.NotEqual,type:"boolean",implementation:function(a,b){return a!=b}},{operator:"!==",expressionType:$data.Expressions.ExpressionType.NotEqualTyped,type:"boolean",implementation:function(a,b){return a!==b}},{operator:">",expressionType:$data.Expressions.ExpressionType.GreaterThen,type:"boolean",implementation:function(a,b){return a>b}},{operator:">=",expressionType:$data.Expressions.ExpressionType.GreaterThenOrEqual,type:"boolean",implementation:function(a,b){return a>=b}},{operator:"<=",expressionType:$data.Expressions.ExpressionType.LessThenOrEqual,type:"boolean",implementation:function(a,b){return b>=a}},{operator:"<",expressionType:$data.Expressions.ExpressionType.LessThen,type:"boolean",implementation:function(a,b){return b>a}},{operator:"&&",expressionType:$data.Expressions.ExpressionType.And,type:"boolean",implementation:function(a,b){return a&&b}},{operator:"||",expressionType:$data.Expressions.ExpressionType.Or,type:"boolean",implementation:function(a,b){return a||b}},{operator:"&",expressionType:$data.Expressions.ExpressionType.AndBitwise,type:"number",implementation:function(a,b){return a&b}},{operator:"|",expressionType:$data.Expressions.ExpressionType.OrBitwise,type:"number",implementation:function(a,b){return a|b}},{operator:"+",expressionType:$data.Expressions.ExpressionType.Add,type:"number",implementation:function(a,b){return a+b}},{operator:"-",expressionType:$data.Expressions.ExpressionType.Subtract,type:"number",implementation:function(a,b){return a-b}},{operator:"/",expressionType:$data.Expressions.ExpressionType.Divide,type:"number",implementation:function(a,b){return a/b}},{operator:"%",expressionType:$data.Expressions.ExpressionType.Modulo,type:"number",implementation:function(a,b){return a%b}},{operator:"*",expressionType:$data.Expressions.ExpressionType.Multiply,type:"number",implementation:function(a,b){return a*b}},{operator:"[",expressionType:$data.Expressions.ExpressionType.ArrayIndex,type:"number",implementation:function(a,b){return a[b]}},{operator:"in",expressionType:$data.Expressions.ExpressionType.In,type:"boolean",implementation:function(a,b){return a in b}}],$data.binaryOperators.resolve=function(a){var b=$data.binaryOperators.filter(function(b){return b.operator==a});return b.length>0?a:void 0},$data.binaryOperators.contains=function(a){return $data.binaryOperators.some(function(b){return b.operator==a})},$data.binaryOperators.getOperator=function(a){var b=$data.binaryOperators.filter(function(b){return b.operator==a});return b.length<1&&Guard.raise("Unknown operator: "+a),b[0]},$data.unaryOperators=[{operator:"+",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Positive,type:"number",implementation:function(a){return+a}},{operator:"-",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Negative,type:"number",implementation:function(a){return-a}},{operator:"++",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(a){return++a}},{operator:"--",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Decrement,type:"number",implementation:function(a){return--a}},{operator:"++",arity:"suffix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(a){return a++}},{operator:"!",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Not,type:"boolean",implementation:function(a){return!a}},{operator:"--",arity:"suffix",expressionType:$data.Expressions.ExpressionType.Decrement,type:"number",implementation:function(a){return a--}}],$data.unaryOperators.resolve=function(a){var b=$data.unaryOperators.filter(function(b){return b.operator==a});return b.length>0?a:void 0},$data.unaryOperators.contains=function(a){return $data.unaryOperators.some(function(b){return b.operator==a})},$data.unaryOperators.getOperator=function(a,b){var c=$data.unaryOperators.filter(function(c){return c.operator==a&&(!b||c.arity==b)});return c.length<1&&Guard.raise("Unknown operator: "+a),c[0]},$data.timeIt=function(a,b){b=b||1,console.time("!");for(var c=0;b>c;c++)a();console.timeEnd("!")},$data.Expressions.OperatorTypes={UNARY:"UNARY",INCDEC:"INCDEC",DECISION:"DECISION",METHODCALL:"METHODCALL",NEW:"NEW",JSONASSIGN:"JSONASSIGN",ARRAYACCESS:"ARRAYACCESS",UNKNOWN:"UNKNOWN"},$data.executable=!0,$C("$data.Expressions.ExpressionNode",null,null,{constructor:function(){this.expressionType=this.constructor},getJSON:function(){return jsonify(this)},expressionType:{set:function(a){"string"==typeof a&&(a=Container.resolveType(a)),this._expressionType=a},get:function(){return arguments.callee.caller==jsonify||arguments.callee.caller==JSON.stringify?Container.resolveName(this._expressionType):this._expressionType},enumerable:!0},nodeType:{value:$data.Expressions.ExpressionType.Unknown,writable:!1},type:{},isTerminated:{value:!1},toString:function(){return this.value}},null),$C("$data.Expressions.UnaryExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c,d){this.operand=a,this.operator=b,this.nodeType=c,this.resolution=d},operator:{value:void 0,writable:!0},operand:{value:void 0,writable:!0},nodeType:{value:void 0,writable:!0}}),$C("$data.Expressions.ArrayLiteralExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.items=a||[]},nodeType:{value:$data.Expressions.ExpressionType.ArrayLiteral,writable:!0},items:{value:void 0,dataType:Array,elementType:$data.Expressions.ExpressionNode},toString:function(){var a="["+this.items.map(function(a){return a.toString()}).join(",")+"]";return a}},null),$C("$data.Expressions.CallExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.expression=a,this.member=b,this.args=c},nodeType:{value:$data.Expressions.ExpressionType.Call},expression:{value:void 0,dataType:$data.Expressions.ExpressionNode,writable:!0},member:{value:void 0,dataType:$data.MemberDefinition,writable:!0},type:{value:void 0,writable:!0},implementation:{get:function(){return function(a,b,c){return"function"!=typeof b&&(b=a[b]),Guard.requireType("method",b,Function),b.apply(a,c)}},set:function(){Guard.raise("Property can not be set")}},toString:function(){return this.object.toString()+"."+this.member.toString()+"()"}}),$C("$data.Expressions.CodeParser",null,null,{constructor:function(a){this.scopeContext=a,this.lambdaParams=[]},log:function(a){this.scopeContext&&this.scopeContext.log(a)},parseExpression:function(a){"object"==typeof a&&(a="");var b={success:!0,errorMessage:"",errorDetails:""};if($data.Acorn)return{success:!0,expression:this.ParserBuild($data.Acorn.parse("("+a.toString()+")").body[0]),errors:[]};if($data.Esprima)return{success:!0,expression:this.ParserBuild($data.Esprima.parse("("+a.toString()+")").body[0]),errors:[]};var c=$data.ASTParser.parseCode(a);if(this.log({event:"AST",data:c}),!c.success)return{success:!1,error:"ASTParser error",errorMessage:c.errors?JSON.stringify(c.errors):"could not get code"};var d=this.Build2(c.tree.first[0]);return b={success:!0,expression:d,errors:c.errors}},createExpression:function(a,b){var c=this.parseExpression(a,b);return c.success||Guard.raise("ExpressionParserError: "+c.errorMessage),c.expression},ParserBuild:function(a){return this["Parser"+a.type](a)},ParserExpressionStatement:function(a){return this.ParserBuild(a.expression)},ParserBlockStatement:function(a){return this.ParserBuild(a.body[0])},ParserReturnStatement:function(a){return this.ParserBuild(a.argument)},ParserMemberExpression:function(a){return new $data.Expressions.PropertyExpression(this.ParserBuild(a.object),new $data.Expressions.ConstantExpression(a.property.name||a.property.value,typeof(a.property.name||a.property.value)))},ParserIdentifier:function(a){return this.ParserParameter(a,this.lambdaParams.indexOf(a.name)>-1?$data.Expressions.ExpressionType.LambdaParameterReference:$data.Expressions.ExpressionType.Parameter)},ParserObjectExpression:function(a){for(var b=new Array(a.properties.length),c=0;c<a.properties.length;c++)b[c]=this.ParserProperty(a.properties[c]);return new $data.Expressions.ObjectLiteralExpression(b)},ParserArrayExpression:function(a){for(var b=new Array(a.elements.length),c=0;c<a.elements.length;c++)b[c]=this.ParserBuild(a.elements[c]);return new $data.Expressions.ArrayLiteralExpression(b)},ParserProperty:function(a){return new $data.Expressions.ObjectFieldExpression(a.key.name,this.ParserBuild(a.value))},ParserFunctionExpression:function(a){for(var b=new Array(a.params.length),c=0;c<a.params.length;c++)this.lambdaParams.push(a.params[c].name),b[c]=this.ParserParameter(a.params[c],$data.Expressions.ExpressionType.LambdaParameter),b[c].owningFunction=d;var d=new $data.Expressions.FunctionExpression(a.id?a.id.name:a.id,b,this.ParserBuild(a.body));return d},ParserParameter:function(a,b){var c=new $data.Expressions.ParameterExpression(a.name,null,b);return b==$data.Expressions.ExpressionType.LambdaParameterReference&&(c.paramIndex=this.lambdaParams.indexOf(a.name)),c},ParserLogicalExpression:function(a){return this.ParserBinaryExpression(a)},ParserOperators:{value:{"==":{expressionType:$data.Expressions.ExpressionType.Equal,type:"boolean",implementation:function(a,b){return a==b}},"===":{expressionType:$data.Expressions.ExpressionType.EqualTyped,type:"boolean",implementation:function(a,b){return a===b}},"!=":{expressionType:$data.Expressions.ExpressionType.NotEqual,type:"boolean",implementation:function(a,b){return a!=b}},"!==":{expressionType:$data.Expressions.ExpressionType.NotEqualTyped,type:"boolean",implementation:function(a,b){return a!==b}},">":{expressionType:$data.Expressions.ExpressionType.GreaterThen,type:"boolean",implementation:function(a,b){return a>b}},">=":{expressionType:$data.Expressions.ExpressionType.GreaterThenOrEqual,type:"boolean",implementation:function(a,b){return a>=b}},"<=":{expressionType:$data.Expressions.ExpressionType.LessThenOrEqual,type:"boolean",implementation:function(a,b){return b>=a}},"<":{expressionType:$data.Expressions.ExpressionType.LessThen,type:"boolean",implementation:function(a,b){return b>a}},"&&":{expressionType:$data.Expressions.ExpressionType.And,type:"boolean",implementation:function(a,b){return a&&b}},"||":{expressionType:$data.Expressions.ExpressionType.Or,type:"boolean",implementation:function(a,b){return a||b}},"&":{expressionType:$data.Expressions.ExpressionType.AndBitwise,type:"number",implementation:function(a,b){return a&b}},"|":{expressionType:$data.Expressions.ExpressionType.OrBitwise,type:"number",implementation:function(a,b){return a|b}},"+":{expressionType:$data.Expressions.ExpressionType.Add,type:"number",implementation:function(a,b){return a+b}},"-":{expressionType:$data.Expressions.ExpressionType.Subtract,type:"number",implementation:function(a,b){return a-b}},"/":{expressionType:$data.Expressions.ExpressionType.Divide,type:"number",implementation:function(a,b){return a/b}},"%":{expressionType:$data.Expressions.ExpressionType.Modulo,type:"number",implementation:function(a,b){return a%b}},"*":{expressionType:$data.Expressions.ExpressionType.Multiply,type:"number",implementation:function(a,b){return a*b}},"[":{expressionType:$data.Expressions.ExpressionType.ArrayIndex,type:"number",implementation:function(a,b){return a[b]}},"in":{expressionType:$data.Expressions.ExpressionType.In,type:"boolean",implementation:function(a,b){return a in b}}}},ParserUnaryOperators:{value:{"+":{arity:"prefix",expressionType:$data.Expressions.ExpressionType.Positive,type:"number",implementation:function(a){return+a}},"-":{arity:"prefix",expressionType:$data.Expressions.ExpressionType.Negative,type:"number",implementation:function(a){return-a}},"++true":{arity:"prefix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(a){return++a}},"--true":{arity:"prefix",expressionType:$data.Expressions.ExpressionType.Decrement,type:"number",implementation:function(a){return--a}},"++false":{arity:"suffix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(a){return a++}},"!":{arity:"prefix",expressionType:$data.Expressions.ExpressionType.Not,type:"boolean",implementation:function(a){return!a}},"--false":{arity:"suffix",expressionType:$data.Expressions.ExpressionType.Decrement,type:"number",implementation:function(a){return a--}}}},ParserUnaryExpression:function(a){return new $data.Expressions.UnaryExpression(this.ParserBuild(a.argument),this.ParserUnaryOperators[a.operator],this.ParserUnaryOperators[a.operator].expressionType)},ParserUpdateExpression:function(a){return new $data.Expressions.UnaryExpression(this.ParserBuild(a.argument),this.ParserUnaryOperators[a.operator+a.prefix],this.ParserUnaryOperators[a.operator+a.prefix].nodeType)},ParserBinaryExpression:function(a){return new $data.Expressions.SimpleBinaryExpression(this.ParserBuild(a.left),this.ParserBuild(a.right),this.ParserOperators[a.operator].expressionType,a.operator,this.ParserOperators[a.operator].type)},ParserThisExpression:function(){return new $data.Expressions.ThisExpression},ParserLiteral:function(a){return new $data.Expressions.ConstantExpression(a.value,typeof a.value)},ParserCallExpression:function(a){for(var b=this.ParserBuild(a.callee),c=new Array(a.arguments.length),d=0;d<a.arguments.length;d++)c[d]=this.ParserBuild(a.arguments[d]);var e,f;switch(!0){case b instanceof $data.Expressions.PropertyExpression:f=b.expression,e=b.member;break;case b instanceof $data.Expressions.ParameterExpression:f=new $data.Expressions.ConstantExpression(null,"object"),e=b}return new $data.Expressions.CallExpression(f,e,c)}}),$C("$data.Expressions.ConstantExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.value=a,this.type=b,this.name=c,Object.isNullOrUndefined(this.value)||(this.type=Container.resolveType(this.type),Container.resolveType(Container.getTypeName(this.value))!==this.type&&(this.value=Container.convertTo(a,this.type)))},nodeType:{value:$data.Expressions.ExpressionType.Constant,enumerable:!0},type:{value:Object,writable:!0},value:{value:void 0,writable:!0},toString:function(){return this.value.toString()}}),$C("$data.Expressions.FunctionExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.parameters=b||[],this.name=a,this.body=c},toString:function(a){var b=this.parameters.map(function(a){return a.toString()});b=b.join(",");var c=this.body?this.body.toString(a):"";return"function "+this.name+"("+b+") { "+c+"}"},nodeType:{value:$data.Expressions.ExpressionType.Function,writable:!0},parameters:{value:void 0,dataType:Array,elementType:$data.Expressions.ParameterExpression},body:{value:void 0,dataType:$data.Expressions.ExpressionNode},type:{}},null),$C("$data.Expressions.ObjectFieldExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){this.fieldName=a,this.expression=b},nodeType:{value:$data.Expressions.ExpressionType.ObjectField,writable:!0},toString:function(){var a="unimplemented";return a}},null),$C("$data.Expressions.ObjectLiteralExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.members=a},nodeType:{value:$data.Expressions.ExpressionType.ObjectLiteral,writable:!0},toString:function(){var a="unimplemented";return a},implementation:{get:function(){return function(a){var b={};return a.forEach(function(a){b[a.name]=a.value}),b}},set:function(){}}},null),$C("$data.Expressions.PagingExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.source=a,this.amount=b,this.nodeType=c},nodeType:{value:$data.Expressions.ExpressionType.Unknown,writable:!0},toString:function(){var a="unimplemented";return a}},null),$C("$data.Expressions.ParameterExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.nodeType=c||$data.Expressions.ExpressionType.Parameter,this.name=a,this.type=b||"unknown"},owningFunction:{value:void 0,enumerable:!1},nodeType:{value:$data.Expressions.ExpressionType.Parameter,writable:!0},name:{value:void 0,dataType:String,writable:!0},type:{value:void 0,dataType:"object",writable:!0},toString:function(a){var b;return b=a?this.type+" ":"",b+=this.name}},null),$C("$data.Expressions.PropertyExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){this.expression=a,this.member=b,this.type=b.dataType},nodeType:{value:$data.Expressions.ExpressionType.MemberAccess},expression:{value:void 0,dataType:$data.Expressions.ExpressionNode,writable:!0},implementation:{get:function(){return function(a,b){return void 0===a[b]&&Guard.raise(new Exception("Parameter '"+b+"' not found in context","Property not found!")),a[b]}},set:function(){}},member:{value:void 0,dataType:$data.MemberDefinition,writable:!0},type:{value:void 0,writable:!0},toString:function(){return this.expression.toString()+"."+this.member.toString()}}),$C("$data.Expressions.SimpleBinaryExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c,d,e,f){this.left=a,this.right=b,this.nodeType=c,this.operator=d,this.type=e,this.resolution=f},implementation:{get:function(){return $data.binaryOperators.getOperator(this.operator).implementation},set:function(){}},type:{value:"number",writable:!0}}),$C("$data.Expressions.ThisExpression",$data.Expressions.ExpressionNode,null,{nodeType:{value:$data.Expressions.ExpressionType.This}}),$C("$data.Expressions.ExpressionVisitor",null,null,{constructor:function(){this._deep=0},Visit:function(a,b){if(!a)return a;var c=null;switch(a.expressionType){case $data.Expressions.ParameterExpression:c=this.VisitParameter(a,b);break;case $data.Expressions.ConstantExpression:c=this.VisitConstant(a,b);break;case $data.Expressions.FunctionExpression:c=this.VisitFunction(a,b);break;case $data.Expressions.CallExpression:c=this.VisitCall(a,b);break;case $data.Expressions.SimpleBinaryExpression:c=this.VisitBinary(a,b);break;case $data.Expressions.PropertyExpression:c=this.VisitProperty(a,b);break;case $data.Expressions.ThisExpression:c=this.VisitThis(a,b);break;case $data.Expressions.ObjectLiteralExpression:c=this.VisitObjectLiteral(a,b);break;case $data.Expressions.ObjectFieldExpression:c=this.VisitObjectField(a,b);break;case $data.Expressions.ArrayLiteralExpression:c=this.VisitArrayLiteral(a,b);break;case $data.Expressions.UnaryExpression:c=this.VisitUnary(a,b);break;case $data.Expressions.EntityContextExpression:c=this.VisitEntityContext(a,b)}return this._deep=this._deep-1,c},VisitArrayLiteral:function(a,b){var c=this,d=a.items.map(function(a){return c.Visit(a,b)}),e=Container.createArrayLiteralExpression(d);return e},VisitObjectLiteral:function(a,b){var c=this,d=a.members.map(function(a){return c.Visit(a,b)}),e=Container.createObjectLiteralExpression(d);return e},VisitObjectField:function(a,b){var c=this.Visit(a.expression,b),d=Container.createObjectFieldExpression(a.fieldName,c);return d},VisitThis:function(a){return a},VisitCall:function(a,b){var c=a.args.map(function(a){return this.Visit(a,b)},this),d=this.Visit(a.expression,b),e=this.Visit(a.member,b);return new $data.Expressions.CallExpression(d,e,c)},VisitParameter:function(a){return a},VisitConstant:function(a){return a},VisitFunction:function(a,b){var c=this,d=a.parameters.map(function(a){return c.Visit(a,b)}),e=c.Visit(a.body,b),f=new $data.Expressions.FunctionExpression(a.name,d,e);return f},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return new $data.Expressions.SimpleBinaryExpression(c,d,a.nodeType,a.operator,a.type)},VisitProperty:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b);return new $data.Expressions.PropertyExpression(c,d)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b);return c===a.operand?a:new $data.Expressions.UnaryExpression(c,a.operator,a.nodeType)},VisitEntityContext:function(a){return a},VisitDecision:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.left,b),e=this.Visit(a.right,b);return c===a.expression&&d===a.left&&e===a.right?a:$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(a.executable,c,d,e)},VisitNew:function(a,b){var c=this.VisitArray(a.values,b);return c===a.values?a:$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(!0,c)},VisitArrayAccess:function(a,b){var c=this.Visit(a.array,b),d=this.Visit(a.index,b);return c===a.array&&d===a.index?a:$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(!0,c,d)},VisitArray:function(a,b){for(var c=[],d=!0,e=0;e<a.length;e++)c[e]=this.Visit(a[e],b),d=d&&c[e]===a[e];return d?a:c},GetMemberChain:function(a,b){if(a.expression.type==MEMBERACCESS){var c=this.GetMemberChain(a.expression,b);return c.push(a.member),c}return[a.expression,a.member]}},{}),$C("$data.Expressions.ParameterProcessor",$data.Expressions.ExpressionVisitor,null,{constructor:function(){},Visit:function(a,b){if((a instanceof $data.Expressions.ParameterExpression||a instanceof $data.Expressions.ThisExpression)&&this.canResolve(a)){var c=this.resolve(a,b);return c!==a&&(c.resolvedBy=this.constructor.name),c}return a},canResolve:function(){Guard.raise("Pure method")},resolve:function(){Guard.raise("Pure method")}}),$C("$data.Expressions.GlobalContextProcessor",$data.Expressions.ParameterProcessor,null,{constructor:function(a){this.global=a},canResolve:function(a){return a.nodeType==$data.Expressions.ExpressionType.Parameter&&this.global&&"object"==typeof this.global&&a.name in this.global},resolve:function(a){var b=this.global[a.name],c=Container.createConstantExpression(b,typeof b,a.name);return c}}),$C("$data.Expressions.ConstantValueResolver",$data.Expressions.ParameterProcessor,null,{constructor:function(a,b,c){this.globalResolver=Container.createGlobalContextProcessor(b),this.paramResolver=Container.createGlobalContextProcessor(a),this.paramsObject=a,this.scopeContext=c},canResolve:function(a){return"$context"===a.name||a.nodeType==$data.Expressions.ExpressionType.This&&this.paramsObject?!0:this.paramResolver.canResolve(a)||this.globalResolver.canResolve(a)},resolve:function(a){return"$context"===a.name?Container.createEntityContextExpression(this.scopeContext):a.nodeType==$data.Expressions.ExpressionType.This?Container.createConstantExpression(this.paramsObject,typeof this.paramsObject,"this"):this.paramResolver.canResolve(a)?this.paramResolver.resolve(a):this.globalResolver.resolve(a)}}),$C("$data.Expressions.LocalContextProcessor",$data.Expressions.GlobalContextProcessor,null,{constructor:function(a){this.canResolve=function(b){return b.nodeType==$data.Expressions.ExpressionType.Parameter&&"undefined"!==a("typeof "+b.name)},this.resolve=function(b){var c=a(b.name),d=Container.createConstantExpression(c,typeof c);return d}}}),$C("$data.Expressions.LambdaParameterProcessor",$data.Expressions.ParameterProcessor,null,{constructor:function(a){var b={};this.canResolve=function(c){if(c.nodeType==$data.Expressions.ExpressionType.LambdaParameter){var d=c.owningFunction.parameters;if(1==d.length&&c.name==d[0].name)return b[c.name]=a[0],!0;for(var e=0;e<d.length;e++)if(d[e].name==c.name)return b[c.name]=a[e],!0;return!1}return!1},this.resolve=function(a){var c=b[a.name],d=Container.createParameterExpression(a.name,c,$data.Expressions.ExpressionType.LambdaParameter);return d.owningFunction=a.owningFunction,d}}}),$C("$data.Expressions.ParameterResolverVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(){this.lambdaParamCache={}},Visit:function(a,b){return $data.Expressions.ExpressionVisitor.prototype.Visit.call(this,a,b)},VisitArrayLiteral:function(a,b){var c=this,d=a.items.map(function(a){return c.Visit(a,b)}),e=d.every(function(a){return a instanceof $data.Expressions.ConstantExpression});return e?(d=d.map(function(a){return a.value}),Container.createConstantExpression(d,"array")):Container.createArrayLiteralExpression(d)},VisitObjectLiteral:function(a,b){var c=this,d=a.members.map(function(a){return c.Visit(a,b)}),e=d.every(function(a){return a.expression instanceof $data.Expressions.ConstantExpression});if(e){var f=d.map(function(a){return{name:a.fieldName,value:a.expression.value}}),g=a.implementation(f);return Container.createConstantExpression(g,typeof g)}return Container.createObjectLiteralExpression(d)},VisitThis:function(a,b){return b.Visit(a,b)},VisitParameter:function(a,b){var c;switch(a.nodeType){case $data.Expressions.ExpressionType.Parameter:case $data.Expressions.ExpressionType.LambdaParameter:return c=b.Visit(a,b),c.nodeType==$data.Expressions.ExpressionType.LambdaParameter&&(this.lambdaParamCache[c.name]=c),c;case $data.Expressions.ExpressionType.LambdaParameterReference:var d=this.lambdaParamCache[a.name];if(d)return c=Container.createParameterExpression(a.name,d.type,$data.Expressions.ExpressionType.LambdaParameterReference),c.paramIndex=a.paramIndex,c;break;default:return a}return a},VisitConstant:function(a){return a},VisitFunction:function(a,b){var c=this,d=a.parameters.map(function(a){var d=c.Visit(a,b);return d}),e=c.Visit(a.body,b),f=new $data.Expressions.FunctionExpression(a.name,d,e);return f},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b),e=$data.Expressions;if(c instanceof e.ConstantExpression&&d instanceof e.ConstantExpression){var f=a.implementation(c.value,d.value);return Container.createConstantExpression(f,typeof f)}return new Container.createSimpleBinaryExpression(c,d,a.nodeType,a.operator,a.type)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b),d=$data.Expressions;if(c instanceof d.ConstantExpression){var e=a.operator.implementation(c.value);
return Container.createConstantExpression(e,typeof e)}return new Container.createUnaryExpression(c,a.operator,a.nodeType)},VisitProperty:function(a,b){var c,d=this.Visit(a.expression,b),e=this.Visit(a.member,b);return d instanceof $data.Expressions.ConstantExpression&&e instanceof $data.Expressions.ConstantExpression?(c=a.implementation(d.value,e.value),Container.createConstantExpression(c,typeof c,d.name+"$"+e.value)):d===a.expression&&e===a.member?a:c=Container.createPropertyExpression(d,e)},VisitCall:function(a){function b(a,b,c){return b instanceof $data.Expressions.ConstantExpression&&(!c||c instanceof $data.Expressions.ConstantExpression)&&a.every(function(a){return a instanceof $data.Expressions.ConstantExpression})}function c(a){return a instanceof $data.Expressions.ConstantExpression?a.value:a}var d=$data.Expressions.ExpressionVisitor.prototype.VisitCall.apply(this,arguments),e=d.expression,f=d.member,g=d.args;if(b(g,f,e)){var h=f.value;"string"==typeof h&&e.value&&(h=e.value[h]),"function"!=typeof h&&Guard.raise("Constant expression is not a method...");var i=a.implementation(e.value,h,g.map(c));return new $data.Expressions.ConstantExpression(i,typeof i)}return d}},{}),$C("$data.Expressions.AggregatedVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(a){this.Visit=function(b,c){for(var d=0;d<a.length;d++){var e=a[d].Visit(b,c);if(e!==b)return e}return b}}}),$C("$data.Expressions.LogicalSchemaBinderVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(){},VisitProperty:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b),e=c.type,f=b.memberResolver.resolve(e,d.value);return d.type=f,Container.createPropertyExpression(c,d)}},{}),$data.Class.define("$data.Expressions.ExpTreeVisitor",null,null,{constructor:function(){this._deep=0},Visit:function(a,b){this._deep=this._deep+1;var c=null;switch(a.type){case LITERAL:c=this.VisitLiteral(a,b);break;case VARIABLE:c=this.VisitVariable(a,b);break;case MEMBERACCESS:c=this.VisitMember(a,b);break;case BINARY:c=this.VisitBinary(a,b);break;case UNARY:c=this.VisitUnary(a,b);break;case INCDEC:c=this.VisitIncDec(a,b);break;case EQUALITY:c=this.VisitEquality(a,b);break;case DECISION:c=this.VisitDecision(a,b);break;case METHODCALL:c=this.VisitMethodCall(a,b);break;case NEW:c=this.VisitNew(a,b);break;case JSONASSIGN:c=this.VisitJsonAssign(a,b);break;case ARRAYACCESS:c=this.VisitArrayAccess(a,b);break;default:Guard.raise("Type isn't implemented: "+a.type)}return this._deep=this._deep-1,c},VisitLiteral:function(a){return a},VisitVariable:function(a){return a},VisitMember:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b);return c===a.expression&&d===a.member?a:$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(a.executable,c,d)},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right?a:$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(a.executable,a.operator,c,d)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b);return c===a.operand?a:$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(a.executable,a.operator,c)},VisitIncDec:function(a,b){var c=this.Visit(a.operand,b);return c===a.operand?a:$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(a.executable,a.operator,c,a.suffix)},VisitEquality:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right?a:$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(a.executable,a.operator,c,d)},VisitDecision:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.left,b),e=this.Visit(a.right,b);return c===a.expression&&d===a.left&&e===a.right?a:$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(a.executable,c,d,e)},VisitMethodCall:function(a,b){var c=a.object?this.Visit(a.object,b):null,d=this.VisitArray(a.args,b);return c===a.object&&d===a.args?a:$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(a.executable,c,a.method,d)},VisitNew:function(a,b){var c=this.VisitArray(a.values,b);return c===a.values?a:$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(!0,c)},VisitJsonAssign:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right?a:(c.JSONASSIGN=!0,d.JSONASSIGN=!0,$data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(!0,c,d))},VisitArrayAccess:function(a,b){var c=this.Visit(a.array,b),d=this.Visit(a.index,b);return c===a.array&&d===a.index?a:$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(!0,c,d)},VisitArray:function(a,b){for(var c=[],d=!0,e=0;e<a.length;e++)c[e]=this.Visit(a[e],b),d=d&&c[e]===a[e];return d?a:c},GetMemberChain:function(a,b){if(a.expression.type==MEMBERACCESS){var c=this.GetMemberChain(a.expression,b);return c.push(a.member),c}return[a.expression,a.member]}},{}),$data.Class.define("$data.Expressions.SetExecutableVisitor",$data.Expressions.ExpTreeVisitor,null,{Visit:function(a,b){switch(a.type){case LITERAL:return this.VisitLiteral(a,b);case VARIABLE:return this.VisitVariable(a,b);case MEMBERACCESS:return this.VisitMember(a,b);case BINARY:return this.VisitBinary(a,b);case UNARY:return this.VisitUnary(a,b);case INCDEC:return this.VisitIncDec(a,b);case EQUALITY:return this.VisitEquality(a,b);case DECISION:return this.VisitDecision(a,b);case METHODCALL:return this.VisitMethodCall(a,b);case NEW:return this.VisitNew(a,b);case JSONASSIGN:return this.VisitJsonAssign(a,b);case ARRAYACCESS:return this.VisitArrayAccess(a,b);default:Guard.raise("Type isn't implemented: "+a.type)}},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right&&c.executable&&d.executable==a.executable?a:$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(c.executable&&d.executable,a.operator,c,d)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b);return c===a.operand?a:$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(c.executable,a.operator,c)},VisitIncDec:function(a,b){var c=this.Visit(a.operand,b);return c===a.operand?a:$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(c.executable,a.operator,c,a.suffix)},VisitEquality:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right&&c.executable&&d.executable==a.executable?a:$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(c.executable&&d.executable,a.operator,c,d)},VisitDecision:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.left,b),e=this.Visit(a.right,b);return c===a.expression&&d===a.left&&e===a.right&&d.executable&&e.executable&&c.executable==a.executable?a:$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(d.executable&&e.executable&&c.executable,c,d,e)},VisitMethodCall:function(a,b){var c=a.object?this.Visit(a.object,b):null,d=this.VisitArray(a.args,b);return c===a.object&&d===a.args&&(null==c?!0:c.executable)==a.executable?a:$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(null==c?!0:c.executable,c,a.method,d)},VisitNew:function(a,b){var c=this.VisitArray(a.values,b);return c===a.values?a:$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(!0,c)},VisitJsonAssign:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right?a:(c.JSONASSIGN=!0,d.JSONASSIGN=!0,$data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(!0,c,d))},VisitArrayAccess:function(a,b){var c=this.Visit(a.array,b),d=this.Visit(a.index,b);return c===a.array&&d===a.index?a:$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(!0,c,d)},VisitArray:function(a,b){for(var c=[],d=!0,e=0;e<a.length;e++)c[e]=this.Visit(a[e],b),d=d&&c[e]===a[e];return d?a:c},VisitLiteral:function(a){return{type:a.type,executable:!0,value:a.value,valueType:a.valueType}},VisitVariable:function(a,b){return void 0==typeof b.paramContext[a.name]&&Guard.raise("Variable is not defined in the paramContext: "+a.name),$data.Expressions.ExpressionNodeTypes.VariableExpressionNode.create(!0,"Math","GLOBALOBJECT")},VisitMember:function(a,b){var c=this.GetMemberChain(a),d=c[0].name,e=b.lambdaParams.indexOf(d)>=0,f=d==b.paramsName;return f||e||Guard.raise("Variable is not defined in the paramContext or the lambda parameters: "+d),$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(f,a.expression,a.member)}},null),$data.Class.define("$data.Expressions.ExecutorVisitor",$data.Expressions.ExpTreeVisitor,null,{VisitVariable:function(a,b){if(!a.executable)return a;var c=a.name==b.paramsName?b.paramContext:window[a.name];return"undefined"==typeof c&&Guard.raise(new Exception("Unknown variable in '"+b.operation+"' operation. The variable isn't referenced in the parameter context and it's not a global variable: '"+a.name+"'.","InvalidOperation",{operationName:b.operation,missingParameterName:a.name})),$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,typeof c,c)},VisitMember:function(a,b){if(!a.executable)return a;for(var c,d=this.GetMemberChain(a),e=0;e<d.length;e++)c=0==e?b.paramContext:c[d[e].name];return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,typeof c,c)},VisitUnary:function(eNode,context){var operand=this.Visit(eNode.operand,context);if(operand!==eNode.operand&&(eNode=$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(eNode.executable,eNode.operator,operand)),!eNode.executable)return eNode;var value,src,operandValue="string"==operand.valueType?"'"+operand.value+"'":operand.value;return src="value = "+eNode.operator+" "+operandValue,eval(src),$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,typeof value,value)},VisitIncDec:function(a,b){var c=this.Visit(a.operand,b);if(c!==a.operand&&(a=$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(a.executable,a.operator,c,a.suffix)),!a.executable)return a;var d;return d=a.suffix?"++"==a.operator?c.value++:c.value--:"++"==a.operator?++c.value:--c.value,$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,typeof d,d)},VisitBinary:function(eNode,context){var left=this.Visit(eNode.left,context),right=this.Visit(eNode.right,context);if((left!==eNode.left||right!==eNode.right)&&(eNode=$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(eNode.executable,eNode.operator,left,right)),!eNode.executable)return eNode;var value,src,leftValue="string"==left.valueType?"'"+left.value+"'":left.value,rightValue="string"==right.valueType?"'"+right.value+"'":right.value;return src="value = "+leftValue+" "+eNode.operator+" "+rightValue,eval(src),$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,typeof value,value)},VisitEquality:function(eNode,context){var left=this.Visit(eNode.left,context),right=this.Visit(eNode.right,context);if((left!==eNode.left||right!==eNode.right)&&(eNode=$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(eNode.executable,eNode.operator,left,right)),!eNode.executable)return eNode;var value,src,leftValue="string"==left.valueType?"'"+left.value+"'":left.value,rightValue="string"==right.valueType?"'"+right.value+"'":right.value;return src="value = "+leftValue+" "+eNode.operator+" "+rightValue,eval(src),$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,typeof value,value)},VisitDecision:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.left,b),e=this.Visit(a.right,b);if((c!==a.expression||d!==a.left||e!==a.right)&&(a=$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(a.executable,c,d,e)),!a.executable)return a;var f=c.value?d.value:e.value;return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,typeof f,f)},VisitMethodCall:function(eNode,context){var object=eNode.object?this.Visit(eNode.object,context):null,args=this.VisitArray(eNode.args,context);if((object!==eNode.object||args!=eNode.args)&&(eNode=$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(eNode.executable,object,eNode.method,args)),!eNode.executable)return eNode;for(var a=[],i=0;i<args.length;i++){var arg=args[i],t=typeof arg.value;a.push("string"==t?"'"+arg.value+"'":arg.value)}var value,src=object?"value = object.value[eNode.method]("+a.join(",")+");":"value = "+eNode.method+"("+a.join(",")+");";return eval(src),$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,typeof value,value)},VisitArrayAccess:function(a,b){var c=this.Visit(a.array,b),d=this.Visit(a.index,b),e=c.value[d.value];return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,typeof e,e)}},null),$data.Class.define("$data.Expressions.ExpressionBuilder",null,null,{constructor:function(a){this.context=a},_isLambdaParam:function(a){for(var b=this.context.lambdaParams,c=0;c<b.length;c++)if(b[c]==a)return!0;return!1},_isParam:function(a){return void 0!=this.context.paramContext[a]},_isParamRoot:function(a){return this.context.paramsName==a},Build:function(a,b){var c;switch(a.arity){case"infix":"("==a.value?c=this.BuildMethodCall(a,b):"."==a.value?c=this.BuildMember(a,b):["===","==","!==","!=",">","<",">=","<="].indexOf(a.value)>=0?c=this.BuildEquality(a,b):["&&","||"].indexOf(a.value)>=0?c=this.BuildBinary(a,b):["+","-","*","/","%"].indexOf(a.value)>=0?c=this.BuildBinary(a,b):"["==a.value?c=this.BuildArrayAccess(a,b):Guard.raise("Value of infix node isn't implemented: "+a.value);break;case"prefix":["+","-","!"].indexOf(a.value)>=0?c=this.BuildUnary(a,b):["++","--"].indexOf(a.value)>=0?c=this.BuildIncDec(a,b):"{"==a.value?c=this.BuildNewExpression(a,b):Guard.raise("Value of prefix node isn't implemented: "+a.value);break;case"suffix":["++","--"].indexOf(a.value)>=0?c=this.BuildIncDec(a,b):Guard.raise("Value of suffix node isn't implemented: "+a.value);break;case"string":case"number":c=this.BuildLiteral(a,b);break;case"ternary":"?"==a.value?c=this.BuildDecision(a,b):Guard.raise("Value of ternary node isn't implemented: "+a.value);break;case null:case void 0:c="boolean"!=a.type||"true"!=a.value&&"false"!=a.value?this.BuildVariable(a,b):this.BuildBoolLiteral(a,b);break;default:Guard.raise("Arity isn't implemented: "+a.arity)}return c},BuildNewExpression:function(a){for(var b=$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(!0,[]),c=a.first,d=0;d<c.length;d++)b.values.push(this.Build(c[d],b));return b},BuildLiteral:function(a){return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,a.arity,a.value)},BuildBoolLiteral:function(a){return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,a.type,"true"==a.value?!0:!1)},BuildVariable:function(a,b){if(!a.first){if(b.type==MEMBERACCESS){var c;c=this._isLambdaParam(a.value)?"LAMBDAPARAM":this._isParamRoot(a.value)?"PARAMETERROOT":this._isParam(a.value)?"PARAMETER":"PROPERTY"}else this._isLambdaParam(a.value)?c="LAMBDAPARAM":this._isParamRoot(a.value)?c="PARAMETERROOT":this._isParam(a.value)?c="PARAMETER":void 0!=window[a.value]?c="GLOBALOBJECT":Guard.raise(new Exception("Unknown variable in '"+this.context.operation+"' operation. The variable isn't referenced in the parameter context and it's not a global variable: '"+a.value+"'.","InvalidOperation",{operationName:this.context.operation,missingParameterName:a.value}));return $data.Expressions.ExpressionNodeTypes.VariableExpressionNode.create(!0,a.value,c)}var d=$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,"name",a.value),e=$data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(!0),f=this.Build(a.first,e);return e.left=d,e.right=f,d.JSONASSIGN=!0,f.JSONASSIGN=!0,e},BuildMember:function(a){if("."!=a.value||"infix"!=a.arity)return"string"==a.type?$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,a.arity,a.value):$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(!0,null,a.value);var b=$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(!0),c=this.Build(a.first,b),d=this.Build(a.second,b);return b.expression=c,b.member=d,b},BuildUnary:function(a){var b=$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(!0,a.value);return b.operand=this.Build(a.first,b),b},BuildIncDec:function(a){var b=$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(!0,a.value,null,"suffix"==a.arity);return b.operand=this.Build(a.first,b),b},BuildBinary:function(a){a.first||Guard.raise("Cannot build binary: node.first is null"),a.second||Guard.raise("Cannot build binary: node.second is null");var b=$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(!0,a.value);return b.left=this.Build(a.first,b),b.right=this.Build(a.second,b),b},BuildEquality:function(a){var b=$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(!0,a.value);return b.left=this.Build(a.first,b),b.right=this.Build(a.second,b),b},BuildDecision:function(a){var b=$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(!0);return b.expression=this.Build(a.first,b),b.left=this.Build(a.second,b),b.right=this.Build(a.third,b),b},BuildMethodCall:function(a){var b=$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(!0);"function"==a.first.type?(b.object=this.Build(a.first.first,b),b.method=a.first.second.value):(null!=a.first.type&&Guard.raise("Cannot build MethodCall because type is "+type),b.object=null,b.method=a.first.value);for(var c=a.second,d=[],e=0;e<c.length;e++){var f=c[e];d[e]=this.Build(f,b)}return b.args=d,b},BuildArrayAccess:function(a){var b=$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(!0);return b.array=this.Build(a.first,b),b.index=this.Build(a.second,b),b}},null),$C("$data.Expressions.AssociationInfoExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.associationInfo=a},nodeType:{value:$data.Expressions.ExpressionType.AssociationInfo,enumerable:!0}}),$C("$data.Expressions.CodeExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){Container.resolveType(Container.getTypeName(a))==$data.String&&"function"!=a.replace(/^[\s\xA0]+/,"").match("^function")&&(a="function (it) { return "+a+"; }"),this.source=a,this.parameters=b},nodeType:{value:$data.Expressions.ExpressionType.Code,enumerable:!0}}),$C("$data.Expressions.CodeToEntityConverter",$data.Expressions.ExpressionVisitor,null,{constructor:function(a){this.scopeContext=a,this.parameters=[]},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);if(!(c instanceof $data.Expressions.ConstantExpression)&&d instanceof $data.Expressions.ConstantExpression||!(d instanceof $data.Expressions.ConstantExpression)&&c instanceof $data.Expressions.ConstantExpression){var e,f;d instanceof $data.Expressions.ConstantExpression?(e=c,f=d):(e=d,f=c);var g;if(((g=e.selector)instanceof $data.Expressions.MemberInfoExpression||(g=e.operation)instanceof $data.Expressions.MemberInfoExpression)&&g.memberDefinition&&(g.memberDefinition.type||g.memberDefinition.dataType)){var h=Container.resolveType(g.memberDefinition.type||g.memberDefinition.dataType),i=Container.resolveType(f.type);if(h!==i){var j=f.value;if(a.operator===$data.Expressions.ExpressionType.In)if(Array.isArray(j)){for(var k=[],l=0;l<j.length;l++)k.push(new $data.Expressions.ConstantExpression(j[l],h));j=k,h=$data.Array}else h=i;d===f?d=new $data.Expressions.ConstantExpression(j,h,d.name):c=new $data.Expressions.ConstantExpression(j,h,c.name)}}}var m=this.scopeContext.resolveBinaryOperator(a.nodeType,a,b.frameType),n=Container.createSimpleBinaryExpression(c,d,a.nodeType,a.operator,a.type,m);return n},VisitUnary:function(a,b){var c=this.Visit(a.operand,b),d=this.scopeContext.resolveUnaryOperator(a.nodeType,a,b.frameType),e=Container.createUnaryExpression(c,a.operator,a.nodeType,d);return e},VisitParameter:function(a,b){Guard.requireValue("context",b);var c=$data.Expressions.ExpressionType;switch(a.nodeType){case c.LambdaParameterReference:var d=Container.createEntityExpression(b.lambdaParameters[a.paramIndex],{lambda:a.name});return d;case c.LambdaParameter:break;default:Guard.raise("Global parameter "+a.name+" not found. For query parameters use 'this.field' notation")}},VisitThis:function(a,b){var c=this.parameters.push({name:"",value:void 0})-1,d=Container.createQueryParameterExpression("",c,b.queryParameters,void 0);return d},VisitFunction:function(){var a=$data.Expressions.ExpressionVisitor.prototype.VisitFunction.apply(this,arguments);return a.body},VisitCall:function(a,b){var c,d=this,e=this.Visit(a.expression,b),f=this.Visit(a.member,b),g=a.args.map(function(a){return d.Visit(a,b)});switch(!0){case e instanceof $data.Expressions.QueryParameterExpression:var h=g.map(function(a){return a.value});return c=a.implementation(e.value,f.value,h),Container.createQueryParameterExpression(e.name+"$"+f.value,e.index,c,typeof c);case e instanceof $data.Expressions.EntityFieldExpression:case e instanceof $data.Expressions.EntityFieldOperationExpression:var i=this.scopeContext.resolveFieldOperation(f.value,e,b.frameType);return i||Guard.raise("Unknown entity field operation: "+f.getJSON()),f=Container.createMemberInfoExpression(i),c=Container.createEntityFieldOperationExpression(e,f,this._resolveFunctionArguments(g,i.parameters));case e instanceof $data.Expressions.EntitySetExpression:var i=this.scopeContext.resolveSetOperations(f.value,e,b.frameType);return i||Guard.raise("Unknown entity field operation: "+f.getJSON()),f=Container.createMemberInfoExpression(i),c=Container.createFrameOperationExpression(e,f,this._resolveFunctionArguments(g,i.parameters));case e instanceof $data.Expressions.EntityExpression:var i=this.scopeContext.resolveTypeOperations(f.value,e,b.frameType);return i||Guard.raise("Unknown entity function operation: "+f.getJSON()),f=Container.createMemberInfoExpression(i),c=Container.createEntityFunctionOperationExpression(e,f,this._resolveFunctionArguments(g,i.method.params));case e instanceof $data.Expressions.EntityContextExpression:var i=this.scopeContext.resolveContextOperations(f.value,e,b.frameType);return i||Guard.raise("Unknown entity function operation: "+f.getJSON()),f=Container.createMemberInfoExpression(i),c=Container.createContextFunctionOperationExpression(e,f,this._resolveFunctionArguments(g,i.method.params));default:Guard.raise("VisitCall: Only fields can have operations: "+a.getType().name)}},_resolveFunctionArguments:function(a,b){return b&&(b=b.filter(function(a){return"@expression"!==a.name})),1===a.length&&a[0]instanceof $data.Expressions.ConstantExpression&&"object"==typeof a[0].value&&a[0].value&&b&&b[0]&&a[0].value.constructor===$data.Object&&b.some(function(b){return b.name in a[0].value})?b.map(function(b){var c=b.type||b.dataType||a[0].type;return new $data.Expressions.ConstantExpression(a[0].value[b.name],Container.resolveType(c),b.name)}):a.map(function(a,c){if(a instanceof $data.Expressions.ConstantExpression&&b&&b[c]){var d=b[c].type||b[c].dataType||a.type;return new $data.Expressions.ConstantExpression(a.value,Container.resolveType(d),b[c].name)}return a})},VisitProperty:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b);switch(Guard.requireType("member",d,$data.Expressions.ConstantExpression),c.expressionType){case $data.Expressions.EntityExpression:var e=c.getMemberDefinition(d.value);e||Guard.raise(new Exception("Unknown member: "+d.value,"MemberNotFound"));var f,g,h=e.storageModel.PhysicalType.memberDefinitions.getMember(e.name);switch(h.kind){case"property":return g=Container.createMemberInfoExpression(e),f=Container.createEntityFieldExpression(c,g);case"navProperty":var i=e.storageModel.Associations[e.name],j=Container.createEntitySetExpression(c,Container.createAssociationInfoExpression(i));if("*"!==i.ToMultiplicity){var k=Container.createEntityExpression(j,{});return k}return j;case"complexProperty":return g=Container.createMemberInfoExpression(e),f=Container.createComplexTypeExpression(c,g)}case $data.Expressions.ComplexTypeExpression:var l=c.getMemberDefinition(d.value);l||Guard.raise("Unknown member "+d.value+" on "+c.entityType.name);var m,n=Container.createMemberInfoExpression(l);return m=Container.isPrimitiveType(Container.resolveType(l.dataType))?Container.createEntityFieldExpression(c,n):Container.createComplexTypeExpression(c,n);case $data.Expressions.QueryParameterExpression:var o=a.implementation(c.value,d.value);return this.parameters[c.index].name+="$"+d.value,this.parameters[c.index].value=o,Container.createQueryParameterExpression(c.name+"$"+d.value,c.index,o,Container.getTypeName(o));case $data.Expressions.EntityFieldExpression:case $data.Expressions.EntityFieldOperationExpression:var p=this.scopeContext.resolveFieldOperation(d.value,c,b.frameType);return p||Guard.raise("Unknown entity field operation: "+d.getJSON()),d=Container.createMemberInfoExpression(p),m=Container.createEntityFieldOperationExpression(c,d,[]);default:Guard.raise("Unknown expression type to handle: "+c.expressionType.name)}}}),$C("$data.Expressions.ComplexTypeExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){Guard.requireType("source",a,[$data.Expressions.EntityExpression,$data.Expressions.ComplexTypeExpression]),Guard.requireType("selector",b,[$data.Expressions.EntityExpression,$data.Expressions.MemberInfoExpression]),this.source=a,this.selector=b;var c=a.entityType.getMemberDefinition(b.memberName).dataType,d=Container.resolveType(c);this.entityType=d},getMemberDefinition:function(a){return this.entityType.getMemberDefinition(a)},nodeType:{value:$data.Expressions.ExpressionType.Com}}),$C("$data.Expressions.EntityContextExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.instance=a},instance:{enumerable:!1},nodeType:{value:$data.Expressions.ExpressionType.EntityContext,enumerable:!0}}),$C("$data.Expressions.EntityExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){Guard.requireValue("source",a),Guard.requireValue("selector",b),a instanceof $data.Expressions.EntitySetExpression||a instanceof $data.Expressions.ServiceOperationExpression||Guard.raise("Only EntitySetExpressions can be the source for an EntityExpression"),this.source=a,this.selector=b,this.entityType=this.source.elementType,this.storageModel=this.source.storageModel,Guard.requireValue("entityType",this.entityType),Guard.requireValue("storageModel",this.storageModel)},getMemberDefinition:function(a){var b=this.entityType.getMemberDefinition(a);return b||Guard.raise(new Exception("Unknown member "+a+" on type "+this.entityType.name,"MemberNotFound")),b.storageModel=this.storageModel,b},nodeType:{value:$data.Expressions.ExpressionType.Entity}}),$C("$data.Expressions.EntityExpressionVisitor",null,null,{constructor:function(){this.lambdaTypes=[]},canVisit:function(a){return a instanceof $data.Expressions.ExpressionNode},Visit:function(a,b){if(!this.canVisit(a))return a;var c="Visit"+a.getType().name;if(c in this){var d=this[c],e=d.call(this,a,b);return"undefined"==typeof e?a:e}return a},VisitToArrayExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createToArrayExpression(c):a},VisitForEachExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createForEachExpression(c):a},VisitMemberInfoExpression:function(a){return a},VisitSingleExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createSingleExpression(c):a},VisitFirstExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createFirstExpression(c):a},VisitSomeExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createSomeExpression(c):a},VisitFindExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createFindExpression(c):a},VisitEveryExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createEveryExpression(c):a},VisitCountExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createCountExpression(c):a},VisitBatchDeleteExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createBatchDeleteExpression(c):a},VisitObjectLiteralExpression:function(a,b){for(var c=a.members.map(function(a){return this.Visit(a,b)},this),d=!0,e=0;e<a.members.length;e++)d=d&&a.members[e]===c[e];return d?a:Container.createObjectLiteralExpression(c)},VisitObjectFieldExpression:function(a,b){var c=this.Visit(a.expression,b);return a.expression!==c?Container.createObjectFieldExpression(a.fieldName,c):a},VisitIncludeExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createIncludeExpression(c,a.selector):a},VisitUnaryExpression:function(a,b){var c=this.Visit(a.operand,b);return a.operand!==c?Container.createUnaryExpression(c,a.operator,a.nodeType,a.resolution):a},VisitSimpleBinaryExpression:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c!==a.left||d!==a.right?new $data.Expressions.SimpleBinaryExpression(c,d,a.nodeType,a.operator,a.type,a.resolution):a},VisitEntityContextExpression:function(a){return a},VisitCodeExpression:function(a){return a},VisitComplexTypeExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);if(c!==a.source||d!==a.selector){var e=Container.createComplexTypeExpression(c,d);return e}return a},VisitEntityExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);if(c!==a.source||d!==a.selector){var e=Container.createEntityExpression(c,d);return e}return a},VisitEntityFieldExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);if(c!==a.source||d!==a.selector){var e=Container.createEntityFieldExpression(c,d);return e}return a},VisitEntityFieldOperationExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.operation,b),e=a.parameters.map(function(a){return this.Visit(a)},this),f=Container.createEntityFieldOperationExpression(c,d,e);return f},VisitParametricQueryExpression:function(a,b){var c=this.Visit(a.expression,b),d=a.parameters.map(function(a){return this.Visit(a)},this),e=Container.createParametricQueryExpression(c,d);return e},VisitEntitySetExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createEntitySetExpression(c,d,a.params,a.instance):a},VisitInlineCountExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createInlineCountExpression(c,d,a.params,a.instance):a},VisitFilterExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createFilterExpression(c,d,a.params,a.instance):a},VisitProjectionExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);if(c!==a.source||d!==a.selector){var e=Container.createProjectionExpression(c,d,a.params,a.instance);return e.projectionAs=a.projectionAs,e}return a},VisitOrderExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createOrderExpression(c,d,a.nodeType):a},VisitPagingExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.amount,b);return c!==a.source||d!==a.amount?Container.createPagingExpression(c,d,a.nodeType):a}}),$C("$data.Expressions.ExpressionMonitor",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){this.Visit=function(b,c){var d,e=b;this.canVisit(b)&&(a.VisitExpressionNode&&a.VisitExpressionNode.apply(a,arguments),d="Visit"+b.getType().name,d in a&&(e=a[d].apply(a,arguments)));var f=arguments;if(e!==b&&(f=[e,c]),e=$data.Expressions.EntityExpressionVisitor.prototype.Visit.apply(this,f),f=[e,c],this.canVisit(e)){var g=e.getType().name;a.MonitorExpressionNode&&a.MonitorExpressionNode.apply(a,f),d="Monitor"+g,d in a&&a[d].apply(a,f),a.MutateExpressionNode&&a.MutateExpressionNode.apply(a,f),d="Mutate"+g,d in a&&(e=a[d].apply(a,f))
}return e}}}),$C("$data.Expressions.EntityFieldExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){this.selector=b,this.source=a,(this.selector instanceof $data.Expressions.MemberInfoExpression||this.selector.name)&&(this.memberName=this.selector.name)},nodeType:{value:$data.Expressions.ExpressionType.EntityField}}),$C("$data.Expressions.EntityFieldOperationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.source=a,this.operation=b,this.parameters=c},nodeType:{value:$data.Expressions.ExpressionType.EntityFieldOperation}}),$C("$data.Expressions.EntitySetExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c,d){function e(){for(var b=a;b;){if(b instanceof $data.Expressions.EntityContextExpression)return b;b=b.source}}Guard.requireType("source",a,[$data.Expressions.EntityContextExpression,$data.Expressions.EntitySetExpression]),Guard.requireType("selector",a,[$data.Expressions.MemberInfoExpression,$data.Expressions.CodeExpression,$data.Expressions.ParametricQueryExpression]),this.source=a,this.selector=b,this.params=c,this.instance=d,this.storage_type={};var f=e();switch(!0){case this.source instanceof $data.Expressions.EntityContextExpression:Guard.requireType("selector",b,$data.Expressions.MemberInfoExpression),this.elementType=b.memberDefinition.elementType,this.storageModel=f.instance._storageModel.getStorageModel(this.elementType);break;case this.source instanceof $data.Expressions.EntityExpression:Guard.requireType("selector",b,$data.Expressions.AssociationInfoExpression),this.elementType=b.associationInfo.ToType,this.storageModel=f.instance._storageModel.getStorageModel(this.elementType);break;case this.source instanceof $data.Expressions.EntitySetExpression:this.elementType=this.source.elementType,this.storageModel=this.source.storageModel;break;case this.source instanceof $data.Expressions.ServiceOperationExpression:this.elementType=this.source.elementType,this.storageModel=this.source.storageModel;break;default:Guard.raise("take and skip must be the last expressions in the chain!")}},instance:{enumerable:!1},nodeType:{value:$data.Expressions.ExpressionType.EntitySet,enumerable:!0}}),$C("$data.Expressions.FrameOperationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.source=a,this.operation=b,this.parameters=c},nodeType:{value:$data.Expressions.ExpressionType.FrameOperation}}),$C("$data.Expressions.EntityFunctionOperationExpression",$data.Expressions.FrameOperationExpression,null,{nodeType:{value:$data.Expressions.ExpressionType.EntityFunctionOperation}}),$C("$data.Expressions.ContextFunctionOperationExpression",$data.Expressions.FrameOperationExpression,null,{nodeType:{value:$data.Expressions.ExpressionType.ContextFunctionOperation}}),$C("$data.Expressions.FilterExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){this.resultType=$data.Array},nodeType:{value:$data.Expressions.ExpressionType.Filter,enumerable:!0}}),$C("$data.Expressions.InlineCountExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){},nodeType:{value:$data.Expressions.ExpressionType.InlineCount,enumerable:!0}}),$C("$data.Expressions.FrameOperator",$data.Expressions.ExpressionNode,null,{constructor:function(){this.isTerminated=!0}}),$C("$data.Expressions.CountExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a,this.resultType=$data.Integer},nodeType:{value:$data.Expressions.ExpressionType.Count,enumerable:!0}}),$C("$data.Expressions.SingleExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a,this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Single,enumerable:!0}}),$C("$data.Expressions.FindExpression",$data.Expressions.FrameOperator,null,{constructor:function(a,b){this.source=a,this.params=b,this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Find,enumerable:!0}}),$C("$data.Expressions.FirstExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a,this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.First,enumerable:!0}}),$C("$data.Expressions.ForEachExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a,this.resultType=$data.Array},nodeType:{value:$data.Expressions.ExpressionType.ForEach,enumerable:!0}}),$C("$data.Expressions.ToArrayExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a,this.resultType=$data.Array},nodeType:{value:$data.Expressions.ExpressionType.ToArray,enumerable:!0}}),$C("$data.Expressions.SomeExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a,this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Some,enumerable:!0}}),$C("$data.Expressions.EveryExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a,this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Every,enumerable:!0}}),$C("$data.Expressions.BatchDeleteExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a,this.resultType=$data.Integer},nodeType:{value:$data.Expressions.ExpressionType.BatchDelete,enumerable:!0}}),$C("$data.Expressions.IncludeExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){},nodeType:{value:$data.Expressions.ExpressionType.Include,writable:!0},toString:function(){var a="unimplemented";return a}},null),$C("$data.Expressions.MemberInfoExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.memberDefinition=a,this.memberName=a.name},nodeType:{value:$data.Expressions.ExpressionType.MemberInfo,enumerable:!0}}),$C("$data.Expressions.OrderExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(a,b,c){this.nodeType=c},nodeType:{value:$data.Expressions.ExpressionType.OrderBy,writable:!0},toString:function(){var a="unimplemented";return a}},null),$C("$data.Expressions.ParametricQueryExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){this.expression=a,this.parameters=b||[]},nodeType:{value:$data.Expressions.ExpressionType.ParametricQuery,enumerable:!0}}),$C("$data.Expressions.ProjectionExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){},nodeType:{value:$data.Expressions.ExpressionType.Projection,enumerable:!0}}),$C("$data.Expressions.QueryExpressionCreator",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){Guard.requireValue("scopeContext",a),this.scopeContext=a},VisitEntitySetExpression:function(a){return a.source instanceof $data.Expressions.EntityContextExpression&&this.lambdaTypes.push(a),a},VisitServiceOperationExpression:function(a){return a.source instanceof $data.Expressions.EntityContextExpression&&this.lambdaTypes.push(a),a},VisitCodeExpression:function(a,b){var c=a.source.toString(),d=Container.createCodeParser(this.scopeContext).createExpression(c);this.scopeContext.log({event:"JSCodeExpression",data:d});var e=Container.createConstantValueResolver(a.parameters,window,this.scopeContext),f=Container.createParameterResolverVisitor();d=f.Visit(d,e),this.scopeContext.log({event:"JSCodeExpressionResolved",data:d});var g=Container.createCodeToEntityConverter(this.scopeContext),h=g.Visit(d,{queryParameters:a.parameters,lambdaParameters:this.lambdaTypes,frameType:b.frameType}),i=Container.createParametricQueryExpression(h,g.parameters);return this.scopeContext.log({event:"EntityExpression",data:h}),i},VisitFilterExpression:function(a,b){var c=this.Visit(a.source,b);b=b||{},b.frameType=a.getType();var d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createFilterExpression(c,d,a.params,a.instance):a},VisitInlineCountExpression:function(a,b){var c=this.Visit(a.source,b);b=b||{},b.frameType=a.getType();var d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createInlineCountExpression(c,d,a.params,a.instance):a},VisitProjectionExpression:function(a,b){var c=this.Visit(a.source,b);b=b||{},b.frameType=a.getType();var d=this.Visit(a.selector,b);if(c!==a.source||d!==a.selector){var e=Container.createProjectionExpression(c,d,a.params,a.instance);return e.projectionAs=a.projectionAs,e}return a},VisitOrderExpression:function(a,b){var c=this.Visit(a.source,b);b=b||{},b.frameType=a.getType();var d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createOrderExpression(c,d,a.nodeType):a}}),$C("$data.Expressions.QueryParameterExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.name=a,this.index=b,this.value=c,this.type=Container.getTypeName(c)},nodeType:{value:$data.Expressions.ExpressionType.QueryParameter,writable:!1}}),$C("$data.Expressions.RepresentationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(){},getMemberDefinition:function(a){return this.entityType.getMemberDefinition(a)},nodeType:{value:$data.Expressions.ExpressionType.Entity}}),$C("$data.Expressions.ServiceOperationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c,d,e){function f(){for(var b=a;b;){if(b instanceof $data.Expressions.EntityContextExpression)return b;b=b.source}}Guard.requireType("source",a,[$data.Expressions.EntityContextExpression]),Guard.requireType("selector",a,[$data.Expressions.MemberInfoExpression]),this.source=a,this.selector=b,this.params=c,this.cfg=d,this.boundItem=e;var g=f();switch(!0){case this.source instanceof $data.Expressions.EntityContextExpression:this.elementType=d.elementType?Container.resolveType(d.elementType):this.elementType?Container.resolveType(d.returnType):null,this.storageModel=d.elementType?g.instance._storageModel.getStorageModel(Container.resolveType(d.elementType)):null;break;default:Guard.raise("Unknown source type for EntitySetExpression: "+this.source.getType().name)}},nodeType:{value:$data.Expressions.ExpressionType.ServiceOperation,enumerable:!0}}),$C("$data.Expressions.ContinuationExpressionBuilder",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){this.mode=a},compile:function(a){var b={mode:"find",skipExists:!1};this.Visit(a.expression,b);var c={skip:b.skipSize,take:b.pageSize,message:""};if("pageSize"in b){var d,e={mode:this.mode,pageSize:b.pageSize};!b.skipExists&&b.pageSize?(e.append=!0,d=this.Visit(a.expression,e)):b.skipExists&&(d=this.Visit(a.expression,e)),e.abort?(c.skip=(c.skip||0)-c.take,c.message="Invalid skip value!"):c.expression=d}else c.message="take expression not defined in the chain!";return c},VisitPagingExpression:function(a,b){switch(b.mode){case"find":a.nodeType===$data.Expressions.ExpressionType.Take?b.pageSize=a.amount.value:(b.skipSize=a.amount.value,b.skipExists=!0);break;case"prev":if(a.nodeType===$data.Expressions.ExpressionType.Skip){var c=a.amount.value-b.pageSize;b.abort=0>c&&a.amount.value>=b.pageSize;var d=Container.createConstantExpression(Math.max(c,0),"number");return Container.createPagingExpression(a.source,d,a.nodeType)}b.append&&(b.abort=!0);break;case"next":if(a.nodeType===$data.Expressions.ExpressionType.Skip){var c=b.pageSize+a.amount.value,d=Container.createConstantExpression(c,"number");return Container.createPagingExpression(a.source,d,a.nodeType)}if(b.append){var d=Container.createConstantExpression(b.pageSize,"number");return Container.createPagingExpression(a,d,$data.Expressions.ExpressionType.Skip)}}this.Visit(a.source,b)}}),$data.Class.define("$data.Validation.ValidationError",null,null,{constructor:function(a,b,c){this.Message=a,this.PropertyDefinition=b,this.Type=c},Type:{dataType:"string"},Message:{dataType:"string"},PropertyDefinition:{dataType:$data.MemberDefinition}},null),$data.Class.define("$data.Validation.EntityValidationBase",null,null,{ValidateEntity:function(){return[]},ValidateEntityField:function(){return[]},getValidationValue:function(){Guard.raise("Pure class")},getValidationMessage:function(){Guard.raise("Pure class")}},null),$data.Validation=$data.Validation||{},$data.Validation.Entity=new $data.Validation.EntityValidationBase,$data.Class.define("$data.Validation.Defaults",null,null,null,{validators:{value:{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||"function"==typeof b?b(a):!0},minValue:function(a,b){return Object.isNullOrUndefined(a)||a>=b},maxValue:function(a,b){return Object.isNullOrUndefined(a)||b>=a},minLength:function(a,b){return Object.isNullOrUndefined(a)||a.length>=b},maxLength:function(a,b){return Object.isNullOrUndefined(a)||a.length<=b},length:function(a,b){return Object.isNullOrUndefined(a)||a.length==b},regex:function(a,b){return Object.isNullOrUndefined(a)||a.match("string"==typeof b?new RegExp(0===b.indexOf("/")&&b.lastIndexOf("/")===b.length-1?b.slice(1,-1):b):b)}}},_getGroupValidations:function(a){var b={};if(Array.isArray(a))for(var c=0;c<a.length;c++){var d=a[c];"function"==typeof this.validators[d]&&(b[d]=this.validators[d])}return b}}),$data.Class.define("$data.Validation.EntityValidation",$data.Validation.EntityValidationBase,null,{ValidateEntity:function(a){var b=[];return a.getType().memberDefinitions.getPublicMappedProperties().forEach(function(c){b=b.concat(this.ValidateEntityField(a,c,void 0,!0))},this),b},ValidateEntityField:function(a,b,c,d){var e=[],f=Container.resolveType(b.dataType),g=Container.resolveName(f),h=d?a[b.name]:c;return!b.inverseProperty&&f&&"function"==typeof f.isAssignableTo&&f.isAssignableTo($data.Entity)&&(g=$data.Entity.fullName),this.fieldValidate(a,b,h,e,g),e},getValidationValue:function(a,b){var c;if(c=a[b]&&a[b].value?a[b].value:a[b],this.convertableValidation[b]){var d;d=this.convertableValidation[b]===!0?a.type:this.convertableValidation[b],d&&(c=Container.convertTo(c,d,a.elementType))}return c},getValidationMessage:function(a,b,c){var d=c;return"object"==typeof a[b]&&a[b].message?d=a[b].message:a.errorMessage&&(d=a.errorMessage),d},createValidationError:function(a,b,c){return new $data.Validation.ValidationError(this.getValidationMessage(a,b,c),a,b)},convertableValidation:{value:{required:"$data.Boolean",minValue:!0,maxValue:!0,minLength:"$data.Integer",maxLength:"$data.Integer",length:"$data.Integer"}},supportedValidations:{value:{"$data.ObjectID":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.Byte":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.SByte":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Decimal":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Float":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Number":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Int16":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Integer":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Int32":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Int64":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.String":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minLength","maxLength","length","regex"]),"$data.Date":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.DateTimeOffset":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Time":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Boolean":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.Array":$data.Validation.Defaults._getGroupValidations(["required","customValidator","length"]),"$data.Object":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.Guid":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.Blob":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minLength","maxLength","length"]),"$data.GeographyPoint":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyLineString":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyPolygon":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyMultiPoint":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyMultiLineString":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyMultiPolygon":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyCollection":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryPoint":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryLineString":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryPolygon":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryMultiPoint":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryMultiLineString":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryMultiPolygon":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryCollection":$data.Validation.Defaults._getGroupValidations(["required","customValidator"])}},fieldValidate:function(a,b,c,d,e){if(!(a.entityState==$data.EntityState.Modified&&a.changedProperties&&a.changedProperties.indexOf(b)<0)){var f=this.supportedValidations[e];if(f){var g=Object.keys(f);g.forEach(function(e){b[e]&&f[e]&&!f[e].call(a,c,this.getValidationValue(b,e))&&d.push(this.createValidationError(b,e,"Validation error!"))},this),e===$data.Entity.fullName&&c instanceof $data.Entity&&!c.isValid()&&d.push(this.createValidationError(b,"ComplexProperty","Validation error!"))}}}},null),$data.Validation.Entity=new $data.Validation.EntityValidation,$data.Class.define("$data.Notifications.ChangeDistributorBase",null,null,{distributeData:function(){Guard.raise("Pure class")}},null),$data.Class.define("$data.Notifications.ChangeCollectorBase",null,null,{buildData:function(){Guard.raise("Pure class")},processChangedData:function(a){this.Distrbutor&&this.Distrbutor.distributeData&&this.Distrbutor.distributeData(this.buildData(a))},Distrbutor:{enumerable:!1,dataType:$data.Notifications.ChangeDistributorBase,storeOnObject:!0}},null),$data.Class.define("$data.Notifications.ChangeDistributor",$data.Notifications.ChangeDistributorBase,null,{constructor:function(a){this.broadcastUrl=a},distributeData:function(a){$data.ajax({url:this.broadcastUrl,type:"POST",data:"data="+JSON.stringify(a),succes:this.success,error:this.error})},broadcastUrl:{dataType:"string"},success:function(){},error:function(){}},null),$data.Class.define("$data.Notifications.ChangeCollector",$data.Notifications.ChangeCollectorBase,null,{buildData:function(a){var b=[];return a.forEach(function(a){var c={entityState:a.data.entityState,typeName:a.data.getType().name},d=[];switch(a.data.entityState){case $data.EntityState.Added:d=a.data.getType().memberDefinitions.getPublicMappedProperties();break;case $data.EntityState.Modified:d=a.data.changedProperties;break;case $data.EntityState.Deleted:d=a.data.getType().memberDefinitions.getKeyProperties()}d.forEach(function(b){c[b.name]=a.data[b.name]}),b.push(c)}),b}},null),$data.Class.define("$data.Transaction",null,null,{constructor:function(){this._objectId=(new Date).getTime(),$data.Trace.log("create: ",this._objectId),this.oncomplete=new $data.Event("oncomplete",this),this.onerror=new $data.Event("onerror",this)},abort:function(){Guard.raise(new Exception("Not Implemented","Not Implemented",arguments))},_objectId:{type:$data.Integer},transaction:{type:$data.Object},oncomplete:{type:$data.Event},onerror:{type:$data.Event}},null),$data.Class.define("$data.Access",null,null,{},{isAuthorized:function(a,b,c,d){var e=new $data.PromiseHandler,f=e.createCallback(d),g=e.getPromise();return f.success(!0),g},getAccessBitmaskFromPermission:function(a){var b=$data.Access.None;return a.Create&&(b|=$data.Access.Create),a.Read&&(b|=$data.Access.Read),a.Update&&(b|=$data.Access.Update),a.Delete&&(b|=$data.Access.Delete),a.DeleteBatch&&(b|=$data.Access.DeleteBatch),a.Execute&&(b|=$data.Access.Execute),b},None:{value:0},Create:{value:1},Read:{value:2},Update:{value:4},Delete:{value:8},DeleteBatch:{value:16},Execute:{value:32}}),$data.Class.define("$data.Promise",null,null,{always:function(){Guard.raise(new Exception("$data.Promise.always","Not implemented!"))},done:function(){Guard.raise(new Exception("$data.Promise.done","Not implemented!"))},fail:function(){Guard.raise(new Exception("$data.Promise.fail","Not implemented!"))},isRejected:function(){Guard.raise(new Exception("$data.Promise.isRejected","Not implemented!"))},isResolved:function(){Guard.raise(new Exception("$data.Promise.isResolved","Not implemented!"))},pipe:function(){Guard.raise(new Exception("$data.Promise.pipe","Not implemented!"))},progress:function(){Guard.raise(new Exception("$data.Promise.progress","Not implemented!"))},promise:function(){Guard.raise(new Exception("$data.Promise.promise","Not implemented!"))},state:function(){Guard.raise(new Exception("$data.Promise.state","Not implemented!"))},then:function(){Guard.raise(new Exception("$data.Promise.then","Not implemented!"))}},null),$data.Class.define("$data.PromiseHandlerBase",null,null,{constructor:function(){},createCallback:function(a){return a=$data.typeSystem.createCallbackSetting(a),cbWrapper={success:a.success,error:a.error,notify:a.notify}},getPromise:function(){return new $data.Promise}},null),$data.PromiseHandler=$data.PromiseHandlerBase;var EventSubscriber=$data.Class.define("EventSubscriber",null,null,{constructor:function(a,b,c){this.handler=a,this.state=b,this.thisArg=c},handler:{},state:{},thisArg:{}});$data.Event=Event=$data.Class.define("$data.Event",null,null,{constructor:function(a,b){function c(a,b){a.forEach(function(c,d){c.handler==b&&a.splice(d,1)})}var d=null;this.attach=function(a,c,e){d||(d=[]),d.push(new EventSubscriber(a,c,e||b))},this.detach=function(a){c(d,a)},this.fire=function(a,c){var e=c||b||this;d&&d.forEach(function(b){try{b.handler.call(b.thisArg,e,a,b.state)}catch(c){console.log("unhandled exception in event handler. exception suppressed"),console.dir(c)}})},this.fireCancelAble=function(a,c){var e=c||b||this,f=!0;return d&&d.forEach(function(b){try{f=f&&(b.handler.call(b.thisArg,e,a,b.state)===!1?!1:!0)}catch(c){console.log("unhandled exception in event handler. exception suppressed"),console.dir(c)}}),f}}});var eventData=$data.Class.define("EventData",null,null,{eventName:{}}),PropertyChangeEventData=$data.Class.define("PropertyChangeEventData",EventData,null,{constructor:function(a,b,c){this.propertyName=a,this.oldValue=b,this.newValue=c},propertyName:{},oldValue:{},newValue:{}}),PropertyValidationEventData=$data.Class.define("PropertyValidationEventData",EventData,null,{constructor:function(a,b,c,d){this.propertyName=a,this.oldValue=b,this.newValue=c,this.errors=d,this.cancel=!1},propertyName:{},oldValue:{},newValue:{},errors:{},cancel:{}});$data.Entity=Entity=$data.Class.define("$data.Entity",null,null,{constructor:function(a,b){this.initData={};var c=this.getType();c.__copyPropertiesToInstance&&$data.typeSystem.writePropertyValues(this);var d=null;if(this.context=d,"setDefaultValues"in c&&(b&&b.setDefaultValues===!1||(!a||Object.keys(a).length<1)&&(a=c.setDefaultValues(a))),"object"==typeof a){var e=c.memberDefinitions,f=e.getPublicMappedPropertyNames();for(var g in a)if(f.indexOf(g)>-1){var h=e.getMember(g),i=Container.resolveType(h.type),j=a[g];if(h.concurrencyMode===$data.ConcurrencyMode.Fixed)this.initData[g]=j;else{if(b&&b.converters){var k=b.converters[Container.resolveName(i)];k&&(j=k(j))}this.initData[g]=Container.convertTo(j,i,h.elementType,b)}}}b&&b.entityBuilder&&b.entityBuilder(this,c.memberDefinitions.asArray(),c),this.changedProperties=void 0,this.entityState=void 0},toString:function(){return this.getType().fullName+"("+(this.Id||this.Name||"")+")"},toJSON:function(){var a={},b=this;return this.getType().memberDefinitions.getPublicMappedProperties().forEach(function(c){a[c.name]=b[c.name]instanceof Date&&c.type&&Container.resolveType(c.type)===$data.DateTimeOffset?new $data.DateTimeOffset(b[c.name]):b[c.name]}),a},equals:function(a){if(a.getType()!==this.getType())return!1;for(var b=this.getType().memberDefinitions.getKeyProperties(),c=0;c<b.length;c++)if(this[b[c].name]!=a[b[c].name])return!1;return!0},propertyChanging:{dataType:$data.Event,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,prototypeProperty:!0,get:function(){return this._propertyChanging||(this._propertyChanging=new Event("propertyChanging",this)),this._propertyChanging},set:function(a){this._propertyChanging=a}},propertyChanged:{dataType:$data.Event,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,prototypeProperty:!0,get:function(){return this._propertyChanged||(this._propertyChanged=new Event("propertyChanged",this)),this._propertyChanged},set:function(a){this._propertyChanged=a}},propertyValidationError:{dataType:$data.Event,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,prototypeProperty:!0,get:function(){return this._propertyValidationError||(this._propertyValidationError=new Event("propertyValidationError",this)),this._propertyValidationError},set:function(a){this._propertyValidationError=a}},storeProperty:function(a,b){a.concurrencyMode!==$data.ConcurrencyMode.Fixed&&(b=Container.convertTo(b,a.type,a.elementType));var c=null;if(0!=a.monitorChanges&&(this._propertyChanging||this._propertyChanged||"instancePropertyChanged"in this.constructor)){var d=this[a.name];c=new PropertyChangeEventData(a.name,d,b),this._propertyChanging&&this.propertyChanging.fire(c)}if(0!=a.monitorChanges&&(this._propertyValidationError||"instancePropertyValidationError"in this.constructor)){var e=$data.Validation.Entity.ValidateEntityField(this,a,b);if(e.length>0){var d=this[a.name],f=new PropertyValidationEventData(a.name,d,b,e);if(this._propertyValidationError&&this.propertyValidationError.fire(f),"instancePropertyValidationError"in this.constructor&&this.constructor.instancePropertyValidationError.fire(f,this),1==f.cancel)return}}if(1==a.storeOnObject){var g="_"+a.name;this[g]=b}else this.initData[a.name]=b;this.isValidated=!1,0!=a.monitorChanges&&this.entityState==$data.EntityState.Unchanged&&(this.entityState=$data.EntityState.Modified),this._setPropertyChanged(a),0!=a.monitorChanges&&(this._propertyChanged&&this.propertyChanged.fire(c),"instancePropertyChanged"in this.constructor&&this.constructor.instancePropertyChanged.fire(c,this))},_setPropertyChanged:function(a){0!=a.monitorChanges&&(this.changedProperties||(this.changedProperties=[]),this.changedProperties.some(function(b){return b.name==a.name})||this.changedProperties.push(a))},retrieveProperty:function(a){if(1==a.storeOnObject){var b="_"+a.name;return this[b]}return this.initData[a.name]},getProperty:function(a,b,c){if(b=$data.typeSystem.createCallbackSetting(b),void 0!=this[a.name])return void(c instanceof $data.Transaction?b.success(this[a.name],c):b.success(this[a.name]));var d=this.context;if(this.context)return d.loadItemProperty(this,a,b,c);try{var e=this,f=this.storeToken||this.getType().storeToken;if(f&&"function"==typeof f.factory){var g=f.factory();return g.onReady().then(function(c){return c.loadItemProperty(e,a,b)})}}catch(h){}Guard.raise(new Exception("Entity not in context","Invalid operation"))},setProperty:function(a,b,c){this[a.name]=b;var d=new $data.PromiseHandler;return c=d.createCallback(c),c.success(this[a.name]),d.getPromise()},isValid:function(){return this.isValidated||(this.ValidationErrors=$data.Validation.Entity.ValidateEntity(this),this.isValidated=!0),0==this.ValidationErrors.length},isValidated:{dataType:"bool",storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,value:!1},ValidationErrors:{dataType:Array,elementType:$data.Validation.ValidationError,storeOnObject:!0,monitorChanges:!0,notMapped:!0,enumerable:!1},resetChanges:function(){delete this._changedProperties},changedProperties:{dataType:Array,elementType:window.MemberDefinition,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1},entityState:{dataType:"integer",storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1},remove:function(){if($data.ItemStore&&"EntityInstanceRemove"in $data.ItemStore)return $data.ItemStore.EntityInstanceRemove.apply(this,arguments);throw"not implemented"},save:function(){if($data.ItemStore&&"EntityInstanceSave"in $data.ItemStore)return $data.ItemStore.EntityInstanceSave.apply(this,arguments);throw"not implemented"},refresh:function(){if($data.ItemStore&&"EntityInstanceSave"in $data.ItemStore)return $data.ItemStore.EntityInstanceRefresh.apply(this,arguments);throw"not implemented"},storeToken:{type:Object,monitorChanges:!1,notMapped:!0,storeOnObject:!0},getFieldUrl:function(a){if(this.context)return this.context.getFieldUrl(this,a);if(this.getType().storeToken&&"function"==typeof this.getType().storeToken.factory){var b=this.getType().storeToken.factory();return b.getFieldUrl(this,a)}if(this.getType().storeToken)try{var c=$data.ItemStore._getContextPromise("default",this.getType());if(c instanceof $data.EntityContext)return c.getFieldUrl(this,a)}catch(d){}return"#"}},{__setPropertyfunctions:{value:!0,notMapped:!0,enumerable:!1,storeOnObject:!0},__copyPropertiesToInstance:{value:!1,notMapped:!0,enumerable:!1,storeOnObject:!0},inheritedTypeProcessor:function(a){$data.ItemStore&&"EntityInheritedTypeProcessor"in $data.ItemStore&&$data.ItemStore.EntityInheritedTypeProcessor.apply(this,arguments),a.defaultValues={},a.memberDefinitions.asArray().forEach(function(b){b.hasOwnProperty("defaultValue")&&(a.defaultValues[b.name]=b.defaultValue)}),Object.keys(a.defaultValues).length>0&&(a.setDefaultValues=function(b,c){b=b||{};var d=a.defaultValues;for(var e in d)if(!(e in b)){var f=d[e];b[e]="function"==typeof f?d[e](e,c):d[e]}return b})},addEventListener:function(a,b){var c="on"+a;c in this||(this[c]=new $data.Event(a,this)),this[c].attach(b)},removeEventListener:function(a,b){var c="on"+a;c in this&&this[c].detach(b)},raiseEvent:function(a,b){var c="on"+a;c in this&&this[c].fire(b)},getFieldNames:function(){return this.memberDefinitions.getPublicMappedPropertyNames()},"from$data.Object":function(a,b,c,d){if(Object.isNullOrUndefined(a))return a;var e;return d&&d.converters&&(e={converters:d.converters}),new this(a,e)}}),$data.define=function(a,b,c){if(!b||b instanceof $data.ContainerClass||(c=b,b=void 0),!c)throw new Error("json object type is not supported yet");var d={},e=[];if(Object.keys(c).forEach(function(a){var b=c[a];"object"==typeof b&&("type"in b||"get"in b||"set"in b)?(d[a]=b,b.key&&e.push(b),!("get"in b||"set"in b)||"notMapped"in b&&b.notMapped!==!0||(b.notMapped=!0,b.storeOnObject=!0),"get"in b&&!("set"in b)?b.set=function(){}:"set"in b&&!("get"in b)&&(b.get=function(){})):d[a]={type:b}}),e.length<1){var f;switch(!0){case"id"in d:f="id";break;case"Id"in d:f="Id";break;case"ID"in d:f="ID"}if(f){d[f].key=!0;{$data.Container.resolveName(d[f].type)}d[f].computed=!0}else d.Id={type:"int",key:!0,computed:!0}}var g=$data.Entity.extend(a,b,d);return g},$data.implementation=function(a){return Container.resolveType(a)
},function(){$data.defaults=$data.defaults||{},$data.defaults.defaultDatabaseName="JayDataDefault"}(),$data.Class.define("$data.StorageModel",null,null,{constructor:function(){this.ComplexTypes=[],this.Associations=[]},LogicalType:{},LogicalTypeName:{},PhysicalType:{},PhysicalTypeName:{},EventHandlers:{},TableName:{},TableOptions:{value:void 0},ComplexTypes:{},Associations:{},ContextType:{},Roles:{}},null),$data.Class.define("$data.Association",null,null,{constructor:function(a){a&&(this.From=a.From,this.FromType=a.FromType,this.FromMultiplicity=a.FromMultiplicity,this.FromPropertyName=a.FromPropertyName,this.To=a.To,this.ToType=a.ToType,this.ToMultiplicity=a.ToMultiplicity,this.ToPropertyName=a.ToPropertyName)},From:{},FromType:{},FromMultiplicity:{},FromPropertyName:{},To:{},ToType:{},ToMultiplicity:{},ToPropertyName:{},ReferentialConstraint:{}},null),$data.Class.define("$data.ComplexType",$data.Association,null,{},null),$data.Class.define("$data.EntityContext",null,null,{constructor:function(a){$data.ItemStore&&"ContextRegister"in $data.ItemStore&&$data.ItemStore.ContextRegister.apply(this,arguments),a.queryCache&&(this.queryCache=a.queryCache),"string"==typeof a&&(a=0===a.indexOf("http")?{name:"oData",oDataServiceHost:a}:{name:"local",databaseName:a}),"provider"in a&&(a.name=a.provider),this.lazyLoad=!1,this.trackChanges=!1,this._entitySetReferences={},this._storageModel=[];var b=this;b._isOK=!1;var c=this._successInitProvider;if(this._successInitProvider=function(a){a instanceof $data.EntityContext?c(b):c(b,a)},this._storageModel.getStorageModel=function(a){var c=Container.resolveName(a);return b._storageModel[c]},"string"==typeof a.name){var d=a.name;a.name=[d]}var e=[].concat(a.name),f=$data.typeSystem.createCallbackSetting({success:this._successInitProvider,error:this._successInitProvider});this._initStorageModelSync(),b._initializeEntitySets(b.getType()),$data.StorageProviderLoader.load(e,{success:function(c){b.storageProvider=new c(a,b),b.storageProvider.setContext(b),b.stateManager=new $data.EntityStateManager(b);var d=b.getType();c.name in d._storageModelCache?b._storageModel=d._storageModelCache[c.name]:(b._initializeStorageModel(),d._storageModelCache[c.name]=b._storageModel),a&&a.user&&Object.defineProperty(b,"user",{value:a.user,enumerable:!0}),a&&a.checkPermission&&Object.defineProperty(b,"checkPermission",{value:a.checkPermission,enumerable:!0}),b._initializeStore(f)},error:function(){f.error("Provider fallback failed!")}}),this.addEventListener=function(a,b){var c="on"+a;c in this||(this[c]=new $data.Event(a,this)),this[c].attach(b)},this.removeEventListener=function(a,b){var c="on"+a;c in this&&this[c].detach(b)},this.raiseEvent=function(a,b){var c="on"+a;c in this&&this[c].fire(b)},this.ready=this.onReady({success:$data.defaultSuccessCallback,error:function(){$data.PromiseHandler!==$data.PromiseHandlerBase?$data.defaultErrorCallback.apply(this,arguments):$data.Trace.error(arguments)}})},beginTransaction:function(){function a(a){Object.isNullOrUndefined(a)||("boolean"==typeof a?d=a:Array.isArray(a)?b=a:c=a)}var b=null,c=null,d=!1;a(arguments[0]),a(arguments[1]),a(arguments[2]);var e=new $data.PromiseHandler;return c=e.createCallback(c),this.storageProvider._beginTran(b,d,c),e.getPromise()},_isReturnTransaction:function(a){return a instanceof $data.Base||"returnTransaction"===a},_applyTransaction:function(a,b,c,d,e){e===!0?d instanceof $data.Transaction?(Array.prototype.push.call(c,d),b.apply(a,c)):this.beginTransaction(function(d){Array.prototype.push.call(c,d),b.apply(a,c)}):b.apply(a,c)},getDataType:function(dataType){if("string"==typeof dataType){var memDef_dataType=this[dataType];return(void 0===memDef_dataType||null===memDef_dataType)&&(memDef_dataType=eval(dataType)),memDef_dataType}return dataType},_initializeEntitySets:function(a){for(var b=0,c=this._storageModel.length;c>b;b++){var d=this._storageModel[b];this[d.ItemName]=new $data.EntitySet(d.LogicalType,this,d.ItemName,d.EventHandlers,d.Roles);var e=this[d.ItemName];e.name=d.ItemName,e.tableName=d.TableName,e.tableOptions=d.TableOptions,e.eventHandlers=d.EventHandlers,this._entitySetReferences[d.LogicalType.name]=e,this._initializeActions(e,a,a.getMemberDefinition(d.ItemName))}},_initializeStore:function(a){this.storageProvider&&this.storageProvider.initializeStore(a)},_initStorageModelSync:function(){for(var a=this.getType().memberDefinitions.asArray(),b=0;b<a.length;b++){var c=a[b];if("dataType"in c){var d=Container.resolveType(c.dataType);if(d&&d.isAssignableTo&&d.isAssignableTo($data.EntitySet)){var e=Container.resolveType(c.elementType),f=new $data.StorageModel;f.TableName=c.tableName||c.name,f.TableOptions=c.tableOptions,f.ItemName=c.name,f.LogicalType=e,f.LogicalTypeName=e.name,f.PhysicalTypeName=$data.EntityContext._convertLogicalTypeNameToPhysical(f.LogicalTypeName),f.ContextType=this.getType(),f.Roles=c.roles,c.indices&&(f.indices=c.indices),c.beforeCreate&&(f.EventHandlers||(f.EventHandlers={}),f.EventHandlers.beforeCreate=c.beforeCreate),c.beforeRead&&(f.EventHandlers||(f.EventHandlers={}),f.EventHandlers.beforeRead=c.beforeRead),c.beforeUpdate&&(f.EventHandlers||(f.EventHandlers={}),f.EventHandlers.beforeUpdate=c.beforeUpdate),c.beforeDelete&&(f.EventHandlers||(f.EventHandlers={}),f.EventHandlers.beforeDelete=c.beforeDelete),c.afterCreate&&(f.EventHandlers||(f.EventHandlers={}),f.EventHandlers.afterCreate=c.afterCreate),c.afterRead&&(f.EventHandlers||(f.EventHandlers={}),f.EventHandlers.afterRead=c.afterRead),c.afterUpdate&&(f.EventHandlers||(f.EventHandlers={}),f.EventHandlers.afterUpdate=c.afterUpdate),c.afterDelete&&(f.EventHandlers||(f.EventHandlers={}),f.EventHandlers.afterDelete=c.afterDelete),this._storageModel.push(f);var g=Container.resolveName(e);this._storageModel[g]=f}}}},_initializeStorageModel:function(){this.getType().memberDefinitions.asArray();if("undefined"==typeof intellisense)for(var a=0;a<this._storageModel.length;a++){var b=this._storageModel[a],c={};b.Associations=b.Associations||[],b.ComplexTypes=b.ComplexTypes||[];for(var d=0;d<b.LogicalType.memberDefinitions.getPublicMappedProperties().length;d++){var e=b.LogicalType.memberDefinitions.getPublicMappedProperties()[d],f=Container.resolveType(e.dataType);if(this.storageProvider.supportedDataTypes.indexOf(f)>-1&&Object.isNullOrUndefined(e.inverseProperty)){var g=JSON.parse(JSON.stringify(e));g.dataType=f,c[e.name]=g}else if(this._buildDbType_navigationPropertyComplite(e,f,b),(f===$data.Array||f.isAssignableTo&&f.isAssignableTo($data.EntitySet))&&e.inverseProperty&&"$$unbound"!==e.inverseProperty)this._buildDbType_Collection_OneManyDefinition(c,b,f,e);else if(e.inverseProperty)if("$$unbound"===e.inverseProperty)f===$data.Array?this._buildDbType_Collection_OneManyDefinition(c,b,f,e):this._buildDbType_ElementType_OneManyDefinition(c,b,f,e);else{var h=f.memberDefinitions.getMember(e.inverseProperty);if(h)if(h.elementType){var i=Container.resolveType(h.elementType);i===b.LogicalType?this._buildDbType_ElementType_OneManyDefinition(c,b,f,e):"undefined"==typeof intellisense&&Guard.raise(new Exception("Inverse property not valid, refereed item element type not match: "+b.LogicalTypeName,", property: "+e.name))}else this._buildDbType_ElementType_OneOneDefinition(c,b,f,e);else"undefined"==typeof intellisense&&Guard.raise(new Exception("Inverse property not valid"))}else this._buildDbType_addComplexTypePropertyDefinition(c,b,f,e)}this._buildDbType_modifyInstanceDefinition(c,b,this);var j={};j.convertTo=this._buildDbType_generateConvertToFunction(b,this),this._buildDbType_modifyClassDefinition(j,b,this),b.PhysicalType=$data.Class.define(b.PhysicalTypeName,$data.Entity,b.LogicalType.container,c,j)}},_initializeActions:function(a,b,c){if(c&&c.actions)for(var d=Object.keys(c.actions),e=0;e<d.length;e++){var f=d[e],g=c.actions[f];if("function"==typeof g)a[f]=g;else{var h=$data.MemberDefinition.translateDefinition(g,f,b);h instanceof $data.MemberDefinition&&h.kind===$data.MemberTypes.method&&(a[f]=h.method)}}},_buildDbType_navigationPropertyComplite:function(a,b,c){if(a.inverseProperty){var d=null;d=this._storageModel.getStorageModel(b===$data.Array||b.isAssignableTo&&b.isAssignableTo($data.EntitySet)?Container.resolveType(a.elementType):b);var e=d.LogicalType.memberDefinitions.getMember(a.inverseProperty);e&&(e.inverseProperty?e.inverseProperty!=a.name&&"undefined"==typeof intellisense&&Guard.raise(new Exception("Inverse property mismatch")):e.inverseProperty=a.name)}else{var f=null;if(b===$data.Array||b.isAssignableTo&&b.isAssignableTo($data.EntitySet)){var d=this._storageModel.getStorageModel(Container.resolveType(a.elementType));if(d){f=[];for(var g=d.LogicalType.memberDefinitions.getPublicMappedProperties(),h=0;h<g.length;h++){var i=g[h];i.inverseProperty==a.name&&Container.resolveType(i.dataType)===Container.resolveType(c.LogicalType)&&f.push(i)}}}else{var d=this._storageModel.getStorageModel(b);if(d){f=[];for(var g=d.LogicalType.memberDefinitions.getPublicMappedProperties(),h=0;h<g.length;h++){var i=g[h];i.elementType&&i.inverseProperty==a.name&&Container.resolveType(i.elementType)===c.LogicalType?f.push(i):i.inverseProperty==a.name&&Container.resolveType(i.dataType)===c.LogicalType&&f.push(i)}}}if(f){f.length>1&&"undefined"!=typeof intellisense&&Guard.raise(new Exception("More than one inverse property refer to this member definition: "+a.name+", type: "+Container.resolveName(c.LogicalType)));var j=f.pop();j&&(a.inverseProperty=j.name)}}},_buildDbType_generateConvertToFunction:function(){return function(a){return a}},_buildDbType_modifyInstanceDefinition:function(){},_buildDbType_modifyClassDefinition:function(){},_buildDbType_addComplexTypePropertyDefinition:function(a,b,c,d){this._addNavigationPropertyDefinition(a,d,d.name,$data.MemberTypes.complexProperty);var e=this._createComplexElement(b.LogicalType,"",d.name,c,"","");b.ComplexTypes[d.name]=e,b.ComplexTypes.push(e)},_buildDbType_Collection_OneManyDefinition:function(a,b,c,d){var e=Container.resolveType(d.elementType);(void 0===e||null===e)&&"undefined"==typeof intellisense&&Guard.raise(new Exception("Element type definition error","Field definition",d));var f=this._storageModel.getStorageModel(e);f||"undefined"==typeof intellisense&&Guard.raise(new Exception("No EntitySet definition for the following element type","Field definition",d)),this._addNavigationPropertyDefinition(a,d,d.name);var g="$$unbound"===d.inverseProperty?"$$unbound":"0..1",h=this._addAssociationElement(b.LogicalType,g,d.name,f.LogicalType,"*",d.inverseProperty);b.Associations[d.name]=h,b.Associations.push(h)},_buildDbType_ElementType_OneManyDefinition:function(a,b,c,d){var e=Container.resolveType(d.dataType);(void 0===e||null===e)&&"undefined"==typeof intellisense&&Guard.raise(new Exception("Element type definition error","Field definition",d));var f=this._storageModel.getStorageModel(e);f||"undefined"==typeof intellisense&&Guard.raise(new Exception("No EntitySet definition for the following element type","Field definition",d)),this._addNavigationPropertyDefinition(a,d,d.name);var g="$$unbound"===d.inverseProperty?"$$unbound":"*",h=this._addAssociationElement(b.LogicalType,g,d.name,f.LogicalType,"0..1",d.inverseProperty);b.Associations[d.name]=h,b.Associations.push(h)},_buildDbType_ElementType_OneOneDefinition:function(a,b,c,d){var e=Container.resolveType(d.dataType);(void 0===e||null===e)&&"undefined"==typeof intellisense&&Guard.raise(new Exception("Element type definition error","Field definition",d));var f=this._storageModel.getStorageModel(e);f||"undefined"==typeof intellisense&&Guard.raise(new Exception("No EntitySet definition following element type","Field definition",d));var g=f.LogicalType.memberDefinitions.getMember(d.inverseProperty);g.required||d.required||"undefined"==typeof intellisense&&"undefined"==typeof intellisense&&Guard.raise(new Exception("In one to one connection, one side must required!","One to One connection",d)),this._addNavigationPropertyDefinition(a,d,d.name);var h=this._addAssociationElement(b.LogicalType,d.required?"0..1":"1",d.name,f.LogicalType,d.required?"1":"0..1",d.inverseProperty);b.Associations[d.name]=h,b.Associations.push(h)},_addNavigationPropertyDefinition:function(a,b,c,d){var e=JSON.parse(JSON.stringify(b));e.dataType=$data.EntitySet,e.notMapped=!0,e.kind=d?d:$data.MemberTypes.navProperty,e.association=c,a[b.name]=e},_addAssociationElement:function(a,b,c,d,e,f){return new $data.Association({From:a.name,FromType:a,FromMultiplicity:b,FromPropertyName:c,To:d.name,ToType:d,ToMultiplicity:e,ReferentialConstraint:[],ToPropertyName:f})},_createComplexElement:function(a,b,c,d,e,f){return new $data.ComplexType({From:a.name,FromType:a,FromMultiplicity:b,FromPropertyName:c,To:d.name,ToType:d,ToMultiplicity:e,ReferentialConstraint:[],ToPropertyName:f})},_successInitProvider:function(a,b){if(a instanceof $data.EntityContext&&void 0!==a._isOK)if(b){if(a._isOK=b,a.onReadyFunction){for(var c=0;c<a.onReadyFunction.length;c++)a.onReadyFunction[c].error(b);a.onReadyFunction=void 0}}else if(a._isOK=!0,a.onReadyFunction){for(var c=0;c<a.onReadyFunction.length;c++)a.onReadyFunction[c].success(a);a.onReadyFunction=void 0}},onReady:function(a){var b=new $data.PromiseHandler,c=b.createCallback(a);return this._isOK===!0?c.success(this):this._isOK!==!1?c.error(this._isOK):(this.onReadyFunction=this.onReadyFunction||[],this.onReadyFunction.push(c)),b.getPromise()},ready:{type:$data.Promise},getEntitySetFromElementType:function(elementType){var result=this._entitySetReferences[elementType];if(!result)try{result=this._entitySetReferences[eval(elementType).name]}catch(ex){}return result},executeQuery:function(a,b,c){var d=new $data.Query(a.expression,a.defaultType,this);d.transaction=c instanceof $data.Transaction?c:void 0;var e=this._isReturnTransaction(c);b=$data.typeSystem.createCallbackSetting(b);var f=this,g={};g.success=function(a){$data.QueryCache&&$data.QueryCache.isCacheable(f,a)&&$data.QueryCache.addToCache(f,a),a.buildResultSet(f),$data.ItemStore&&"QueryResultModifier"in $data.ItemStore&&$data.ItemStore.QueryResultModifier.call(f,a);var c;if(a.expression.nodeType===$data.Expressions.ExpressionType.Single||a.expression.nodeType===$data.Expressions.ExpressionType.Find||a.expression.nodeType===$data.Expressions.ExpressionType.Count||a.expression.nodeType===$data.Expressions.ExpressionType.BatchDelete||a.expression.nodeType===$data.Expressions.ExpressionType.Some||a.expression.nodeType===$data.Expressions.ExpressionType.Every){if(1!==a.result.length)return void b.error(new Exception("result count failed"));c=a.result[0]}else if(a.expression.nodeType===$data.Expressions.ExpressionType.First){if(0===a.result.length)return void b.error(new Exception("result count failed"));c=a.result[0]}else"number"==typeof a.__count&&a.result&&(a.result.totalCount=a.__count),f.storageProvider._buildContinuationFunction(f,a),c=a.result;var d=function(){f._applyTransaction(b,b.success,[c],a.transaction,e)},g=0,h=a.getEntitySets(),i=function(){var b=h[g];if(b.afterRead){g++;var e=b.afterRead.call(this,c,h,a);"function"==typeof e?e.call(this,g<h.length?i:d,c,h,a):g<h.length?i():d()}else d()};h.length?i():d()},g.error=function(){e?b.error.apply(this,arguments):b.error.apply(this,Array.prototype.filter.call(arguments,function(a){return!(a instanceof $data.Transaction)}))};var h=d.getEntitySets(),i=function(){var a=!0,b=f,c=function(c){c===!1&&(a=!1),a?d.transaction?$data.QueryCache&&$data.QueryCache.isInCache(f,d)?$data.QueryCache.executeQuery(f,d,g):b.storageProvider.executeQuery(d,g):b.beginTransaction(function(a){d.transaction=a,$data.QueryCache&&$data.QueryCache.isInCache(f,d)?$data.QueryCache.executeQuery(f,d,g):b.storageProvider.executeQuery(d,g)}):(d.rawDataList=[],d.result=[],g.success(d))},e=0,i=function(b){b===!1&&(a=!1);var f=h[e];if(f.beforeRead){e++;var g=f.beforeRead.call(this,h,d);"function"==typeof g?g.call(this,e<h.length&&a?i:c,h,d):(g===!1&&(a=!1),e<h.length&&a?i():c())}else c()};h.length?i():c()};this.user&&this.checkPermission?this.checkPermission(d.expression.nodeType===$data.Expressions.ExpressionType.BatchDelete?$data.Access.DeleteBatch:$data.Access.Read,this.user,h,{success:i,error:g.error}):i()},saveChanges:function(a,b){$data.QueryCache&&$data.QueryCache.reset(this);for(var c=[],d=this.stateManager.trackedEntities,e=new $data.PromiseHandler,f=e.createCallback(a),g=e.getPromise(),h=this._isReturnTransaction(b),i=[];d.length>0;){for(var j=[],k=0;k<d.length;k++){var l=d[k],m=this._storageModel.getStorageModel(l.data.getType());if(l.data.entityState==$data.EntityState.Unchanged)l.skipSave=!0,i.push(l.data);else if(l.data.entityState==$data.EntityState.Modified&&l.data.changedProperties){var n=l.data.changedProperties.some(function(a){var b=m.PhysicalType.memberDefinitions.getMember(a.name);if(b.kind==$data.MemberTypes.navProperty){var c=m.Associations[b.association],d=c.FromMultiplicity+c.ToMultiplicity;return"*0..1"==d||"0..11"==d}return!0});n||(l.skipSave=!0,i.push(l.data))}this.processEntityTypeBeforeEventHandler(i,l);for(var o=[],p=m.PhysicalType.memberDefinitions.asArray(),q=0;q<p.length;q++){var r=p[q];r.kind==$data.MemberTypes.navProperty&&o.push(r)}for(var s=0;s<o.length;s++)for(var t=o[s],u=m.Associations[t.name],v=t.name,w=u.ToPropertyName,x=[].concat(l.data[v]),y=0;y<x.length;y++){var z=x[y];if(z){var A=z[w],B=u.FromMultiplicity+u.ToMultiplicity;if("$$unbound"===u.FromMultiplicity)if(z instanceof $data.Array){l.dependentOn=l.dependentOn||[];for(var C=0;C<z.length;C++){{z[C]}l.dependentOn.indexOf(z)<0&&z.skipSave!==!0&&l.dependentOn.push(z)}}else l.dependentOn=l.dependentOn||[],l.dependentOn.indexOf(z)<0&&z.skipSave!==!0&&l.dependentOn.push(z);else{switch(B){case"*0..1":A?A instanceof Array?-1==A.indexOf(l.data)&&(A.push(l.data),z.initData[w]=A,z._setPropertyChanged(u.ToType.getMemberDefinition(w))):"undefined"==typeof intellisense&&Guard.raise("Item must be array or subtype of array"):(z.initData[w]=[l.data],z._setPropertyChanged(u.ToType.getMemberDefinition(w)));break;default:A?A!==l.data&&"undefined"==typeof intellisense&&Guard.raise("Integrity check error! Item assigned to another entity!"):(z.initData[w]=l.data,z._setPropertyChanged(u.ToType.getMemberDefinition(w)))}switch(B){case"*0..1":case"0..11":l.dependentOn=l.dependentOn||[],l.dependentOn.indexOf(z)<0&&z.skipSave!==!0&&l.dependentOn.push(z)}}z.entityState||(z.entityState=z.storeToken===this.storeToken?$data.EntityState.Modified:$data.EntityState.Added),-1==j.indexOf(z)&&j.push(z)}}}for(var k=0;k<d.length;k++){var D=d[k];D.skipSave!==!0&&c.push(D)}d=[];for(var k=0;k<j.length;k++){var E=j[k];i.some(function(a){return a==E})||c.some(function(a){return a.data==E})||d.push({data:E,entitySet:this.getEntitySetFromElementType(E.getType().name)})}}for(var s=0;s<c.length;s++){var F=c[s];if(F.dependentOn){for(var G=[],k=0;k<F.dependentOn.length;k++)i.indexOf(F.dependentOn[k])<0&&G.push(F.dependentOn[k]);F.dependentOn=G}}i=null;var H=this;if(0==c.length)return this.stateManager.trackedEntities.length=0,H._applyTransaction(f,f.success,[0],b,h),g;for(var I=[],k=0;k<c.length;k++){var D=c[k];if(D.data.entityState===$data.EntityState.Added)for(var s=0;s<D.data.getType().memberDefinitions.getPublicMappedProperties().length;s++){var J=D.data.getType().memberDefinitions.getPublicMappedProperties()[s],K=Container.resolveType(J.type);if(J.required&&!J.computed&&!D.data[J.name]&&!J.isDependentProperty)switch(K){case $data.String:case $data.Number:case $data.Float:case $data.Decimal:case $data.Integer:case $data.Int16:case $data.Int32:case $data.Int64:case $data.Byte:case $data.SByte:case $data.Date:case $data.Boolean:D.data[J.name]=Container.getDefault(J.dataType)}}D.data.entityState!==$data.EntityState.Added&&D.data.entityState!==$data.EntityState.Modified||D.data.isValid()||I.push({item:D.data,errors:D.data.ValidationErrors})}if(I.length>0)return f.error(I),g;for(var L=$data.Access.None,M={},N=[],k=0;k<c.length;k++){var O=c[k],P=O.entitySet.elementType.name;N.indexOf(O.entitySet)<0&&N.push(O.entitySet);var Q=this._entitySetReferences[P];if(Q.beforeCreate||Q.beforeUpdate||Q.beforeDelete||this.user&&this.checkPermission)switch(M[P]||(M[P]={}),O.data.entityState){case $data.EntityState.Added:L|=$data.Access.Create,Q.beforeCreate&&(M[P].createAll||(M[P].createAll=[]),M[P].createAll.push(O));break;case $data.EntityState.Modified:L|=$data.Access.Update,Q.beforeUpdate&&(M[P].modifyAll||(M[P].modifyAll=[]),M[P].modifyAll.push(O));break;case $data.EntityState.Deleted:L|=$data.Access.Delete,Q.beforeDelete&&(M[P].deleteAll||(M[P].deleteAll=[]),M[P].deleteAll.push(O))}}var R,S=function(a){if(a===!1&&(R="async",c.length=0),c.length){var d={success:function(a){H._postProcessSavedItems(f,c,a,h)},error:function(){h?f.error.apply(this,arguments):f.error.apply(this,Array.prototype.filter.call(arguments,function(a){return!(a instanceof $data.Transaction)}))}};b instanceof $data.Transaction?H.storageProvider.saveChanges(d,c,b):H.beginTransaction(!0,function(a){H.storageProvider.saveChanges(d,c,a)})}else R?f.error(new Exception("Cancelled event in "+R,"CancelEvent")):H._applyTransaction(f,f.success,[0],b,h)},T=Object.getOwnPropertyNames(M),k=0,U=["beforeUpdate","beforeDelete","beforeCreate"],V={beforeCreate:"createAll",beforeDelete:"deleteAll",beforeUpdate:"modifyAll"},W=function(a){if(a===!1)return R="async",c.length=0,void S(a);var b=H._entitySetReferences[T[k]],d=U.pop(),e=M[T[k]],f=e[V[d]];if(f){for(var g=[],h=0;h<f.length;h++)g.push(f[h].data);U.length||(U=["beforeUpdate","beforeDelete","beforeCreate"],k++);var i=b[d].call(H,g);if("function"==typeof i)i.call(H,k<T.length&&!R?W:S,g);else if(i===!1){R=b.name+"."+d;for(var j=0;j<f.length;j++){var l=f[j],m=c.indexOf(l);c.splice(m,1)}S()}else k<T.length&&!R?W():S()}else U.length||(U=["beforeUpdate","beforeDelete","beforeCreate"],k++),k<T.length&&!R?W():S()};return this.user&&this.checkPermission?this.checkPermission(L,this.user,N,{success:function(){k<T.length?W():S()},error:f.error}):k<T.length?W():S(),g},processEntityTypeBeforeEventHandler:function(a,b){if(!b.skipSave){var c=b.data,d=c.getType(),e=c.entityState;switch(!0){case e===$data.EntityState.Added&&d.onbeforeCreate instanceof $data.Event:d.onbeforeCreate.fireCancelAble(c)===!1&&(b.skipSave=!0,a.push(c));break;case e===$data.EntityState.Modified&&d.onbeforeUpdate instanceof $data.Event:d.onbeforeUpdate.fireCancelAble(c)===!1&&(b.skipSave=!0,a.push(c));break;case e===$data.EntityState.Deleted&&d.onbeforeDelete instanceof $data.Event:d.onbeforeDelete.fireCancelAble(c)===!1&&(b.skipSave=!0,a.push(c))}}},processEntityTypeAfterEventHandler:function(a){var b=a.data,c=b.getType(),d=b.entityState;switch(!0){case d===$data.EntityState.Added&&c.onafterCreate instanceof $data.Event:c.onafterCreate.fire(b);break;case d===$data.EntityState.Modified&&c.onafterUpdate instanceof $data.Event:c.onafterUpdate.fire(b);break;case d===$data.EntityState.Deleted&&c.onafterDelete instanceof $data.Event:c.onafterDelete.fire(b)}},bulkInsert:function(a,b,c,d){var e=new $data.PromiseHandler;if(d=e.createCallback(d),"string"==typeof a){var f;for(var g in this._entitySetReferences){var h=this._entitySetReferences[g];if(h.tableName===a){f=h;break}}f||(f=this[a]),a=f}return a?this.storageProvider.bulkInsert(a,b,c,d):d.error(new Exception("EntitySet not found")),e.getPromise()},prepareRequest:function(){},_postProcessSavedItems:function(a,b,c,d){this.ChangeCollector&&this.ChangeCollector instanceof $data.Notifications.ChangeCollectorBase&&this.ChangeCollector.processChangedData(b);for(var e={},f=this,g=0;g<b.length;g++){var h=b[g];h.data.storeToken||(h.data.storeToken=f.storeToken),this.processEntityTypeAfterEventHandler(h);var i=h.data.entityState;h.data.entityState=$data.EntityState.Unchanged,h.data.changedProperties=[],h.physicalData=void 0;var j=h.entitySet.elementType.name,k=f._entitySetReferences[j],l=void 0;switch(i){case $data.EntityState.Added:l="added";break;case $data.EntityState.Deleted:l="deleted";break;case $data.EntityState.Modified:l="updated"}if(l&&this.raiseEvent(l,h),k.afterCreate||k.afterUpdate||k.afterDelete)switch(e[j]||(e[j]={}),i){case $data.EntityState.Added:k.afterCreate&&(e[j].createAll||(e[j].createAll=[]),e[j].createAll.push(h));break;case $data.EntityState.Modified:k.afterUpdate&&(e[j].modifyAll||(e[j].modifyAll=[]),e[j].modifyAll.push(h));break;case $data.EntityState.Deleted:k.afterDelete&&(e[j].deleteAll||(e[j].deleteAll=[]),e[j].deleteAll.push(h))}}var m=Object.getOwnPropertyNames(e),g=0,f=this,n=["afterUpdate","afterDelete","afterCreate"],o={afterCreate:"createAll",afterDelete:"deleteAll",afterUpdate:"modifyAll"},p=function(){f.trackChanges||f.stateManager.reset(),f._applyTransaction(a,a.success,[b.length],c,d)},q=function(){var a=f._entitySetReferences[m[g]],b=n.pop(),c=e[m[g]],d=c[o[b]];if(d){for(var h=[],i=0;i<d.length;i++)h.push(d[i].data);n.length||(n=["afterUpdate","afterDelete","afterCreate"],g++);var j=a[b].call(f,h);"function"==typeof j?j.call(f,g<m.length?q:p,h):g<m.length?q():p()}else n.length||(n=["afterUpdate","afterDelete","afterCreate"],g++),g<m.length?q():p()};g<m.length?q():p()},forEachEntitySet:function(a,b){for(var c in this._entitySetReferences){var d=this._entitySetReferences[c];a.call(b,d)}},loadItemProperty:function(a,b,c,d){Guard.requireType("entity",a,$data.Entity);var e="string"==typeof b?a.getType().memberDefinitions.getMember(b):b,f=this._isReturnTransaction(d);if(void 0!=a[e.name]){var g=new $data.PromiseHandler;return callBack=g.createCallback(c),this._applyTransaction(c,c.success,[a[e.name]],d,f),g.getPromise()}var h=!0,i=this._storageModel.getStorageModel(a.getType().fullName),j=Container.resolveType(e.dataType);if(j===$data.Array||j.isAssignableTo&&j.isAssignableTo($data.EntitySet))j=Container.resolveType(e.elementType),h=!1;else{for(var k,l=0;l<i.Associations.length;l++){var m=i.Associations[l];if(m.FromPropertyName==e.name){k=m;break}}k&&"0..1"===k.FromMultiplicity&&"1"===k.ToMultiplicity&&(h=!1)}var n=i.LogicalType.memberDefinitions.getKeyProperties();if(h===!0){for(var o="function (e) { return",p={},q=0;q<n.length;q++){var r=n[q];q>0&&(o+=" &&"),o+=" e."+r.name+" == this.key"+q,p["key"+q]=a[r.name]}o+="; }";var s=this.getEntitySetFromElementType(a.getType());return s.map("function (e) { return e."+e.name+" }").single(o,p,c,d)}for(var o="function (e) { return",p={},q=0;q<n.length;q++){var r=n[q];q>0&&(o+=" &&"),o+=" e."+e.inverseProperty+"."+r.name+" == this.key"+q,p["key"+q]=a[r.name]}o+="; }";var s=this.getEntitySetFromElementType(j);return s.filter(o,p).toArray(c,d)},getTraceString:function(a){var b=new $data.Query(a.expression,a.defaultType,this);return this.storageProvider.getTraceString(b)},log:function(){},resolveBinaryOperator:function(a,b,c){return this.storageProvider.resolveBinaryOperator(a,b,c)},resolveUnaryOperator:function(a,b,c){return this.storageProvider.resolveUnaryOperator(a,b,c)},resolveFieldOperation:function(a,b,c){return this.storageProvider.resolveFieldOperation(a,b,c)},resolveSetOperations:function(a,b,c){return this.storageProvider.resolveSetOperations(a,b,c)},resolveTypeOperations:function(a,b,c){return this.storageProvider.resolveTypeOperations(a,b,c)},resolveContextOperations:function(a,b,c){return this.storageProvider.resolveContextOperations(a,b,c)},_generateServiceOperationQueryable:function(a,b,c,d){"undefined"!=typeof console&&console.log&&console.log("Obsolate: _generateServiceOperationQueryable, $data.EntityContext");for(var e=[],f=0;f<d.length;f++){var g={};g[d[f]]=Container.resolveType(Container.getTypeName(c[f])),e.push(g)}var h=$data.EntityContext.generateServiceOperation({serviceName:a,returnType:$data.Queryable,elementType:this[b].elementType,params:e});return h.apply(this,c)},attach:function(a,b){a instanceof $data.EntityWrapper&&(a=a.getEntity());var c=this.getEntitySetFromElementType(a.getType());return c.attach(a,b)},attachOrGet:function(a,b){a instanceof $data.EntityWrapper&&(a=a.getEntity());var c=this.getEntitySetFromElementType(a.getType());return c.attachOrGet(a,b)},addMany:function(a){var b=this;return a.forEach(function(a){b.add(a)}),a},add:function(a){a instanceof $data.EntityWrapper&&(a=a.getEntity());var b=this.getEntitySetFromElementType(a.getType());return b.add(a)},remove:function(a){a instanceof $data.EntityWrapper&&(a=a.getEntity());var b=this.getEntitySetFromElementType(a.getType());return b.remove(a)},storeToken:{type:Object},getFieldUrl:function(a,b,c){try{var d="string"==typeof c?this[c]:c,e="string"==typeof b?b:b.name;if(a instanceof $data.Entity)d=this.getEntitySetFromElementType(a.getType());else if(!Object.isNullOrUndefined(a)&&a.constructor!==$data.Object){var f=d.elementType.memberDefinitions.getKeyProperties()[0],g={};g[f.name]=a,a=g}return a instanceof $data.Entity||(a=new d.elementType(a)),this.storageProvider.getFieldUrl(a,e,d)}catch(h){}return"#"}},{inheritedTypeProcessor:function(a){a.resolveForwardDeclarations&&a.resolveForwardDeclarations()},generateServiceOperation:function(a){var b;if(a.serviceMethod){var c=a.returnType?Container.resolveType(a.returnType):{};b=c.isAssignableTo&&c.isAssignableTo($data.Queryable)?a.serviceMethod:function(){{var b,c=arguments[arguments.length-1],d=new $data.PromiseHandler;arguments}"function"==typeof c?(b=d.createCallback(c),arguments[arguments.length-1]=b):(b=d.createCallback(),arguments.push(b));try{var e=a.serviceMethod.apply(this,arguments);void 0!==e&&b.success(e)}catch(f){b.error(f)}return d.getPromise()}}else b=function(){var b,c=this;if(this instanceof $data.Entity){if(a.method||(a.method="POST"),!this.context)return void Guard.raise("entity not attached into context");c=this.context,b={data:this,entitySet:c.getEntitySetFromElementType(this.getType())}}var d=a.elementType?c.getEntitySetFromElementType(Container.resolveType(a.elementType)):null,e=null;if(a.params){e=[];for(var f=0;f<a.params.length;f++)for(var g in a.params[f])e.push(Container.createConstantExpression(arguments[f],Container.resolveType(a.params[f][g]),g))}var h=Container.createEntityContextExpression(c),i=(b?b.data:c).getType().getMemberDefinition(a.serviceName),j=Container.createServiceOperationExpression(h,Container.createMemberInfoExpression(i),e,a,b),k=arguments[arguments.length-1];if("function"!=typeof k&&(k=void 0),d){var l=Container.createQueryable(d,j);return k?(j.isTerminated=!0,l._runQuery(k)):l}var m=a.returnType?Container.resolveType(a.returnType):null,l=Container.createQueryable(c,j);return l.defaultType=m||$data.Object,m===$data.Queryable?(l.defaultType=Container.resolveType(a.elementType),k?(j.isTerminated=!0,l._runQuery(k)):l):(j.isTerminated=!0,l._runQuery(k))};var d=[];if(a.params)for(var e=0;e<a.params.length;e++){var f=a.params[e];for(var g in f)d.push({name:g,type:f[g]})}return $data.typeSystem.extend(b,a,{params:d}),b},_convertLogicalTypeNameToPhysical:function(a){return a+"_$db$"},_storageModelCache:{get:function(){return this.__storageModelCache||(this.__storageModelCache={}),this.__storageModelCache},set:function(){}}}),$data.Class.define("$data.QueryProvider",null,null,{constructor:function(){this.requiresExpressions=!1},executeQuery:function(){},getTraceString:function(){}},null),$data.Class.define("$data.ModelBinder",null,null,{constructor:function(a){if(this.context=a,this.providerName=null,this.context.storageProvider&&"function"==typeof this.context.storageProvider.getType){this.references=!this.context.storageProvider.providerConfiguration.modelBinderOptimization;for(var b in $data.RegisteredStorageProviders)$data.RegisteredStorageProviders[b]===this.context.storageProvider.getType()&&(this.providerName=b)}},_deepExtend:function(a,b){if(null===a||void 0===a)return b;for(var c in b)if(a.hasOwnProperty(c)){if("object"==typeof b[c])if(Array.isArray(b[c]))for(var d=0;d<b[c].length;d++)a[c].indexOf(b[c][d])<0&&a[c].push(b[c][d]);else this._deepExtend(a[c],b[c])}else a[c]=b[c];return this._finalize(a)},_finalize:function(a){return a instanceof $data.Entity&&(a.changedProperties=void 0,a.storeToken=this.context.storeToken),a
},_buildSelector:function(a,b){if(a.$selector){Array.isArray(a.$selector)||(a.$selector=[a.$selector]);for(var c=0;c<a.$selector.length;c++){var d=a.$selector[c].replace("json:","");b.src+="if(";for(var e=d.split("."),f=0;f<e.length;f++)b.src+="di."+e.slice(0,f+1).join(".")+(f<e.length-1?" && ":" !== undefined && typeof di."+d+' === "object"');b.src+="){di = di."+d+";}"+(c<a.$selector.length-1?"else ":"")}b.src+="if (di === null){",b.iter&&(b.src+=b.iter+" = null;"),b.src+="return null;",b.src+="}"}},_buildKey:function(a,b,c,d,e){if(c){var b=Container.resolveType(b),f=Container.getIndex(b);if(b=b.fullName||b.name,d.src+="var "+a+"Fn = function(di){",Array.isArray(c)&&1!=c.length){d.src+='var key = "";';for(var g=0;g<c.length;g++){var h="object"!=typeof c[g]?c[g]:c[g].$source;d.src+="if (typeof di."+h+' === "undefined") return undefined;',d.src+="if (di."+h+" === null) return null;",d.src+='key += ("'+b+"_"+f+"_"+h+'#" + di.'+h+");"}}else"string"!=typeof c&&(c=c[0]),d.src+="if (typeof di."+c+' === "undefined") return undefined;',d.src+="if (di."+c+" === null) return null;",d.src+='var key = ("'+b+"_"+f+"_"+c+'#" + di.'+c+");";d.src+="return key;};"}d.src+="var "+a+" = "+(c?a+"Fn("+(e||"di")+")":"undefined")+";"},build:function(a,b){if(a.$selector){Array.isArray(a.$selector)||(a.$selector=[a.$selector]);for(var c=0;c<a.$selector.length;c++)a.$selector[c]=a.$selector[c].replace("json:","")}if(a.$value)if("function"==typeof a.$value)if(b.src+="var di = di || data;",b.src+="var fn = function(){ return meta"+(b.meta.length?"."+b.meta.join("."):"")+".$value.call(self, meta"+(b.meta.length?"."+b.meta.join("."):"")+", di); };",a.$type){var d=Container.resolveName(Container.resolveType(a.$type)),e=Container.getIndex(Container.resolveType(a.$type)),f=this.context.storageProvider.fieldConverter.fromDb[d];b.item=f?'self.context.storageProvider.fieldConverter.fromDb["'+d+'"](fn())':"new (Container.resolveByIndex("+e+"))(fn())"}else b.item="fn()";else if(a.$type){var d=Container.resolveName(Container.resolveType(a.$type)),e=Container.getIndex(Container.resolveType(a.$type)),f=this.context.storageProvider.fieldConverter.fromDb[d];b.item=f?'self.context.storageProvider.fieldConverter.fromDb["'+d+'"]('+a.$value+")":"new (Container.resolveByIndex("+e+"))("+a.$value+")"}else b.item=a.$value;else if(a.$source){var d=Container.resolveName(Container.resolveType(a.$type)),e=Container.getIndex(Container.resolveType(a.$type)),f=this.context.storageProvider.fieldConverter.fromDb[d],g="_"+d.replace(/\./gi,"_")+"_";b.forEach||(b.src+="var di = data;"),b.item=g,this._buildSelector(a,b),b.src+=f?"var "+g+' = self.context.storageProvider.fieldConverter.fromDb["'+d+'"](di.'+a.$source+");":"var "+g+" = new (Container.resolveByIndex("+e+"))(di."+a.$source+");"}else if(a.$item){b.meta.push("$item");var h=b.item&&b.current?b.item+"."+b.current:b.item?b.item:"result";if(b.iter=h,h.indexOf(".")<0&&(b.src+="var "+h+";"),b.src+="var fn = function(di){",a.$selector&&(b.src+='if (typeof di !== "undefined" && !(Array.isArray(di))){',this._buildSelector(a,b),b.src+="}"),this.references&&a.$keys&&this._buildKey("forKey",a.$type,a.$keys,b),b.src+=h+" = typeof "+h+' == "undefined" ? [] : '+h+";",this.references&&a.$item.$keys){var i="keycache_"+h.replace(/\./gi,"_");b.src+="var "+i+";",b.src+="var kci = keycacheIter.indexOf("+h+");",b.src+="if (kci < 0){",b.src+=i+" = [];",b.src+="keycache.push("+i+");",b.src+="keycacheIter.push("+h+");",b.src+="}else{",b.src+=i+" = keycache[kci];",b.src+="}"}b.iter=void 0,b.forEach=!0;var j="itemForKey_"+h.replace(/\./gi,"_");b.src+="var forEachFn = function(di, i){",b.src+="var diBackup = di;","sqLite"==this.providerName&&this.references&&a.$item.$keys&&this._buildKey(j,a.$type,a.$item.$keys,b);var g=b.item||"iter";b.item=g,a.$item.$source||this._buildSelector(a.$item,b),this.build(a.$item,b),this.references&&a.$keys?(b.src+="if (forKey){",b.src+="if (cache[forKey]){",b.src+=h+" = cache[forKey];",b.src+="if ("+h+".indexOf("+(b.item||g)+") < 0){",b.src+=h+".push("+(b.item||g)+");",b.src+="}}else{",b.src+="cache[forKey] = "+h+";",b.src+=h+".push("+(b.item||g)+");",b.src+="}}else{",this.references&&a.$item.$keys&&this._buildKey("cacheKey",a.$type,a.$item.$keys,b,"diBackup"),b.src+='if (typeof cacheKey != "undefined" && cacheKey !== null){',b.src+="if (keycache_"+h.replace(/\./gi,"_")+" && cacheKey){",b.src+="if (keycache_"+h.replace(/\./gi,"_")+".indexOf(cacheKey) < 0){",b.src+=h+".push("+(b.item||g)+");",b.src+="keycache_"+h.replace(/\./gi,"_")+".push(cacheKey);",b.src+="}",b.src+="}else{",b.src+=h+".push("+(b.item||g)+");",b.src+="}",b.src+="}",b.src+="}"):this.references&&a.$item.$keys?(b.src+="if (typeof "+j+' !== "undefined" && '+j+" !== null){",b.src+="if (typeof keycache_"+h.replace(/\./gi,"_")+' !== "undefined" && '+j+"){",b.src+="if (keycache_"+h.replace(/\./gi,"_")+".indexOf("+j+") < 0){",b.src+=h+".push("+(b.item||g)+");",b.src+="keycache_"+h.replace(/\./gi,"_")+".push("+j+");",b.src+="}}else{",b.src+=h+".push("+(b.item||g)+");",b.src+="}}else{",b.src+=h+".push("+(b.item||g)+");",b.src+="}"):b.src+=h+".push("+(b.item||g)+");",b.src+="};",b.src+="if (Array.isArray(di)) di.forEach(forEachFn);",b.src+="else forEachFn(di, 0);",b.forEach=!1,b.item=null,b.src+='};fn(typeof di === "undefined" ? data : di);',b.meta.pop()}else if(a.$type){b.forEach||(b.src+='if (typeof di === "undefined"){',b.src+="var di = data;",this._buildSelector(a,b),b.src+="}");var k=Container.resolveType(a.$type),d=Container.resolveName(k),e=Container.getIndex(k),l=k.isAssignableTo&&k.isAssignableTo($data.Entity),g="_"+d.replace(/\./gi,"_")+"_";b.item==g&&(g+="new_"),b.item=g;var m=!1;if(a.$source||a.$value||k===$data.Array||k===$data.Object||k.isAssignableTo||(m=!0),k===$data.Object||k===$data.Array){var n=Object.keys(a);(1==n.length||2==n.length&&a.$selector)&&(m=!0)}if(m){var f=this.context.storageProvider.fieldConverter.fromDb[d];b.src+=f?"var "+g+' = di != undefined ? self.context.storageProvider.fieldConverter.fromDb["'+d+'"](di) : di;':"var "+g+" = di;"}else this.references&&a.$keys?(this._buildKey("itemKey",a.$type,a.$keys,b),b.src+="if (itemKey === null) return null;",b.src+="var "+g+";",b.src+="if (itemKey && cache[itemKey]){",b.src+=g+" = cache[itemKey];",b.src+="}else{",b.src+=l?g+" = new (Container.resolveByIndex("+e+"))(undefined, { setDefaultValues: false });":g+" = new (Container.resolveByIndex("+e+"))();",b.src+="if (itemKey){",b.src+="cache[itemKey] = "+g+";",b.src+="}",b.src+="}"):b.src+=l?"var "+g+" = new (Container.resolveByIndex("+e+"))(undefined, { setDefaultValues: false });":"var "+g+" = new (Container.resolveByIndex("+e+"))();";for(var c in a)if(c.indexOf("$")<0)if(b.current=c,a[c].$item)b.meta.push(c),this.build(a[c],b),b.item=g,b.meta.pop();else if(a[c].$value){b.meta.push(c);var g=b.item;this.build(a[c],b),b.src+=g+"."+c+" = "+b.item+";",b.item=g,b.meta.pop()}else if(a[c].$source){if(b.src+="var fn = function(di){",this._buildSelector(a[c],b),a[c].$type){var d=Container.resolveName(Container.resolveType(a[c].$type)),e=Container.getIndex(Container.resolveType(a[c].$type)),f=this.context.storageProvider.fieldConverter.fromDb[d];b.src+=f?'return self.context.storageProvider.fieldConverter.fromDb["'+d+'"](di.'+a[c].$source+");":"return new (Container.resolveByIndex("+e+"))(di."+a[c].$source+");"}else b.src+=g+"."+c+" = di."+a[c].$source+";";b.src+="};",b.src+=a[c].$type?g+"."+c+" = fn(di);":"fn(di);"}else if(a[c].$type)b.meta.push(c),b.src+="var fn = function(di){",this._buildSelector(a[c],b),this.build(a[c],b),b.src+="return "+b.item+";};",b.src+=a[c].$type===$data.Object?g+"."+c+" = self._deepExtend("+g+"."+c+", fn(di));":g+"."+c+" = fn(di);",b.item=g,b.meta.pop();else if(a.$type){var o=Container.resolveType(a.$type).memberDefinitions.getMember(c),d=Container.resolveName(o.type),p=(Container.resolveType(a.$type),Container.getIndex(a.$type)),f=this.context.storageProvider.fieldConverter.fromDb[d];if(this.providerName&&o&&o.converter&&o.converter[this.providerName]&&"function"==typeof o.converter[this.providerName].fromDb)b.src+=g+"."+c+' = Container.resolveByIndex("'+p+'").memberDefinitions.getMember("'+c+'").converter.'+this.providerName+".fromDb(di."+a[c]+', Container.resolveByIndex("'+p+'").memberDefinitions.getMember("'+c+'"), self.context, Container.resolveByIndex("'+p+'"));';else if(f)b.src+=g+"."+c+' = self.context.storageProvider.fieldConverter.fromDb["'+d+'"](di.'+a[c]+");";else{var e=Container.getIndex(Container.resolveType(d.memberDefinitions.getMember(c).type));b.src+=g+"."+c+" = new (Container.resolveByIndex("+e+"))(di."+a[c]+");"}}b.src+=g+" = self._finalize("+g+");"}},call:function(a,b){if(!Object.getOwnPropertyNames(b).length)return a;var c={src:"",meta:[]};c.src+="var self = this;",c.src+="var result;",c.src+="var cache = {};",c.src+="var keycache = [];",c.src+="var keycacheIter = [];",this.build(b,c),c.item&&(c.src+='if (typeof result === "undefined") result = '+c.item+";"),c.src+="return result;";var d=new Function("meta","data",c.src).bind(this),e=d(b,a);return e}}),$C("$data.queryBuilder",null,null,{constructor:function(){this._fragments={},this.selectedFragment=null,this._binderConfig={},this.modelBinderConfig=this._binderConfig,this._binderConfigPropertyStack=[]},selectTextPart:function(a){this._fragments[a]||(this._fragments[a]={text:"",params:[]}),this.selectedFragment=this._fragments[a]},getTextPart:function(a){return this._fragments[a]},addText:function(a){this.selectedFragment.text+=a},addParameter:function(a){this.selectedFragment.params.push(a)},selectModelBinderProperty:function(a){this._binderConfigPropertyStack.push(this.modelBinderConfig),a in this.modelBinderConfig||(this.modelBinderConfig[a]={}),this.modelBinderConfig=this.modelBinderConfig[a]},popModelBinderProperty:function(){this.modelBinderConfig=0===this._binderConfigPropertyStack.length?this._binderConfig():this._binderConfigPropertyStack.pop()},resetModelBinderProperty:function(){this._binderConfigPropertyStack=[],this.modelBinderConfig=this._binderConfig},addKeyField:function(a){this.modelBinderConfig.$keys||(this.modelBinderConfig.$keys=new Array),this.modelBinderConfig.$keys.push(a)}}),$C("$data.Query",null,null,{constructor:function(a,b,c){this.expression=a,this.context=c,this.expressions=a,this.defaultType=b,this.result=[],this.rawDataList=[],this.modelBinderConfig={},this.context=c},rawDataList:{dataType:"Array"},result:{dataType:"Array"},resultType:{},buildResultSet:function(){var a=new $data.ModelBinder(this.context);this.result=a.call(this.rawDataList,this.modelBinderConfig)},getEntitySets:function(){var a=[],b=this.context,c=function(d){d instanceof $data.Expressions.EntitySetExpression&&a.indexOf(b._entitySetReferences[d.elementType.name])<0&&a.push(b._entitySetReferences[d.elementType.name]),d.source&&c(d.source)};return c(this.expression),a}},null),$data.Class.define("$data.Queryable",null,null,{constructor:function(a,b){var c=a instanceof $data.EntityContext?a:a.entityContext;this.defaultType=a instanceof $data.EntityContext?null:a.defaultType,this.entityContext=c,this.expression=b},filter:function(a,b){3===arguments.length&&(a="it."+arguments[0]+("."===arguments[1][0]?arguments[1]+"(param)":" "+arguments[1]+" param"),b={param:arguments[2]}),this._checkOperation("filter");var c=Container.createCodeExpression(a,b),d=this.expression;if(this.expression instanceof $data.Expressions.FilterExpression){d=this.expression.source;var e=this.entityContext.storageProvider.resolveBinaryOperator("and");c=Container.createSimpleBinaryExpression(this.expression.selector,c,"and","filter","boolean",e)}var f=Container.createFilterExpression(d,c),g=Container.createQueryable(this,f);return g},where:function(a,b){return this.filter(a,b)},map:function(a,b,c){this._checkOperation("map");var d=Container.createCodeExpression(a,b),e=Container.createProjectionExpression(this.expression,d);e.projectionAs="default"===c?this.defaultType:c?Container.resolveType(c):$data.Object;var f=Container.createQueryable(this,e);return f},select:function(a,b,c){return this.map(a,b,c)},length:function(a,b){this._checkOperation("length");var c=new $data.PromiseHandler,d=c.createCallback(a),e=Container.createCountExpression(this.expression),f=Container.createQueryExpressionCreator(this.entityContext);try{var g=f.Visit(e);this.entityContext.log({event:"EntityExpression",data:g}),this.entityContext.executeQuery(Container.createQueryable(this,g),d,b)}catch(h){d.error(h)}return c.getPromise()},count:function(a,b){return this.length(a,b)},forEach:function(a,b){function c(b){b.forEach(a)}this._checkOperation("forEach");var d=new $data.PromiseHandler,e=d.createCallback(c),f=Container.createForEachExpression(this.expression),g=Container.createQueryExpressionCreator(this.entityContext);try{var h=g.Visit(f);this.entityContext.log({event:"EntityExpression",data:h}),this.entityContext.executeQuery(Container.createQueryable(this,h),e,b)}catch(i){e.error(i)}return d.getPromise()},toArray:function(a,b){if(a instanceof $data.Array)return this.toArray(function(b){a.length=0,b.forEach(function(b){a.push(b)})});this._checkOperation("toArray");var c=new $data.PromiseHandler,d=c.createCallback(a),e=Container.createToArrayExpression(this.expression),f=Container.createQueryExpressionCreator(this.entityContext);try{var g=f.Visit(e);this.entityContext.log({event:"EntityExpression",data:g}),this.entityContext.executeQuery(Container.createQueryable(this,g),d,b)}catch(h){d.error(h)}return c.getPromise()},toLiveArray:function(a,b){var c=this,d=[],e=function(a){return function(c){var f=new $data.PromiseHandler,g=f.createCallback(c),h=function(a){d.length=0;var b=a;$data.typeSystem.extend(d,b),d.prev=e(function(a){b.prev(a)}),d.next=e(function(a){b.next(a)}),g.success.apply(this,[d].concat(Array.prototype.slice.call(arguments,1)))};a({success:h,error:g.error},b);var i=f.getPromise();return $data.typeSystem.extend(d,i),d}};return d.refresh=e(function(a){c.toArray(a)}),d.refresh.apply(d,arguments)},single:function(a,b,c,d){this._checkOperation("single");var e=this;a&&(e=this.filter(a,b)),e=e.take(2);var f=new $data.PromiseHandler,g=f.createCallback(c),h=Container.createSingleExpression(e.expression),i=Container.createQueryExpressionCreator(e.entityContext);try{var j=i.Visit(h);this.entityContext.log({event:"EntityExpression",data:j}),e.entityContext.executeQuery(Container.createQueryable(e,j),g,d)}catch(k){g.error(k)}return f.getPromise()},some:function(a,b,c,d){this._checkOperation("some");var e=this;a&&(e=this.filter(a,b)),e=e.take(1);var f=new $data.PromiseHandler,g=f.createCallback(c),h=Container.createSomeExpression(e.expression),i=Container.createQueryExpressionCreator(e.entityContext);try{var j=i.Visit(h);this.entityContext.log({event:"EntityExpression",data:j}),e.entityContext.executeQuery(Container.createQueryable(e,j),g,d)}catch(k){g.error(k)}return f.getPromise()},every:function(a,b,c,d){this._checkOperation("every");var e=this;a&&(e=this.filter(a,b)),e=e.take(1);var f=new $data.PromiseHandler,g=f.createCallback(c),h=Container.createEveryExpression(e.expression),i=Container.createQueryExpressionCreator(e.entityContext);try{var j=i.Visit(h);this.entityContext.log({event:"EntityExpression",data:j}),e.entityContext.executeQuery(Container.createQueryable(e,j),g,d)}catch(k){g.error(k)}return f.getPromise()},take:function(a){this._checkOperation("take");var b=Container.createConstantExpression(a,"number"),c=Container.createPagingExpression(this.expression,b,$data.Expressions.ExpressionType.Take);return Container.createQueryable(this,c)},skip:function(a){this._checkOperation("skip");var b=Container.createConstantExpression(a,"number"),c=Container.createPagingExpression(this.expression,b,$data.Expressions.ExpressionType.Skip);return Container.createQueryable(this,c)},order:function(a){if(""===a||void 0===a||null===a)return this;if("-"===a[0]){var b="it."+a.replace("-","");return this.orderByDescending(b)}return this.orderBy("it."+a)},orderBy:function(a,b){this._checkOperation("orderBy");var c=Container.createCodeExpression(a,b),d=Container.createOrderExpression(this.expression,c,$data.Expressions.ExpressionType.OrderBy),e=Container.createQueryable(this,d);return e},orderByDescending:function(a,b){this._checkOperation("orderByDescending");var c=Container.createCodeExpression(a,b),d=Container.createOrderExpression(this.expression,c,$data.Expressions.ExpressionType.OrderByDescending),e=Container.createQueryable(this,d);return e},first:function(a,b,c,d){this._checkOperation("first");var e=this;a&&(e=this.filter(a,b)),e=e.take(1);var f=new $data.PromiseHandler,g=f.createCallback(c),h=Container.createFirstExpression(e.expression),i=Container.createQueryExpressionCreator(e.entityContext);try{var j=i.Visit(h);e.entityContext.log({event:"EntityExpression",data:j}),e.entityContext.executeQuery(Container.createQueryable(e,j),g,d)}catch(k){g.error(k)}return f.getPromise()},find:function(a,b,c){var d=new $data.PromiseHandler,e=d.createCallback(b),f=this.defaultType.memberDefinitions.getKeyProperties();try{if(1===f.length&&"object"!=typeof a){var g={};g[f[0].name]=a,a=g}if("object"!=typeof a)throw new Exception("Key parameter is invalid");for(var h=[],i=0;i<f.length;i++){var j=f[i];if(!(j.name in a))throw new Exception("Key value missing");h.push(Container.createConstantExpression(a[j.name],j.type,j.name))}var k=this.entityContext.storageProvider.supportedSetOperations.find;if(k){var l=Container.createFindExpression(this.expression,h),m=Container.createQueryExpressionCreator(this.entityContext);try{var n=m.Visit(l);this.entityContext.log({event:"EntityExpression",data:n}),this.entityContext.executeQuery(Container.createQueryable(this,n),e,c)}catch(o){e.error(o)}}else{for(var p="",q={},i=0;i<h.length;i++){var r=h[i];q[r.name]=r.value,i>0&&(p+=" && "),p+="it."+r.name+" == this."+r.name}this.single(p,q,e,c)}}catch(o){e.error(o)}return d.getPromise()},include:function(a){this._checkOperation("include");var b=Container.createConstantExpression(a,"string"),c=Container.createIncludeExpression(this.expression,b);return Container.createQueryable(this,c)},withInlineCount:function(a){this._checkOperation("withInlineCount");var b=Container.createConstantExpression(a||"allpages","string"),c=Container.createInlineCountExpression(this.expression,b);return Container.createQueryable(this,c)},removeAll:function(a,b){this._checkOperation("batchDelete");var c=new $data.PromiseHandler,d=c.createCallback(a),e=Container.createBatchDeleteExpression(this.expression),f=Container.createQueryExpressionCreator(this.entityContext);try{var g=f.Visit(e);this.entityContext.log({event:"EntityExpression",data:g}),this.entityContext.executeQuery(Container.createQueryable(this,g),d,b)}catch(h){d.error(h)}return c.getPromise()},_runQuery:function(a,b){var c=new $data.PromiseHandler,d=c.createCallback(a),e=Container.createQueryExpressionCreator(this.entityContext);try{var f=e.Visit(this.expression);this.entityContext.log({event:"EntityExpression",data:f}),this.entityContext.executeQuery(Container.createQueryable(this,f),d,b)}catch(g){d.error(g)}return c.getPromise()},toTraceString:function(a){var b=this.expression;b=a?Container["create"+a+"Expression"](b):Container.createToArrayExpression(b);var c=Container.createQueryExpressionCreator(this.entityContext);b=c.Visit(b);var d=Container.createQueryable(this,b);return d.entityContext.getTraceString(d)},_checkOperation:function(a){var b=this.entityContext.resolveSetOperations(a);void 0==b.invokable||b.invokable||Guard.raise(new Exception("Operation '"+a+"' is not invokable with the provider"))},defaultType:{}},null),$data.EntitySchemaConfig=function(){this.Name=""},$data.entitySetState={created:0,defined:1,active:2},$data.Class.defineEx("$data.EntitySet",[{type:$data.Queryable,params:[new ConstructorParameter(1)]}],null,{constructor:function(a,b,c,d,e){this.createNew=this[a.name]=this.elementType=this.defaultType=a;var f=this;b["createAdd"+a.name]=function(b){var c=new a(b);return f.add(c)},this.stateManager=new $data.EntityStateManager(this),this.collectionName=c,this.roles=e;for(var g in d)this[g]=d[g]},addNew:function(a,b){var c=($data.typeSystem.createCallbackSetting(b),new this.createNew(a));return this.entityContext.saveChanges(b),c},executeQuery:function(a,b){var c=$data.typeSystem.createCallbackSetting(b);this.entityContext.executeQuery(a,c)},getTraceString:function(a){return this.entityContext.getTraceString(a)},setContext:function(a){this.entitySetState=$data.entitySetState.active,this.entityContext=a,this.entityContext[this.schema.name]=this[this.schema.name]},_trackEntity:function(a){for(var b=this.entityContext.stateManager.trackedEntities,c=0;c<b.length;c++)if(b[c].data===a)return;b.push({entitySet:this,data:a})},add:function(a){var b=a;return a instanceof $data.EntityWrapper?b=a.getEntity():a instanceof this.createNew||(b=new this.createNew(a)),b.entityState=$data.EntityState.Added,b.changedProperties=void 0,b.context=this.entityContext,this._trackEntity(b),b},addMany:function(a){var b=[],c=this;return a.forEach(function(a){b.push(c.add(a))}),b},remove:function(a){var b=a;a instanceof $data.EntityWrapper?b=a.getEntity():a instanceof this.createNew||(b=new this.createNew(a)),b.entityState=$data.EntityState.Deleted,b.changedProperties=void 0,this._trackEntity(b)},attach:function(a,b){var c=a;a instanceof $data.EntityWrapper?c=a.getEntity():a instanceof this.createNew||(c=new this.createNew(a));for(var d=0;d<this.entityContext.stateManager.trackedEntities.length;d++){var e=this.entityContext.stateManager.trackedEntities[d];if(e.data===c)break;e.data.equals(c)&&Guard.raise(new Exception("Context already contains this entity!!!"))}if(b===!0)c.entityState=c.changedProperties&&c.changedProperties.length>0?$data.EntityState.Modified:$data.EntityState.Unchanged;else{"string"==typeof b&&(b=$data.EntityAttachMode[b]);var f=b||$data.EntityAttachMode[$data.EntityAttachMode.defaultMode];"function"==typeof f?f.call($data.EntityAttachMode,c):(c.entityState=$data.EntityState.Unchanged,c.changedProperties=void 0)}c.context=this.entityContext,this._trackEntity(c)},detach:function(a){var b=a;a instanceof $data.EntityWrapper?b=a.getEntity():a instanceof this.createNew||(b=new this.createNew(a));for(var c,d=this.entityContext.stateManager.trackedEntities,e=0;e<d.length;e++)d[e].data.equals(b)&&(c=d[e]);if(c){var f=this.entityContext.stateManager.trackedEntities.indexOf(c);return a.entityState=$data.EntityState.Detached,void this.entityContext.stateManager.trackedEntities.splice(f,1)}},attachOrGet:function(a,b){var c=a;a instanceof $data.EntityWrapper?c=a.getEntity():a instanceof this.createNew||(c=new this.createNew(a));for(var d,e=this.entityContext.stateManager.trackedEntities,f=0;f<e.length;f++)e[f].data.equals(c)&&(d=e[f]);if(d)return d.data;"string"==typeof b&&(b=$data.EntityAttachMode[b]);var g=b||$data.EntityAttachMode[$data.EntityAttachMode.defaultMode];return"function"==typeof g?g.call($data.EntityAttachMode,c):(c.entityState=$data.EntityState.Unchanged,c.changedProperties=void 0),c.context=this.entityContext,this._trackEntity(c),c},loadItemProperty:function(a,b,c){return this.entityContext.loadItemProperty(a,b,c)},saveChanges:function(){return this.entityContext.saveChanges.apply(this.entityContext,arguments)},addProperty:function(){return this.elementType.addProperty.apply(this.elementType,arguments)},expression:{get:function(){if(!this._expression){var a=Container.createEntityContextExpression(this.entityContext),b=this.entityContext.getType().getMemberDefinition(this.collectionName),c=Container.createEntitySetExpression(a,Container.createMemberInfoExpression(b),null,this);this._expression=c}return this._expression},set:function(a){this._expression=a}},getFieldUrl:function(a,b){return this.entityContext.getFieldUrl(a,b,this)},bulkInsert:function(a,b,c){return this.entityContext.bulkInsert(this,a,b,c)}},null),$data.EntityState={Detached:0,Unchanged:10,Added:20,Modified:30,Deleted:40},$data.Class.define("$data.EntityAttachMode",null,null,{},{defaultMode:"Default",AllChanged:function(a){for(var b=a.getType().memberDefinitions.getPublicMappedProperties(),c=0;c<b.length;c++)a._setPropertyChanged(b[c]);a.entityState=$data.EntityState.Modified},KeepChanges:function(a){a.entityState=a.changedProperties&&a.changedProperties.length>0?$data.EntityState.Modified:$data.EntityState.Unchanged},Default:function(a){a.entityState=$data.EntityState.Unchanged,a.changedProperties=void 0}}),$data.Class.define("$data.EntityStateManager",null,null,{constructor:function(a){this.entityContext=null,this.trackedEntities=[],this.init(a)},init:function(a){this.entityContext=a},reset:function(){this.trackedEntities=[]}},null),$data.Class.define("$data.ItemStoreClass",null,null,{constructor:function(){var a=this;a.itemStoreConfig={aliases:{},contextTypes:{}},a.resetStoreToDefault("local",!0),$data.addStore=function(){return a.addItemStoreAlias.apply(a,arguments)},$data.implementation=a.implementation,$data.Entity.addMember("storeToken",{get:function(){return this.storeConfigs&&this.storeConfigs["default"]?this.storeConfigs.stores[this.storeConfigs["default"]]:void 0},set:function(b){a._setTypeStoreConfig(this,"default",b)}},!0)},itemStoreConfig:{},addItemStoreAlias:function(a,b,c){var d=this,e=new $data.PromiseHandler,f=e.createCallback();if("string"==typeof a){if("object"==typeof b&&"factory"in b){var g=Container.resolveType(b.typeName);return d.itemStoreConfig.aliases[a]=b.factory,d.itemStoreConfig.contextTypes[a]=g,c&&(d.itemStoreConfig["default"]=a),f.success(),e.getPromise()}if("function"==typeof b){var h,i=b();return i&&i instanceof $data.EntityContext?(f.success(i),h=e.getPromise()):h=i,h.then(function(g){return"function"==typeof g?d.addItemStoreAlias(a,g,c):g instanceof $data.EntityContext?g.onReady().then(function(e){return d.itemStoreConfig.aliases[a]=b,d.itemStoreConfig.contextTypes[a]=e.getType(),c&&(d.itemStoreConfig["default"]=a),e}):(e=new $data.PromiseHandler,f=e.createCallback(),f.error(new Exception("factory dont have context instance","Invalid arguments")),e.getPromise())})}}return f.error(new Exception("Name or factory missing","Invalid arguments")),e.getPromise()},resetStoreToDefault:function(a,b){this.itemStoreConfig.aliases[a]=this._getDefaultItemStoreFactory,delete this.itemStoreConfig.contextTypes[a],b&&(this.itemStoreConfig["default"]=a)},_setStoreAlias:function(a,b){return"object"!=typeof b||a.storeToken||(a.storeToken=b),a},_getStoreAlias:function(a,b){var c;if(a instanceof $data.Entity){var d=b||a.storeToken;if(d)return d;c=a.getType()}else c=a;return b||(c.storeConfigs?c.storeConfigs["default"]:void 0)||c.storeToken},_getStoreContext:function(a,b,c){var d=this._getContextPromise(a,b);if(!d||d instanceof $data.EntityContext){var e=new $data.PromiseHandler,f=e.createCallback();f.success(d),d=e.getPromise()}return d.then(function(a){if(a instanceof $data.EntityContext)return a.onReady();if(c)return null;var b=new $data.PromiseHandler,d=b.createCallback();return d.error(new Exception("factory return type error","Error")),b.getPromise()})},_getContextPromise:function(a,b){if(a&&"object"==typeof a&&"function"==typeof a.factory)return a.factory(b);if(a&&"object"==typeof a&&"object"==typeof a.args&&"string"==typeof a.typeName){var b=Container.resolveType(a.typeName);return new b(JSON.parse(JSON.stringify(a.args)))}return a&&"string"==typeof a&&b.storeConfigs&&b.storeConfigs.stores[a]&&"function"==typeof b.storeConfigs.stores[a].factory?b.storeConfigs.stores[a].factory():a&&"string"==typeof a&&b.storeConfigs&&b.storeConfigs.stores[a]?this._getDefaultItemStoreFactory(b,b.storeConfigs.stores[a]):a&&"string"==typeof a&&this.itemStoreConfig.aliases[a]?this.itemStoreConfig.aliases[a](b):a&&"function"==typeof a?a():this.itemStoreConfig.aliases[this.itemStoreConfig["default"]](b)},_getStoreEntitySet:function(a,b){var c=this._getStoreAlias(b,a),d="function"==typeof b?b:b.getType();return this._getStoreContext(c,d).then(function(a){var b=a.getEntitySetFromElementType(d);if(!b){var c=new $data.PromiseHandler,e=c.createCallback();return e.error("EntitySet not exist for "+d.fullName),c.getPromise()}return b})},_getDefaultItemStoreFactory:function(a,b){if(a){var c="function"==typeof a?a:a.getType(),d=$data.Container.resolveName(c)+"_items",d=d.replace(/\./g,"_"),e=$data.typeSystem.extend({collectionName:b&&b.collectionName?b.collectionName:"Items",tableName:d,initParam:{provider:"local",databaseName:d}},b),f={};f[e.collectionName]={type:$data.EntitySet,elementType:c},e.tableName&&(f[e.collectionName].tableName=e.tableName);var g=$data.EntityContext.extend(d,f),h=new g(e.initParam);return b&&"object"==typeof b&&(b.factory=h._storeToken.factory),h}return void 0},implementation:function(a,b){var c,d=$data.ItemStore;return"string"==typeof b?b=d.itemStoreConfig.contextTypes[b]:b instanceof $data.EntityContext?b=b.getType():"function"==typeof b&&b.isAssignableTo||(b=d.itemStoreConfig.contextTypes[d.itemStoreConfig["default"]]),b&&(c=d._resolveFromContext(b,a)),c||(c=Container.resolveType(a)),c},_resolveFromContext:function(a,b){for(var c=a.memberDefinitions.getPublicMappedProperties(),d=0;d<c.length;d++){var e=c[d];if(e.type){var f=Container.resolveType(e.type);if(f.isAssignableTo&&f.isAssignableTo($data.EntitySet)){var g=Container.resolveType(e.elementType);if(g.name===b)return g}}}return null},EntityInstanceSave:function(a,b){var c=$data.ItemStore,d=this;return c._getStoreEntitySet(a,d).then(function(e){return c._getSaveMode(d,e,b,a).then(function(a){switch(a=a||"add"){case"add":e.add(d);break;case"attach":e.attach(d,!0),d.entityState=$data.EntityState.Modified;break;default:var b=new $data.PromiseHandler,f=b.createCallback();return f.error("save mode not supported: "+a),b.getPromise()}return e.entityContext.saveChanges().then(function(){return c._setStoreAlias(d,e.entityContext.storeToken),d})})})},EntityInstanceRemove:function(a){var b=$data.ItemStore,c=this;return b._getStoreEntitySet(a,c).then(function(a){return a.remove(c),a.entityContext.saveChanges().then(function(){return c})})},EntityInstanceRefresh:function(a,b){var c=$data.ItemStore,d=this,e=d.getType(),f=c._getKeyObjectFromEntity(d,e);return e.read(f,a).then(function(a){return e.memberDefinitions.getPublicMappedProperties().forEach(function(b){d[b.name]=a[b.name]}),d.storeToken=(b?d.storeToken:void 0)||a.storeToken,d.changedProperties=void 0,d})},EntityInheritedTypeProcessor:function(a){var b=$data.ItemStore;a.readAll=b.EntityTypeReadAll(a),a.read=b.EntityTypeRead(a),a.removeAll=b.EntityTypeRemoveAll(a),a.remove=b.EntityTypeRemove(a),a.get=b.EntityTypeGet(a),a.save=b.EntityTypeSave(a),a.addMany=b.EntityTypeAddMany(a),a.itemCount=b.EntityTypeItemCount(a),a.query=b.EntityTypeQuery(a),a.takeFirst=b.EntityTypeTakeFirst(a),a.setStore=b.EntityTypeSetStore(a)},EntityTypeReadAll:function(a){return function(b){var c=$data.ItemStore;return c._getStoreEntitySet(b,a).then(function(a){return a.forEach(function(b){c._setStoreAlias(b,a.entityContext.storeToken)})})}},EntityTypeRemoveAll:function(a){return function(b){var c=$data.ItemStore;return c._getStoreEntitySet(b,a).then(function(a){return a.toArray().then(function(b){return b.forEach(function(b){a.remove(b)}),a.entityContext.saveChanges().then(function(){return b})})})}},EntityTypeRead:function(a){return function(b,c){var d=$data.ItemStore;return d._getStoreEntitySet(c,a).then(function(a){try{var c=d._findByIdQueryable(a,b);return a.single(c.predicate,c.thisArgs).then(function(b){return d._setStoreAlias(b,a.entityContext.storeToken)})}catch(e){var f=new $data.PromiseHandler,g=f.createCallback();return g.error(e),f.getPromise()}})}},EntityTypeGet:function(a){return function(b,c){var d=$data.ItemStore,e=new a(d._getKeyObjectFromEntity(b));return e.refresh(c),e}},EntityTypeSave:function(a){return function(b,c,d){var e=($data.ItemStore,new a(b));return e.save(c,d)}},EntityTypeAddMany:function(a){return function(b,c){var d=$data.ItemStore;return d._getStoreEntitySet(c,a).then(function(a){var c=a.addMany(b);
return a.entityContext.saveChanges().then(function(){return c})})}},EntityTypeRemove:function(a){return function(b,c){var d,e=($data.ItemStore,a.memberDefinitions.getKeyProperties());if(1===e.length){var f={};f[e[0].name]=b,d=new a(f)}else d=new a(b);return d.remove(c)}},EntityTypeItemCount:function(a){return function(b){var c=$data.ItemStore;return c._getStoreEntitySet(b,a).then(function(a){return a.length()})}},EntityTypeQuery:function(a){return function(b,c,d){var e=$data.ItemStore;return e._getStoreEntitySet(d,a).then(function(a){return a.filter(b,c).forEach(function(b){e._setStoreAlias(b,a.entityContext.storeToken)})})}},EntityTypeTakeFirst:function(a){return function(b,c,d){var e=$data.ItemStore;return e._getStoreEntitySet(d,a).then(function(a){return a.first(b,c).then(function(b){return e._setStoreAlias(b,a.entityContext.storeToken)})})}},EntityTypeSetStore:function(a){return function(b,c){"object"==typeof b&&"undefined"==typeof c&&(c=b,b="default");var d=$data.ItemStore,e={};if(c){if(c.tableName&&(e.tableName=c.tableName,delete c.tableName),c.collectionName&&(e.collectionName=c.collectionName,delete c.collectionName),"string"==typeof c.dataSource){var f=c.dataSource;f.lastIndexOf("/")===f.length-1&&(f=f.substring(0,f.lastIndexOf("/")));var g=f.substring(0,f.lastIndexOf("/"));e.tableName||(e.tableName=f.substring(f.lastIndexOf("/")+1));var h=c.provider||c.name;switch(h){case"oData":c.oDataServiceHost=c.oDataServiceHost||g;break;case"webApi":c.apiUrl=c.apiUrl||g}}}else c={name:"local"};return e.initParam=c,d._setTypeStoreConfig(a,b,e),a}},_setTypeStoreConfig:function(a,b,c){a.storeConfigs||(a.storeConfigs={stores:{}}),a.storeConfigs.stores[b]=c,"default"===b&&(a.storeConfigs["default"]=b)},_findByIdQueryable:function(a,b){var c=a.defaultType.memberDefinitions.getKeyProperties();if(c.length>1&&b&&"object"==typeof b){for(var d="",e={},f=0;f<c.length;f++){f>0&&(d+=" && ");var g=c[f];d+="it."+g.name+" == this."+g.name,e[g.name]=b[g.name]}return{predicate:d,thisArgs:e}}if(1===c.length)return{predicate:"it."+c[0].name+" == this.value",thisArgs:{value:b}};throw"invalid keys"},_getKeyObjectFromEntity:function(a,b){var c,d=b.memberDefinitions.getKeyProperties();if(1===d.length)c=a&&"object"==typeof a?a[d[0].name]:a;else{c={};for(var e=0;e<d.length;e++)c[d[0].name]=a?a[d[0].name]:a}return c},_getSaveMode:function(a,b,c,d){var e=this,f=new $data.PromiseHandler,g=f.createCallback(),h=a.getType();switch(!0){case"update"===c:g.success("attach");break;case"new"===c:g.success("add");break;case!1===h.memberDefinitions.getKeyProperties().every(function(b){return a[b.name]}):g.success("add");break;case!!a.storeToken:g.success("attach");break;default:d=this._getStoreAlias(a,d),h.read(e._getKeyObjectFromEntity(a,h),d).then(function(){g.success("attach")}).fail(function(){g.success("add")})}return f.getPromise()},ContextRegister:function(a){var b=this,c=JSON.parse(JSON.stringify(a));this.storeToken={typeName:this.getType().fullName,args:c,factory:function(){return new(b.getType())(c)}};for(var d=this.getType().memberDefinitions.getPublicMappedProperties(),e=0;e<d.length;e++){var f=d[e];if(f.type){var g=Container.resolveType(f.type);if(g&&g.isAssignableTo&&g.isAssignableTo($data.EntitySet)){var h=Container.resolveType(f.elementType);h.storeToken||(h.storeToken=this.storeToken)}}}},QueryResultModifier:function(a){var b=$data.ItemStore,c=a.context,d=a.modelBinderConfig.$type;if("string"==typeof d&&(d=Container.resolveType(d)),d===$data.Array&&a.modelBinderConfig.$item&&a.modelBinderConfig.$item.$type&&(d=a.modelBinderConfig.$item.$type),"undefined"==typeof d&&a.result&&a.result[0]instanceof $data.Entity)for(var e=d?d.memberDefinitions.getPublicMappedProperties().filter(function(a){return!!a.inverseProperty}):[],f=0;f<a.result.length;f++){b._setStoreAlias(a.result[f],c.storeToken);for(var g=0;g<e.length;g++){var h=e[g];if(a.result[f][h.name]instanceof $data.Entity)b._setStoreAlias(a.result[f][h.name],c.storeToken);else if(Array.isArray(a.result[f][h.name]))for(var i=0;i<a.result[f][h.name].length;i++)a.result[f][h.name][i]instanceof $data.Entity&&b._setStoreAlias(a.result[f][h.name][i],c.storeToken)}}}}),$data.ItemStore=new $data.ItemStoreClass,$data.Entity.addMember("field",function(a){var b=this.memberDefinitions.getMember(a);if(b){if(b.definedBy===this)return new $data.MemberWrapper(b);Guard.raise(new Exception("Member '"+a+"' defined on '"+b.definedBy.fullName+"'!","Invalid Operation"))}else Guard.raise(new Exception("Member '"+a+"' not exists!","Invalid Operation"));return this},!0),$data.Class.define("$data.MemberWrapper",null,null,{constructor:function(a){this.memberDefinition=a},setKey:function(a){return this.memberDefinition.key=a||void 0===a?!0:!1,this},setComputed:function(a){return this.memberDefinition.computed=a||void 0===a?!0:!1,this},setRequired:function(a){return this.memberDefinition.required=a||void 0===a?!0:!1,this},setNullable:function(a){return this.memberDefinition.nullable=a||void 0===a?!0:!1,this},changeDefinition:function(a,b){return this.memberDefinition[a]=b,this}}),$data.Class.define("$data.StorageProviderLoaderBase",null,null,{isSupported:function(a){$data.Trace.log("Detecting "+a+" provider support");var b=!0;switch(a){case"indexedDb":b=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB&&!/^file:/.test(window.location.href);break;case"storm":b="XMLHttpRequest"in window;break;case"webSql":case"sqLite":b="openDatabase"in window;break;case"LocalStore":b="localStorage"in window&&window.localStorage?!0:!1;break;case"sqLite":b="openDatabase"in window;break;case"mongoDB":b=$data.mongoDBDriver}return $data.Trace.log(a+" provider is "+(b?"":"not")+" supported"),b},scriptLoadTimeout:{type:"int",value:1e3},scriptLoadInterval:{type:"int",value:50},npmModules:{value:{indexedDb:"jaydata-indexeddb",InMemory:"jaydata-inmemory",LocalStore:"jaydata-inmemory",mongoDB:"jaydata-mongodb",oData:"jaydata-odata",webApi:"jaydata-webapi",sqLite:"jaydata-sqlite",webSql:"jaydata-sqlite",storm:"jaydata-storm"}},ProviderNames:{value:{indexedDb:"IndexedDb",InMemory:"InMemory",LocalStore:"InMemory",oData:"oData",webApi:"WebApi",sqLite:"SqLite",webSql:"SqLite",storm:"Storm"}},load:function(a,b){$data.RegisteredStorageProviders=$data.RegisteredStorageProviders||{},$data.Trace.log("Loading provider(s): "+a),b=$data.typeSystem.createCallbackSetting(b);var c=this,d=a.join(",");c._fallbackCache=c._fallbackCache||{},c._fallbackCache[d]?b.success(c._fallbackCache[d]):this.find(a,{success:function(a){c._fallbackCache[d]=a,b.success.call(this,a)},error:b.error})},find:function(a,b){var c=a.shift(),c=this.getVirtual(c);for(Array.isArray(c)&&(a=c,c=a.shift());c&&!this.isSupported(c);)c=a.shift();if($data.Trace.log("First supported provider is "+c),c||($data.Trace.log("Provider fallback failed"),b.error()),$data.RegisteredStorageProviders){$data.Trace.log("Is the "+c+" provider already registered?");var d=$data.RegisteredStorageProviders[c];if(d)return $data.Trace.log(c+" provider registered"),void b.success(d);$data.Trace.log(c+" provider not registered")}"undefined"!=typeof module&&"undefined"!=typeof module.exports?($data.Trace.log("node.js detected trying to load NPM module"),this.loadNpmModule(c,a,b)):($data.Trace.log("Browser detected trying to load provider"),this.loadProvider(c,a,b))},loadProvider:function(a,b,c){var d=this,e=$data.StorageProviderLoader.ProviderNames[a]||a;if($data.Trace.log(a+" provider is mapped to name "+e+"Provider"),e){var f=this.getUrl(e);$data.Trace.log(a+" provider from URL: "+f);var g=this.loadScript;document&&document.createElement&&($data.Trace.log("document and document.createElement detected, using script element loader method"),g=this.loadScriptElement),g.call(this,f,a,function(e){var f=$data.RegisteredStorageProviders[a];e&&f?($data.Trace.log(a+" provider successfully registered"),c.success(f)):b.length>0?($data.Trace.log(a+" provider failed to load, trying to fallback to "+b+" provider(s)"),d.find(b,c)):($data.Trace.log(a+" provider failed to load"),c.error())})}},getUrl:function(){document.querySelector('script[src$="jaydata.min.js"]'),document.querySelector('script[src$="jaydata.js"]');return""},loadScript:function(a,b,c){function d(){return window.XMLHttpRequest?new XMLHttpRequest:void 0!==window.ActiveXObject?new ActiveXObject("MsXml2.XmlHttp"):($data.Trace.log("XMLHttpRequest or MsXml2.XmlHttp ActiveXObject not found"),void c(!1))}if(!a)return void c(!1);var e=d();e.onreadystatechange=function(){$data.Trace.log("HTTP request is in state: "+e.readyState),4==e.readyState&&(200==e.status||304==e.status?($data.Trace.log("HTTP request succeeded"),$data.Trace.log("HTTP request response text: "+e.responseText),eval.call(window,e.responseText),"function"==typeof c?c(!0):$data.Trace.log("Callback function is undefined")):($data.Trace.log("HTTP request status: ",e.status),"function"==typeof c?c(!1):$data.Trace.log("Callback function is undefined")))},e.open("GET",a,!0),e.send(null)},loadScriptElement:function(a,b,c){function d(){$data.Trace.log("Script element watcher iteration "+h);var a=$data.RegisteredStorageProviders[b];a?($data.Trace.log(b+" provider registered"),c(!0)):(h--,h>0?($data.Trace.log("Script element watcher next iteration"),setTimeout(d,g)):($data.Trace.log("Script element loader failed"),c(!1)))}var e=document.getElementsByTagName("head")[0]||document.documentElement,f=document.createElement("script");f.type="text/javascript",f.src=a,$data.Trace.log("Appending child "+f+" to "+e),e.appendChild(f);var g=this.scriptLoadInterval||50,h=Math.ceil(this.scriptLoadTimeout/g);$data.Trace.log("Script element watcher iterating "+h+" times"),setTimeout(d,g)},loadNpmModule:function(a,b,c){var d=null;try{require(this.npmModules[a]),d=$data.RegisteredStorageProviders[a],$data.Trace.log("NPM module loader successfully registered "+a+" provider")}catch(e){$data.Trace.log("NPM module loader failed for "+a+" provider")}d?c.success(d):b.length>0?this.find(b,c):c.error()},virtualProviders:{type:$data.Array,value:{local:{fallbacks:["webSql","indexedDb","LocalStore"]}}},getVirtual:function(a){return this.virtualProviders[a]?[].concat(this.virtualProviders[a].fallbacks):a}}),$data.StorageProviderLoader=new $data.StorageProviderLoaderBase,$data.storageProviders={DbCreationType:{Merge:10,DropTableIfChanged:20,DropTableIfChange:20,DropAllExistingTables:30,ErrorIfChange:40,DropDbIfChange:50}},$data.ConcurrencyMode={Fixed:"fixed",None:"none"},$data.Class.define("$data.StorageProviderBase",null,null,{constructor:function(a){if(this.providerConfiguration=a||{},this.name=this.getType().name,$data.RegisteredStorageProviders)for(var b=Object.keys($data.RegisteredStorageProviders),c=0;c<b.length;c++)if(this instanceof $data.RegisteredStorageProviders[b[c]]){this.name=b[c];break}},providers:{},supportedDataTypes:{value:[],writable:!1},initializeStore:function(){Guard.raise("Pure class")},executeQuery:function(){Guard.raise("Pure class")},loadRawData:function(a,b){b=$data.typeSystem.createCallbackSetting(b),b.error(new Exception("loadRawData is not supported","Invalid Operation"))},buildIndependentBlocks:function(a){function b(a){for(var b in a)if(a.hasOwnProperty(b))return!0;return!1}for(var c=[],d=[],e=0;e<a.length;e++){var f=a[e];if(f.dependentOn&&0!=f.dependentOn.length){for(var g=null,h=0;h<f.dependentOn.length;h++){var i=f.dependentOn[h];if(i.entityState!=$data.EntityState.Unchanged){g=g||{};for(var j=-1,k=0;k<a.length;k++)if(a[k].data==i){j=k;break}-1==j&&Guard.raise(new Exception("Dependent object not found","ObjectNotFound",f.dependentOn[h])),g[j]=!0,from=d[j]||{},from[e]=!0,d[j]=from}}null!==g&&(c[e]=g)}}for(var l=[],m=[],n=0;n<a.length;n++)c.hasOwnProperty(n)||m.push(n);for(;m.length>0;){var o=[].concat(m);m=[];for(var p=0;p<o.length;p++){var q=d[o[p]];if("undefined"!=typeof q)for(var r in q)delete c[r][o[p]],b(c[r])||(delete c[r],m.push(r));delete d[o[p]]}for(var s=[],t=0;t<o.length;t++){var u=a[o[t]];u.data.entityState!=$data.EntityState.Unchanged&&s.push(u)}s.length>0&&l.push(s)}return l},getTraceString:function(){Guard.raise("Pure class")},setContext:function(a){this.context=a},_buildContinuationFunction:function(a,b){Array.isArray(b.result)&&(b.result.next=this._buildPagingMethod(a,b,"next"),b.result.prev=this._buildPagingMethod(a,b,"prev"))},_buildPagingMethod:function(a,b,c){return function(d){var e=new $data.PromiseHandler,f=e.createCallback(d),g=new $data.Expressions.ContinuationExpressionBuilder(c),h=g.compile(b);if(h.expression){var i=Container.createQueryable(a,h.expression);i.defaultType=b.defaultType,a.executeQuery(i,f)}else f.error(new Exception(h.message,"Invalid Operation",h));return e.getPromise()}},buildDbType_modifyInstanceDefinition:function(a,b){var c=function(b,c){var d;return c?(d=JSON.parse(JSON.stringify(a[c])),d.kind=b.kind,d.name=b.name,d.notMapped=!1):d=JSON.parse(JSON.stringify(b)),d.dataType=Container.resolveType(b.dataType),d.type=d.dataType,d.key=!1,d.computed=!1,d},d=function(a,b,c,d,e){var f=new Object;return f[a.name]=c,f[b.name]=e?e:d+"__"+c,f};b.Associations&&b.Associations.forEach(function(b){var e=!1,f=b.FromType,g=b.ToType,h=b.ToPropertyName,i=b.FromType.getMemberDefinition(b.FromPropertyName),j=[];i&&"string"==typeof i.keys&&i.keys?j=[i.keys]:i&&Array.isArray(i.keys)&&(j=[].concat(i.keys)),b.ReferentialConstraint=b.ReferentialConstraint||[],("*"==b.FromMultiplicity&&"0..1"==b.ToMultiplicity||"0..1"==b.FromMultiplicity&&"1"==b.ToMultiplicity)&&(f=b.ToType,g=b.FromType,h=b.FromPropertyName,e=!0),f.memberDefinitions.getPublicMappedProperties().filter(function(a){return a.key}).forEach(function(i,k){var l=d(f,g,i.name,h,j[k]);if(e){a[l[g.name]]=c(i,h);var m=g.getMemberDefinition(j[k]);m&&(m.isDependentProperty=!0,m.navigationPropertyName=b.FromPropertyName)}b.ReferentialConstraint.push(l)},this)},this),b.ComplexTypes&&b.ComplexTypes.forEach(function(b){b.ReferentialConstraint=b.ReferentialConstraint||[],b.ToType.memberDefinitions.getPublicMappedProperties().forEach(function(e){a[b.FromPropertyName+"__"+e.name]=c(e),b.ReferentialConstraint.push(d(b.ToType,b.FromType,e.name,b.FromPropertyName))},this)},this)},buildDbType_generateConvertToFunction:function(a){return function(b){var c=new a.PhysicalType;return c.entityState=b.entityState,a.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(a){void 0!==b[a.name]&&(c[a.name]=b[a.name])},this),a.Associations&&a.Associations.forEach(function(a){if("*"==a.FromMultiplicity&&"0..1"==a.ToMultiplicity||"0..1"==a.FromMultiplicity&&"1"==a.ToMultiplicity){var d=b[a.FromPropertyName];void 0!==d&&a.ReferentialConstraint.forEach(function(b){c[b[a.From]]=null!==d?d[b[a.To]]:null},this)}},this),a.ComplexTypes&&a.ComplexTypes.forEach(function(a){var d=b[a.FromPropertyName];void 0!==d&&a.ReferentialConstraint.forEach(function(b){c[b[a.From]]=null!==d?d[b[a.To]]:null},this)},this),c}},bulkInsert:function(a,b,c,d){d.error(new Exception("Not Implemented"))},supportedFieldOperations:{value:{length:{dataType:"number",allowedIn:"filter, map"},substr:{dataType:"string",allowedIn:"filter",parameters:[{name:"startFrom",dataType:"number"},{name:"length",dataType:"number"}]},toLowerCase:{dataType:"string"}},enumerable:!0,writable:!0},resolveFieldOperation:function(a,b,c){var d=this.supportedFieldOperations[a];if(Array.isArray(d)){for(var e=0;e<d.length;e++)if("default"===d[e].allowedType||Container.resolveType(d[e].allowedType)===Container.resolveType(b.selector.memberDefinition.type)&&c&&d[e].allowedIn&&(Array.isArray(d[e].allowedIn)&&d[e].allowedIn.some(function(a){return c===Container.resolveType(a)})||!Array.isArray(d[e].allowedIn)&&c===Container.resolveType(d[e].allowedIn))){d=d[e];break}e===d.length&&(d=void 0)}return d||Guard.raise(new Exception("Field operation '"+a+"' is not supported by the provider")),c&&d.allowedIn&&(d.allowedIn instanceof Array&&!d.allowedIn.some(function(a){return c===Container.resolveType(a)})||!(d.allowedIn instanceof Array)&&c!==Container.resolveType(d.allowedIn))&&Guard.raise(new Exception(a+" not supported in: "+c.name)),d.name=a,d},supportedBinaryOperators:{value:{equal:{mapTo:"eq",dataType:"boolean"}},enumerable:!0,writable:!0},resolveBinaryOperator:function(a,b,c){var d=this.supportedBinaryOperators[a];return d||Guard.raise(new Exception("Binary operator '"+a+"' is not supported by the provider")),c&&d.allowedIn&&(d.allowedIn instanceof Array&&!d.allowedIn.some(function(a){return c===Container.resolveType(a)})||!(d.allowedIn instanceof Array)&&c!==Container.resolveType(d.allowedIn))&&Guard.raise(new Exception(a+" not supported in: "+c.name)),d.name=a,d},supportedUnaryOperators:{value:{not:{mapTo:"not"}},enumerable:!0,writable:!0},resolveUnaryOperator:function(a,b,c){var d=this.supportedUnaryOperators[a];return d||Guard.raise(new Exception("Unary operator '"+a+"' is not supported by the provider")),c&&d.allowedIn&&(d.allowedIn instanceof Array&&!d.allowedIn.some(function(a){return c===Container.resolveType(a)})||!(d.allowedIn instanceof Array)&&c!==Container.resolveType(d.allowedIn))&&Guard.raise(new Exception(a+" not supported in: "+c.name)),d.name=a,d},supportedSetOperations:{value:{toArray:{invokable:!0,allowedIn:[]}},enumerable:!0,writable:!0},resolveSetOperations:function(a,b,c){var d=this.supportedSetOperations[a];d||Guard.raise(new Exception("Operation '"+a+"' is not supported by the provider"));var e=d.allowedIn||[];return c&&e&&(e instanceof Array&&!e.some(function(a){return c===Container.resolveType(a)})||!(e instanceof Array)&&c!==Container.resolveType(e))&&Guard.raise(new Exception(a+" not supported in: "+c.name)),d},resolveTypeOperations:function(a,b){Guard.raise(new Exception("Entity '"+b.entityType.name+"' Operation '"+a+"' is not supported by the provider"))},resolveContextOperations:function(a,b){Guard.raise(new Exception("Context '"+b.instance.getType().name+"' Operation '"+a+"' is not supported by the provider"))},makePhysicalTypeDefinition:function(){},_beginTran:function(a,b,c){c.success(new $data.Transaction)},getFieldUrl:function(){return"#"},supportedAutoincrementKeys:{value:{}}},{onRegisterProvider:{value:new $data.Event},registerProvider:function(a,b){this.onRegisterProvider.fire({name:a,provider:b},this),$data.RegisteredStorageProviders=$data.RegisteredStorageProviders||[],$data.RegisteredStorageProviders[a]=b},getProvider:function(a){var b=$data.RegisteredStorageProviders[a];return b||console.warn("Provider not found: '"+a+"'"),b},isSupported:{get:function(){return!0},set:function(){}}}),$data.Class.define("$data.ServiceOperation",null,null,{},{translateDefinition:function(a,b){a.serviceName=b;var c=new $data.MemberDefinition(this.generateServiceOperation(a),this);return c.name=b,c},generateServiceOperation:function(a){var b;if(a.serviceMethod){var c=a.returnType?Container.resolveType(a.returnType):{};b=c.isAssignableTo&&c.isAssignableTo($data.Queryable)?a.serviceMethod:function(){{var b,c=arguments[arguments.length-1],d=new $data.PromiseHandler;arguments}"function"==typeof c?(b=d.createCallback(c),arguments[arguments.length-1]=b):(b=d.createCallback(),arguments.push(b));try{var e=a.serviceMethod.apply(this,arguments);void 0!==e&&b.success(e)}catch(f){b.error(f)}return d.getPromise()}}else b=function(){var b,c,d=this;if(this instanceof $data.Entity||this instanceof $data.EntitySet){var e;if(this instanceof $data.Entity)if(this.context)d=this.context,e=d.getEntitySetFromElementType(this.getType());else{if(!this.storeToken||"function"!=typeof this.storeToken.factory)return void Guard.raise(new Exception("entity can't resolve context","Not Found!",this));d=this.storeToken.factory(),e=d.getEntitySetFromElementType(this.getType())}else if(this instanceof $data.EntitySet){d=this.entityContext,e=this;var f=d.getType().getMemberDefinition(e.name);b=$data.MemberDefinition.translateDefinition(f.actions[a.serviceName],a.serviceName,e.getType())}c={data:this,entitySet:e}}var g=a.elementType?d.getEntitySetFromElementType(Container.resolveType(a.elementType)):null,h=null;if(a.params)if(h=[],arguments[0]&&"object"==typeof arguments[0]&&arguments[0].constructor===$data.Object&&a.params&&a.params[0]&&a.params[0].name in arguments[0])for(var i=arguments[0],j=0;j<a.params.length;j++){var k=a.params[j];k.name&&k.type&&k.name in i&&h.push(Container.createConstantExpression(i[k.name],Container.resolveType(k.type),k.name))}else for(var j=0;j<a.params.length&&"function"!=typeof arguments[j];j++){var k=a.params[j];k.name&&k.type&&void 0!==arguments[j]&&h.push(Container.createConstantExpression(arguments[j],Container.resolveType(k.type),k.name))}var l=Container.createEntityContextExpression(d);b||(b=c&&c.data?c.data.getType().getMemberDefinition(a.serviceName):d.getType().getMemberDefinition(a.serviceName));var m=Container.createServiceOperationExpression(l,Container.createMemberInfoExpression(b),h,a,c),n=arguments[arguments.length-1];if("function"!=typeof n&&("object"!=typeof n||"function"!=typeof n.success&&"function"!=typeof n.error)&&(n=void 0),g){var o=Container.createQueryable(g,m);return n?(m.isTerminated=!0,o._runQuery(n)):o}var p=a.returnType?Container.resolveType(a.returnType):null,o=Container.createQueryable(d,m);return o.defaultType=p||$data.Object,p===$data.Queryable?(o.defaultType=Container.resolveType(a.elementType),n?(m.isTerminated=!0,o._runQuery(n)):o):(m.isTerminated=!0,o._runQuery(n))};var d=a.params||[];return $data.typeSystem.extend(b,a,{params:d}),b}}),$data.Class.define("$data.ServiceAction",$data.ServiceOperation,null,{},{generateServiceOperation:function(a){return a.method||(a.method="POST"),$data.ServiceOperation.generateServiceOperation.apply(this,arguments)}}),$data.Base.extend("$data.EntityWrapper",{getEntity:function(){Guard.raise("pure object")}}),"undefined"!=typeof jQuery&&jQuery.ajax&&($data.ajax=$data.ajax||jQuery.ajax),"undefined"!=typeof WinJS&&WinJS.xhr&&($data.ajax=$data.ajax||function(a){$data.typeSystem.extend(a,{dataType:"json",headers:{}});var b={json:{accept:"application/json, text/javascript",convert:JSON.parse},text:{accept:"text/plain",convert:function(a){return a}},html:{accept:"text/html",convert:function(a){return a}},xml:{accept:"application/xml, text/xml",convert:function(a){return a}}},c=b[a.dataType.toLowerCase()];a.headers.Accept=c.accept;var d=a.success||$data.defaultSuccessCallback,e=a.error||$data.defaultErrorCallback,f=a.progress,g=function(a){var b=c.convert(a.responseText);d(b)},h=function(a){var b=c.convert(a.responseText);e(b)},i=f;WinJS.xhr(a).done(g,h,i)}),"undefined"!=typeof Ext&&($data.ajax=$data.ajax||function(a){Ext.Ajax.request(a)}),$data.ajax=$data.ajax||function(){var a=arguments[arguments.length-1],b=$data.typeSystem.createCallbackSetting(a);b.error("Not implemented")},$C("$data.modelBinder.FindProjectionVisitor",$data.Expressions.EntityExpressionVisitor,null,{VisitProjectionExpression:function(a){this.projectionExpression=a}}),$C("$data.modelBinder.ModelBinderConfigCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a,b,c){this._query=a,this._includes=b,this._isoDataProvider=c||!1},VisitSingleExpression:function(a){this._defaultModelBinder(a)},VisitSomeExpression:function(a){this._defaultModelBinder(a)},VisitFindExpression:function(a){this._defaultModelBinder(a)},VisitEveryExpression:function(a){this._defaultModelBinder(a)},VisitToArrayExpression:function(a){this._defaultModelBinder(a)},VisitFirstExpression:function(a){this._defaultModelBinder(a)},VisitForEachExpression:function(a){this._defaultModelBinder(a)},VisitServiceOperationExpression:function(a){if(a.cfg.returnType){var b=Container.resolveType(a.cfg.returnType);if("function"==typeof b.isAssignableTo&&b.isAssignableTo($data.Queryable)||b===$data.Array)this._defaultModelBinder(a);else{var c=Container.createqueryBuilder();c.modelBinderConfig.$type=b,"function"==typeof b.isAssignableTo&&b.isAssignableTo($data.Entity)?c.modelBinderConfig.$selector=["json:"+a.cfg.serviceName]:(c.modelBinderConfig.$type=b,c.modelBinderConfig.$value=function(b,c){return a.cfg.serviceName in c?c[a.cfg.serviceName]:c.value}),this.VisitExpression(a,c),c.resetModelBinderProperty(),this._query.modelBinderConfig=c.modelBinderConfig}}},VisitCountExpression:function(){var a=Container.createqueryBuilder();a.modelBinderConfig.$type=$data.Array,a.selectModelBinderProperty("$item"),a.modelBinderConfig.$type=$data.Integer,a.modelBinderConfig.$source="cnt",a.resetModelBinderProperty(),this._query.modelBinderConfig=a.modelBinderConfig},VisitBatchDeleteExpression:function(){var a=Container.createqueryBuilder();a.modelBinderConfig.$type=$data.Array,a.selectModelBinderProperty("$item"),a.modelBinderConfig.$type=$data.Integer,a.modelBinderConfig.$source="cnt",a.resetModelBinderProperty(),this._query.modelBinderConfig=a.modelBinderConfig},VisitConstantExpression:function(a,b){b.modelBinderConfig.$type=a.type,b.modelBinderConfig.$value=a.value},VisitExpression:function(a,b){var c=Container.createFindProjectionVisitor();c.Visit(a),c.projectionExpression?this.Visit(c.projectionExpression,b):this.DefaultSelection(b,this._query.defaultType,this._includes)},_defaultModelBinder:function(a){var b=Container.createqueryBuilder();b.modelBinderConfig.$type=$data.Array,this._isoDataProvider&&(b.modelBinderConfig.$selector=["json:d.results","json:d","json:results"]),b.modelBinderConfig.$item={},b.selectModelBinderProperty("$item"),this.VisitExpression(a,b),b.resetModelBinderProperty(),this._query.modelBinderConfig=b.modelBinderConfig},_addPropertyToModelBinderConfig:function(a,b){var c=this._query.context._storageModel.getStorageModel(a);a.memberDefinitions?a.memberDefinitions.getPublicMappedProperties().forEach(function(a){if(!c||c&&!c.Associations[a.name]&&!c.ComplexTypes[a.name]){var d=Container.resolveType(a.dataType);if(!c&&this._query.context.storageProvider.supportedDataTypes.indexOf(d)<0)b.selectModelBinderProperty(a.name),b.modelBinderConfig.$type=d,b.modelBinderConfig.$selector=this._isoDataProvider?["json:"+a.name+".results","json:"+a.name]:"json:"+a.name,this._addPropertyToModelBinderConfig(d,b),b.popModelBinderProperty();else if(a.key&&b.addKeyField(a.name),a.concurrencyMode===$data.ConcurrencyMode.Fixed)b.modelBinderConfig[a.name]={$selector:"json:__metadata",$source:"etag"};else if(d===$data.Array&&a.elementType){b.selectModelBinderProperty(a.name),b.modelBinderConfig.$type=d,b.modelBinderConfig.$selector=this._isoDataProvider?["json:"+a.name+".results","json:"+a.name]:"json:"+a.name,b.selectModelBinderProperty("$item");var e=Container.resolveType(a.elementType);b.modelBinderConfig.$type=e,this._addPropertyToModelBinderConfig(e,b),b.popModelBinderProperty(),b.popModelBinderProperty()}else b.modelBinderConfig[a.name]=a.name}},this):(b._binderConfig.$item=b._binderConfig.$item||{},b.modelBinderConfig=b._binderConfig.$item),c&&this._addComplexTypeProperties(c.ComplexTypes,b)},_addComplexTypeProperties:function(a,b){a.forEach(function(a){if(a.ToType!==$data.Array)b.selectModelBinderProperty(a.FromPropertyName),b.modelBinderConfig.$type=a.ToType,b.modelBinderConfig.$selector=this._isoDataProvider?["json:"+a.FromPropertyName+".results","json:"+a.FromPropertyName]:"json:"+a.FromPropertyName,this._addPropertyToModelBinderConfig(a.ToType,b),b.popModelBinderProperty();else{var c=a.ToType,d=Container.resolveType(a.FromType.memberDefinitions.getMember(a.FromPropertyName).elementType);if(c===$data.Array&&d&&d.isAssignableTo&&d.isAssignableTo($data.Entity)){config={$type:$data.Array,$selector:"json:"+a.FromPropertyName,$item:{$type:d}};for(var e=d.memberDefinitions.getPublicMappedProperties(),f=0;f<e.length;f++)config.$item[e[f].name]={$type:e[f].type,$source:e[f].name};b.modelBinderConfig[a.FromPropertyName]=config}else b.modelBinderConfig[a.FromPropertyName]={$type:a.ToType,$source:a.FromPropertyName}}},this)},DefaultSelection:function(a,b,c){a.modelBinderConfig.$type=b;var d=this._query.context._storageModel.getStorageModel(b);this._addPropertyToModelBinderConfig(b,a),c&&c.forEach(function(b){for(var c=b.name.split("."),e=null,f=d,g=0,h=0;h<c.length;h++)a.modelBinderConfig.$item&&(a.selectModelBinderProperty("$item"),g++),a.selectModelBinderProperty(c[h]),e=f.Associations[c[h]],f=this._query.context._storageModel.getStorageModel(e.ToType);a.modelBinderConfig.$selector=this._isoDataProvider?["json:"+c[c.length-1]+".results","json:"+c[c.length-1]]:"json:"+c[c.length-1],"*"===e.ToMultiplicity?(a.modelBinderConfig.$type=$data.Array,a.selectModelBinderProperty("$item"),a.modelBinderConfig.$type=b.type,this._addPropertyToModelBinderConfig(b.type,a),a.popModelBinderProperty()):(a.modelBinderConfig.$type=b.type,this._addPropertyToModelBinderConfig(b.type,a));for(var h=0;h<c.length+g;h++)a.popModelBinderProperty()},this)},VisitProjectionExpression:function(a,b){this.hasProjection=!0,this.Visit(a.selector,b),a.selector&&a.selector.expression instanceof $data.Expressions.ObjectLiteralExpression&&(b.modelBinderConfig.$type=a.projectionAs||b.modelBinderConfig.$type||$data.Object)},VisitParametricQueryExpression:function(a,b){a.expression instanceof $data.Expressions.EntityExpression||a.expression instanceof $data.Expressions.EntitySetExpression?this.VisitEntityAsProjection(a,b):this.Visit(a.expression,b)},VisitEntityAsProjection:function(a,b){this.mapping="",this.Visit(a.expression,b);var c;this.mapping&&this._includes instanceof Array&&(c=this._includes.filter(function(a){return 0===a.name.indexOf(this.mapping+".")},this),c=c.map(function(a){return{name:a.name.replace(this.mapping+".",""),type:a.type}},this),c.length>0&&this.DefaultSelection(b,a.expression.entityType,c)),a.expression instanceof $data.Expressions.EntityExpression?this.DefaultSelection(b,a.expression.entityType):a.expression instanceof $data.Expressions.EntitySetExpression&&(b.modelBinderConfig.$type=$data.Array,b.modelBinderConfig.$item={},b.selectModelBinderProperty("$item"),this.DefaultSelection(b,a.expression.elementType),b.popModelBinderProperty())},VisitEntityFieldExpression:function(a,b){this.Visit(a.source,b),this.Visit(a.selector,b)},VisitMemberInfoExpression:function(a,b){b.modelBinderConfig.$type=a.memberDefinition.type,a.memberDefinition.storageModel&&a.memberName in a.memberDefinition.storageModel.ComplexTypes?this._addPropertyToModelBinderConfig(Container.resolveType(a.memberDefinition.type),b):b.modelBinderConfig.$type&&Container.resolveType(b.modelBinderConfig.$type).isAssignableTo&&Container.resolveType(b.modelBinderConfig.$type).isAssignableTo($data.Entity)||(b.modelBinderConfig.$source=a.memberName)},VisitEntitySetExpression:function(a,b){a.source instanceof $data.Expressions.EntityExpression&&(this.Visit(a.source,b),this.Visit(a.selector,b))},VisitComplexTypeExpression:function(a,b){if(this.Visit(a.source,b),this.Visit(a.selector,b),"$selector"in b.modelBinderConfig&&b.modelBinderConfig.$selector.length>0)if(b.modelBinderConfig.$selector instanceof $data.Array){var c=b.modelBinderConfig.$selector[1];b.modelBinderConfig.$selector[0]=c+"."+a.selector.memberName+".results",b.modelBinderConfig.$selector[1]=c+"."+a.selector.memberName}else b.modelBinderConfig.$selector+="."+a.selector.memberName;else b.modelBinderConfig.$selector=this._isoDataProvider?["json:"+a.selector.memberName+".results","json:"+a.selector.memberName]:"json:"+a.selector.memberName},VisitEntityExpression:function(a,b){this.Visit(a.source,b)},VisitAssociationInfoExpression:function(a,b){if("$selector"in b.modelBinderConfig&&b.modelBinderConfig.$selector.length>0)if(b.modelBinderConfig.$selector instanceof $data.Array){var c=b.modelBinderConfig.$selector[1];b.modelBinderConfig.$selector[0]=c+"."+a.associationInfo.FromPropertyName+".results",b.modelBinderConfig.$selector[1]=c+"."+a.associationInfo.FromPropertyName}else b.modelBinderConfig.$selector+="."+a.associationInfo.FromPropertyName;else b.modelBinderConfig.$selector=this._isoDataProvider?["json:"+a.associationInfo.FromPropertyName+".results","json:"+a.associationInfo.FromPropertyName]:"json:"+a.associationInfo.FromPropertyName;this.mapping&&this.mapping.length>0&&(this.mapping+="."),this.mapping+=a.associationInfo.FromPropertyName
},VisitObjectLiteralExpression:function(a,b){b.modelBinderConfig.$type=$data.Object,a.members.forEach(function(a){this.Visit(a,b)},this)},VisitObjectFieldExpression:function(a,b){b.selectModelBinderProperty(a.fieldName),a.expression instanceof $data.Expressions.EntityExpression||a.expression instanceof $data.Expressions.EntitySetExpression?this.VisitEntityAsProjection(a,b):this.Visit(a.expression,b),b.popModelBinderProperty()}}),$data.Class.define("$data.Authentication.AuthenticationBase",null,null,{constructor:function(a){this.configuration=a||{},this.Authenticated=!1},Login:function(){Guard.raise("Pure class")},Logout:function(){Guard.raise("Pure class")},CreateRequest:function(){Guard.raise("Pure class")}},null),$data.Class.define("$data.Authentication.Anonymous",$data.Authentication.AuthenticationBase,null,{constructor:function(a){this.configuration=a||{},this.Authenticated=!1},Login:function(){},Logout:function(){},CreateRequest:function(a){$data.ajax(a)}},null),$data.Class.define("$data.Authentication.FacebookAuth",$data.Authentication.AuthenticationBase,null,{constructor:function(a){this.configuration=$data.typeSystem.extend({Url_code:"",type_code:"",scope:"",Url_token:"",type_token:"",access_token:"",app_id:""},a)},Login:function(a){if(!this.Authenticated){var b=this;b.configuration.stateCallbacks=a||{},$data.ajax({url:this.configuration.Url_code,data:"type="+b.configuration.type_code+"&client_id="+b.configuration.app_id+"&scope="+b.configuration.scope,type:"POST",dataType:"json",success:function(a){"function"==typeof b.configuration.stateCallbacks.pending&&b.configuration.stateCallbacks.pending(a),b._processRequestToken(a),b.Authenticated=!0},error:function(){"function"==typeof b.configuration.stateCallbacks.error&&b.configuration.stateCallbacks.error(arguments)}})}},Logout:function(){this.Authenticated=!1},CreateRequest:function(a){if(a){if(-1===a.url.indexOf("access_token=")&&a.url&&this.Authenticated){var b="?";a.url.indexOf(b)>0&&(b="&"),this.configuration.access_token&&(a.url=a.url+b+"access_token="+this.configuration.access_token)}$data.ajax(a)}},_processRequestToken:function(verification_data){var provider=this;$data.ajax({url:provider.configuration.Url_token,data:"type="+provider.configuration.type_token+"&client_id="+provider.configuration.app_id+"&code="+verification_data.code,type:"POST",dataType:"json",success:function(a){provider.configuration.access_token=a.access_token,"function"==typeof provider.configuration.stateCallbacks.success&&provider.configuration.stateCallbacks.success(a)},error:function(obj){var data=eval("("+obj.responseText+")");data.error&&("authorization_pending"==data.error.message?setTimeout(function(){provider._processRequestToken(verification_data)},2e3):"function"==typeof provider.configuration.stateCallbacks.abort&&provider.configuration.stateCallbacks.abort(arguments))}})}},null),$data.Class.define("$data.Authentication.BasicAuth.BasicAuth",$data.Authentication.AuthenticationBase,null,{constructor:function(a){this.configuration=$data.typeSystem.extend({Username:"",Password:""},a)},Login:function(a){a&&"function"==typeof a.pending&&a.pending()},Logout:function(){},CreateRequest:function(a){if(a){var b=this,c=a.beforeSend;a.beforeSend=function(a){a.setRequestHeader("Authorization","Basic  "+b.__encodeBase64(b.configuration.Username+":"+b.configuration.Password)),"function"==typeof c&&c(a)},$data.ajax(a)}},__encodeBase64:function(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";input=a;var c,d,e,f,g,h="",i="",j="",k=0;do c=input.charCodeAt(k++),d=input.charCodeAt(k++),i=input.charCodeAt(k++),e=c>>2,f=(3&c)<<4|d>>4,g=(15&d)<<2|i>>6,j=63&i,isNaN(d)?g=j=64:isNaN(i)&&(j=64),h=h+b.charAt(e)+b.charAt(f)+b.charAt(g)+b.charAt(j),c=d=i="",e=f=g=j="";while(k<input.length);return h}},null),$data.Class.define("$data.MetadataLoaderClass",null,null,{load:function(a,b,c){var d={EntityBaseClass:"$data.Entity",ContextBaseClass:"$data.EntityContext",AutoCreateContext:!1,DefaultNamespace:("ns"+Math.random()).replace(".","")+a.replace(/[^\w]/g,"_"),ContextInstanceName:"context",EntitySetBaseClass:"$data.EntitySet",CollectionBaseClass:"Array",url:a,user:void 0,password:void 0,withCredentials:void 0,httpHeaders:void 0,typeFilter:"",navigation:!0,generateKeys:!0,dependentRelationsOnly:!1};if($data.typeSystem.extend(d,c||{}),d.DefaultNamespace&&d.DefaultNamespace.lastIndexOf(".")!==d.DefaultNamespace.length-1&&(d.DefaultNamespace+="."),this.factoryCache=this.factoryCache||{},b=$data.typeSystem.createCallbackSetting(b),a in this.factoryCache)return void b.success.apply({},this.factoryCache[a]);var a;d.url?(d.SerivceUri=d.url.replace("/$metadata",""),d.metadataUri=-1===d.url.indexOf("/$metadata")?d.url.replace(/\/+$/,"")+"/$metadata":d.url):b.error("metadata url is missing");var e=this;e._loadXMLDoc(d,function(a,c){if(c.statusCode<200||c.statusCode>299)return void b.error(c);var f=e._findVersion(a);e.xsltRepoUrl?(console.log("XSLT: "+e.xsltRepoUrl+e._supportedODataVersionXSLT),e._loadXMLDoc({metadataUri:e.xsltRepoUrl+e._supportedODataVersionXSLT,user:d.user,password:d.password,httpHeaders:d.httpHeaders},function(c,g){if(g.statusCode<200||g.statusCode>299)return void b.error(g);var h=g.responseText;if(h=h.replace('xmlns:edm="@@VERSIONNS@@"','xmlns:edm="'+f.ns+'"'),h=h.replace("@@VERSION@@",f.version),void 0===window.ActiveXObject){var i=new DOMParser;c=i.parseFromString(h,"text/xml")}else c=new ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.loadXML(h);e._transform(b,f,a,c,d)})):e._transform(b,f,a,void 0,d)})},debugMode:{type:"bool",value:!1},xsltRepoUrl:{type:"string",value:""},createFactoryFunc:function(a,b,c){return function(d){if(a){var e=$data.typeSystem.extend({name:"oData",oDataServiceHost:b.SerivceUri,user:b.user,password:b.password,withCredentials:b.withCredentials,maxDataServiceVersion:c.maxVersion||"3.0"},d);return new a(e)}return null}},_transform:function(callBack,versionInfo,xml,xsl,cnf){var self=this,codeText=self._processResults(cnf.url,versionInfo,xml,xsl,cnf);try{eval(codeText)}catch(e){return void callBack.error(new Exception("SyntaxError","Unexpected model",[e,codeText]))}var ctxType;if(!$data.generatedContexts||!(ctxType=$data.generatedContexts.pop()))return void callBack.error(new Exception("No context found in service","Not found",[cnf,codeText]));var factoryFn=self.createFactoryFunc(ctxType,cnf,versionInfo);this.factoryCache[cnf.url]=[factoryFn,ctxType],factoryFn.type=ctxType,self.debugMode?(factoryFn.codeText=codeText,callBack.success(factoryFn,ctxType,codeText)):callBack.success(factoryFn,ctxType)},_loadXMLDoc:function(a,b){var c=this;$data.postMessageODataHandler?(a.user&&a.password&&(!a.httpHeaders||a.httpHeaders&&!a.httpHeaders.Authorization)&&(httpHeader=httpHeader||{},httpHeader.Authorization="Basic "+this.__encodeBase64(a.user+":"+a.password)),$data.postMessageODataHandler.requestProxy({url:a.metadataUri,httpHeaders:a.httpHeaders,success:function(a){var c;if("undefined"!=typeof module&&"undefined"!=typeof require)c=a.responseText;else if(window.ActiveXObject)c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(a.responseText);else{var d=new DOMParser;c=d.parseFromString(a.responseText,"text/xml")}b(c,a)},error:function(){c._loadXHTTP_XMLDoc(a,b)}})):this._loadXHTTP_XMLDoc(a,b)},_loadXHTTP_XMLDoc:function(a,b){var c=new XMLHttpRequest;c.open("GET",a.metadataUri,!0),a.httpHeaders&&Object.keys(a.httpHeaders).forEach(function(b){c.setRequestHeader(b,a.httpHeaders[b])}),c.onreadystatechange=function(){if(4===c.readyState){var d={requestUri:a.metadataUri,statusCode:c.status,statusText:c.statusText,responseText:c.responseText};b(c.responseXML||c.responseText,d)}},a.user&&a.password&&(!a.httpHeaders||a.httpHeaders&&!a.httpHeaders.Authorization)&&c.setRequestHeader("Authorization","Basic "+this.__encodeBase64(a.user+":"+a.password)),c.send("")},_processResults:function(a,b,c,d,e){var f=this.getCurrentXSLTVersion(b,c);if(e.typeFilter=this._prepareTypeFilter(c,b,e),void 0!==window.ActiveXObject){var g,h=new ActiveXObject("Msxml2.XSLTemplate.6.0"),i=new ActiveXObject("Msxml2.FreeThreadedDOMDocument.6.0");if(i.async=!1,d?i.load(d):i.loadXML(f),0!=i.parseError.errorCode){i.parseError}else{h.stylesheet=i;var j=new ActiveXObject("Msxml2.DOMDocument.6.0");if(j.async=!1,j.load(c),0==j.parseError.errorCode)return g=h.createProcessor(),g.input=j,g.addParameter("SerivceUri",e.SerivceUri),g.addParameter("EntityBaseClass",e.EntityBaseClass),g.addParameter("ContextBaseClass",e.ContextBaseClass),g.addParameter("AutoCreateContext",e.AutoCreateContext),g.addParameter("ContextInstanceName",e.ContextInstanceName),g.addParameter("EntitySetBaseClass",e.EntitySetBaseClass),g.addParameter("CollectionBaseClass",e.CollectionBaseClass),g.addParameter("DefaultNamespace",e.DefaultNamespace),g.addParameter("MaxDataserviceVersion",b.maxVersion||"3.0"),g.addParameter("AllowedTypesList",e.typeFilter),g.addParameter("GenerateNavigationProperties",e.navigation),g.transform(),g.output;{j.parseError}}return""}if("undefined"!=typeof document&&document.implementation&&document.implementation.createDocument){var k;if(d)k=d;else{var l=new DOMParser;k=l.parseFromString(f,"text/xml")}var m=new XSLTProcessor;return m.importStylesheet(k),m.setParameter(null,"SerivceUri",e.SerivceUri),m.setParameter(null,"EntityBaseClass",e.EntityBaseClass),m.setParameter(null,"ContextBaseClass",e.ContextBaseClass),m.setParameter(null,"AutoCreateContext",e.AutoCreateContext),m.setParameter(null,"ContextInstanceName",e.ContextInstanceName),m.setParameter(null,"EntitySetBaseClass",e.EntitySetBaseClass),m.setParameter(null,"CollectionBaseClass",e.CollectionBaseClass),m.setParameter(null,"DefaultNamespace",e.DefaultNamespace),m.setParameter(null,"MaxDataserviceVersion",b.maxVersion||"3.0"),m.setParameter(null,"AllowedTypesList",e.typeFilter),m.setParameter(null,"GenerateNavigationProperties",e.navigation),resultDocument=m.transformToFragment(c,document),resultDocument.textContent}if("undefined"!=typeof module&&"undefined"!=typeof require){var h=require("node_xslt");return h.transform(h.readXsltString(f),h.readXmlString(c),["SerivceUri","'"+e.SerivceUri+"'","EntityBaseClass","'"+e.EntityBaseClass+"'","ContextBaseClass","'"+e.ContextBaseClass+"'","AutoCreateContext","'"+e.AutoCreateContext+"'","ContextInstanceName","'"+e.ContextInstanceName+"'","EntitySetBaseClass","'"+e.EntitySetBaseClass+"'","CollectionBaseClass","'"+e.CollectionBaseClass+"'","DefaultNamespace","'"+e.DefaultNamespace+"'","MaxDataserviceVersion","'"+(b.maxVersion||"3.0")+"'","AllowedTypesList","'"+e.typeFilter+"'","GenerateNavigationProperties","'"+e.navigation+"'"])}},_prepareTypeFilter:function(a,b,c){var d="";if(!("object"==typeof a&&"querySelector"in a&&"querySelectorAll"in a))return d;var e=[];if("object"==typeof c.typeFilter&&c.typeFilter){for(var f=Object.keys(c.typeFilter),g=0;g<f.length;g++){var h=c.typeFilter[f[g]],i={};if("object"==typeof h&&h)Array.isArray(h)?(i.Name=f[g],i.Fields=h):(i.Name=h.name||f[g],i.Fields=h.members||[]);else{if(!h)continue;i.Name=f[g],i.Fields=[]}var j=i.Name,k="";i.Name.lastIndexOf(".")>0&&(k=i.Name.substring(0,i.Name.lastIndexOf(".")),j=i.Name.substring(i.Name.lastIndexOf(".")+1));for(var l=a.querySelectorAll("EntityContainer[Name = '"+k+"']"),m=0;m<l.length;m++){var n=l[m].querySelector("EntitySet[Name = '"+j+"']");if(null!=n){i.Name=n.attributes.EntityType.value;break}}e.push(i)}var o;o=c.dependentRelationsOnly?this._discoverProperyDependencies(e,a,c.navigation,c.generateKeys):this._discoverTypeDependencies(e,a,c.navigation,c.generateKeys);for(var p=a.querySelectorAll("ComplexType"),g=0;g<p.length;g++){var q=p[g].parentNode.attributes.Namespace.value,r=q?q+"."+p[g].attributes.Name.value:p[g].attributes.Name.value;o.push({Name:r,Fields:[]})}for(var g=0;g<o.length;g++){var s=o[g];d+=s.Fields.length>0?s.Name+":"+s.Fields.join(",")+";":s.Name+";"}}return d},_discoverTypeDependencies:function(a,b,c,d){for(var e=[],f=[],g=[],h=0;h<a.length;h++){var i=g.indexOf(a[h].Name);i>=0&&g.splice(i,1),this._discoverType(a[h],b,e,f,c,d,!0,g)}for(var h=0;h<g.length;h++)this._discoverType({Name:g[h],Fields:[]},b,e,f,c,d,!1,[]);return e},_discoverType:function(a,b,c,d,e,f,g,h){var i=a.Name;if(!(d.indexOf(i)>=0)){console.log("Discover: "+i);var j=i,k="";i.lastIndexOf(".")>0&&(k=i.substring(0,i.lastIndexOf(".")),j=i.substring(i.lastIndexOf(".")+1));var l=b.querySelector("Schema[Namespace = '"+k+"']");if(null!=l){var m=l.querySelector("EntityType[Name = '"+j+"'], ComplexType[Name = '"+j+"']");if(null!=m){if(c.push(a),d.push(i),f&&a.Fields.length>0){var n=m.querySelectorAll("Key PropertyRef");if(null!=n)for(var o=0;o<n.length;o++){var p=n[o].attributes.Name.value;a.Fields.indexOf(p)<0&&a.Fields.splice(o,0,p)}}if(e)for(var q=m.querySelectorAll("NavigationProperty"),o=0;o<q.length;o++){var r=q[o];if(0==a.Fields.length||a.Fields.indexOf(r.attributes.Name.value)>=0){var s=r.attributes.FromRole.value,t=r.attributes.ToRole.value,u=l.querySelector("Association End[Role = '"+s+"']:not([Type = '"+i+"'])");if(null==u&&(u=l.querySelector("Association End[Role = '"+t+"']:not([Type = '"+i+"'])")),null!=u){var v=u.attributes.Type.value;g?h.indexOf(v)<0&&d.indexOf(v)<0&&h.push(v):this._discoverType({Name:v,Fields:[]},b,c,d,e,f,!1,h)}}}}}}},_discoverProperyDependencies:function(a,b,c,d){for(var e=[],f=a.map(function(a){return a.Name}),g=0;g<a.length;g++)this._discoverProperties(a[g],b,e,f,c,d);return e},_discoverProperties:function(a,b,c,d,e,f){var g=a.Name;console.log("Discover: "+g);var h=0!=a.Fields.length,i=g,j="";g.lastIndexOf(".")>0&&(j=g.substring(0,g.lastIndexOf(".")),i=g.substring(g.lastIndexOf(".")+1));var k=b.querySelector("Schema[Namespace = '"+j+"']");if(null!=k){var l=k.querySelector("EntityType[Name = '"+i+"'], ComplexType[Name = '"+i+"']");if(null!=l)if(c.push(a),h){if(f){var m=l.querySelectorAll("Key PropertyRef");if(null!=m)for(var n=0;n<m.length;n++){var o=m[n].attributes.Name.value;a.Fields.indexOf(o)<0&&a.Fields.splice(n,0,o)}}}else{var p=l.querySelectorAll("Property");if(null!=p)for(var n=0;n<p.length;n++){var q=p[n].attributes.Name.value;a.Fields.push(q)}if(e)for(var r=l.querySelectorAll("NavigationProperty"),n=0;n<r.length;n++){for(var s=r[n],t=s.attributes.Name.value,u=[s.attributes.FromRole.value,s.attributes.ToRole.value],v="",w=0;w<u.length;w++){var x=k.querySelector("Association End[Role = '"+u[w]+"']");if(null!=x&&(v=x.attributes.Type.value,v!=g||1==w))break}d.indexOf(v)>=0&&a.Fields.push(t)}}}},_findVersion:function(a){var b="";if("object"==typeof a&&"getElementsByTagName"in a){var c="http://schemas.microsoft.com/ado/2008/09/edm",d=a.getElementsByTagName("Schema");d&&(d=d[0]),d&&(d=d.attributes),d&&(d=d.getNamedItem("xmlns")),d&&(c=d.value);var b=a.getElementsByTagName("edmx:DataServices")[0]||a.getElementsByTagName("DataServices")[0];b&&(b=b.attributes.getNamedItem("m:MaxDataServiceVersion")),b&&c&&(b=b.value);var e=this._supportedODataVersions[c];return{ns:c,version:e||"unknown",maxVersion:b||this._maxDataServiceVersions[c||"unknown"]}}if("undefined"!=typeof module&&"undefined"!=typeof require){var f=a,g="http://schemas.microsoft.com/ado/2008/09/edm",c="nodejs";for(var h in this._supportedODataVersions)if(f.search(new RegExp('<Schema.+xmlns="'+h+'"',"gi"))>=0){g=h,c=this._supportedODataVersions[h];break}return{ns:g,version:c,maxVersion:this._maxDataServiceVersions[c||"unknown"]}}},_supportedODataVersions:{value:{"http://schemas.microsoft.com/ado/2006/04/edm":"V1","http://schemas.microsoft.com/ado/2008/09/edm":"V2","http://schemas.microsoft.com/ado/2009/11/edm":"V3","http://schemas.microsoft.com/ado/2007/05/edm":"V11","http://schemas.microsoft.com/ado/2009/08/edm":"V22"}},_maxDataServiceVersions:{value:{"http://schemas.microsoft.com/ado/2006/04/edm":"2.0","http://schemas.microsoft.com/ado/2008/09/edm":"2.0","http://schemas.microsoft.com/ado/2009/11/edm":"3.0","http://schemas.microsoft.com/ado/2007/05/edm":"2.0","http://schemas.microsoft.com/ado/2009/08/edm":"2.0"}},_supportedODataVersionXSLT:{value:"JayDataContextGenerator.xslt"},getCurrentXSLTVersion:function(a){return this._metadataConverterXSLT.replace("@@VERSIONNS@@",a.ns).replace("@@VERSION@@",a.version)},__encodeBase64:function(a){var b,c,d,e,f,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h=a,i="",j="",k="",l=0;do b=h.charCodeAt(l++),c=h.charCodeAt(l++),j=h.charCodeAt(l++),d=b>>2,e=(3&b)<<4|c>>4,f=(15&c)<<2|j>>6,k=63&j,isNaN(c)?f=k=64:isNaN(j)&&(k=64),i=i+g.charAt(d)+g.charAt(e)+g.charAt(f)+g.charAt(k),b=c=j="",d=e=f=k="";while(l<h.length);return i},_metadataConverterXSLT:{type:"string",value:'<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" \r\n                xmlns:edm="@@VERSIONNS@@" \r\n                xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata" \r\n                xmlns:metadata="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata" \r\n                xmlns:annot="http://schemas.microsoft.com/ado/2009/02/edm/annotation" \r\n                xmlns:exsl="http://exslt.org/common" \r\n                xmlns:msxsl="urn:schemas-microsoft-com:xslt" exclude-result-prefixes="msxsl">\r\n\r\n  <xsl:key name="entityType" match="edm:EntityType" use="concat(string(../@Namespace),\'.\', string(@Name))"/>\r\n  <xsl:key name="associations" match="edm:Association" use="concat(string(../@Namespace),\'.\', string(@Name))"/>\r\n\r\n  <xsl:strip-space elements="property item unprocessed"/>\r\n  <xsl:output method="text" indent="no"  />\r\n  <xsl:param name="contextNamespace" />\r\n\r\n  <xsl:param name="SerivceUri" />\r\n  <xsl:param name="EntityBaseClass"/>\r\n  <xsl:param name="ContextBaseClass"/>\r\n  <xsl:param name="AutoCreateContext"/>\r\n  <xsl:param name="ContextInstanceName"/>\r\n  <xsl:param name="EntitySetBaseClass"/>\r\n  <xsl:param name="CollectionBaseClass"/>\r\n  <xsl:param name="DefaultNamespace"/>\r\n  <xsl:param name="MaxDataserviceVersion"/>\r\n  <xsl:param name="AllowedTypesList" />\r\n  <xsl:param name="GenerateNavigationProperties" />\r\n\r\n  <xsl:param name="AllowedTypesListX">Microsoft.Crm.Sdk.Data.Services.Product;Microsoft.Crm.Sdk.Data.Services.LeadAddress:Telephone1,City,UTCOffset;</xsl:param>\r\n\r\n  <xsl:variable name="fullmetadata" select="/" />\r\n  \r\n  <xsl:template name="createFieldsList">\r\n    <xsl:param name="fields" />\r\n    <!--<xsl:message terminate="no">\r\n      create field: @<xsl:value-of select="$fields"/>@\r\n    </xsl:message>-->\r\n      <xsl:variable name="thisField">\r\n        <xsl:choose>\r\n          <xsl:when test="contains($fields,\',\')">\r\n            <xsl:value-of select="substring-before($fields, \',\')"/>\r\n          </xsl:when>\r\n          <xsl:otherwise>\r\n            <xsl:value-of select="$fields"/>\r\n          </xsl:otherwise>\r\n        </xsl:choose>\r\n      </xsl:variable>\r\n      <xsl:element name="field">\r\n        <xsl:attribute name="name">\r\n          <xsl:value-of select="$thisField"/>\r\n        </xsl:attribute> \r\n      </xsl:element>\r\n      <xsl:variable name="remaining" select="substring($fields, string-length($thisField) + 2)" />\r\n      <xsl:if test="string-length($remaining) > 0">\r\n        <xsl:call-template name="createFieldsList">\r\n          <xsl:with-param name="fields" select="$remaining" />\r\n        </xsl:call-template>\r\n      </xsl:if>\r\n  </xsl:template>\r\n\r\n  <xsl:template name="createType">\r\n    <xsl:param name="typeFull" />\r\n    <!--<xsl:message terminate="no">\r\n      create type: <xsl:value-of select="$typeFull"/>\r\n    </xsl:message>-->\r\n    <xsl:variable name="typeName">\r\n      <xsl:choose>\r\n        <xsl:when test="contains($typeFull,\':\')">\r\n          <xsl:value-of select="substring-before($typeFull, \':\') "/>\r\n        </xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:value-of select="$typeFull"/>\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n    <xsl:variable name="fields" select="substring($typeFull, string-length($typeName) + 2)" />\r\n    <xsl:element name="type">\r\n      <xsl:attribute name="name">\r\n        <xsl:value-of select="$typeName"/>\r\n      </xsl:attribute>\r\n      <xsl:if test="string-length($fields) > 0">\r\n        <xsl:call-template name="createFieldsList">\r\n          <xsl:with-param name="fields" select="$fields" />\r\n        </xsl:call-template>\r\n      </xsl:if>\r\n    </xsl:element>\r\n  </xsl:template>\r\n  \r\n  <xsl:template name="createTypeList">\r\n    <xsl:param name="types" />\r\n    <!--<xsl:message terminate="no">\r\n      createTypeList: <xsl:value-of select="$types"/>\r\n    </xsl:message>-->\r\n        \r\n    <xsl:variable name="thisTypeFull">\r\n      <xsl:choose>\r\n        <xsl:when test="contains($types, \';\')">\r\n          <xsl:value-of select="substring-before($types, \';\')"/>\r\n        </xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:value-of select="$types"/>\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <xsl:if test="string-length($thisTypeFull) > 0">\r\n      <xsl:call-template name="createType">\r\n        <xsl:with-param name="typeFull" select="$thisTypeFull" />\r\n      </xsl:call-template>\r\n    </xsl:if>\r\n    \r\n    <xsl:variable name="remaining" select="substring($types, string-length($thisTypeFull) + 2)" />\r\n    <!--<xsl:message terminate="no">\r\n      rem: @<xsl:value-of select="$remaining"/>@  \r\n    </xsl:message>-->\r\n    \r\n    <xsl:if test="string-length($remaining) > 0">\r\n      <xsl:call-template name="createTypeList">\r\n        <xsl:with-param name="types" select="$remaining" />\r\n      </xsl:call-template>\r\n    </xsl:if>\r\n  </xsl:template>\r\n\r\n  <xsl:variable name="allowedTypes">\r\n    <xsl:call-template name="createTypeList">\r\n      <xsl:with-param name="types" select="$AllowedTypesList" />\r\n    </xsl:call-template>\r\n  </xsl:variable>\r\n  \r\n\r\n<!-- TODO EXSLT node-set -->\r\n  <!--<xsl:variable name="hasTypeFilter" select="boolean(count(msxsl:node-set($allowedTypes)/type) > 0)"/>-->\r\n  <xsl:variable name="hasTypeFilter">\r\n    <xsl:choose>\r\n      <xsl:when test="function-available(\'msxsl:node-set\')"><xsl:value-of select="boolean(count(msxsl:node-set($allowedTypes)/type) > 0)"/></xsl:when>\r\n      <xsl:otherwise><xsl:value-of select="boolean(count(exsl:node-set($allowedTypes)/type) > 0)"/></xsl:otherwise>\r\n    </xsl:choose>\r\n  </xsl:variable>\r\n  <xsl:template match="/">\r\n\r\n/*//////////////////////////////////////////////////////////////////////////////////////\r\n////// Autogenerated by JaySvcUtil.exe http://JayData.org for more info        /////////\r\n//////                             oData @@VERSION@@                                    /////////\r\n//////////////////////////////////////////////////////////////////////////////////////*/\r\n(function(global, $data, undefined) {\r\n\r\n    \r\n<xsl:for-each select="//edm:EntityType | //edm:ComplexType" xml:space="default">\r\n  <xsl:variable name="thisName" select="concat(../@Namespace, \'.\', @Name)" />\r\n  <!-- TODO EXSLT node-set-->\r\n  <!--<xsl:variable name="thisTypeNode" select="msxsl:node-set($allowedTypes)/type[@name = $thisName]" />-->\r\n  <xsl:variable name="thisTypeNode">\r\n    <xsl:choose>\r\n      <xsl:when test="function-available(\'msxsl:node-set\')">\r\n        <xsl:copy-of select="msxsl:node-set($allowedTypes)/type[@name = $thisName]"/>\r\n      </xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:copy-of select="exsl:node-set($allowedTypes)/type[@name = $thisName]"/>\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n  </xsl:variable>\r\n  <xsl:variable name="thisTypeNodeExists">\r\n    <xsl:choose>\r\n      <xsl:when test="function-available(\'msxsl:node-set\')">\r\n        <xsl:copy-of select="(count(msxsl:node-set($allowedTypes)/type[@name = $thisName]) > 0)"/>\r\n      </xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:copy-of select="(count(exsl:node-set($allowedTypes)/type[@name = $thisName]) > 0)"/>\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n  </xsl:variable>\r\n  <!--<xsl:variable name="filterFields" select="(count($thisTypeNode/field) > 0)" />-->\r\n  <xsl:variable name="filterFields">\r\n    <xsl:choose>\r\n      <xsl:when test="function-available(\'msxsl:node-set\')">\r\n        <xsl:copy-of select="(count(msxsl:node-set($thisTypeNode)/type/field) > 0)"/>\r\n      </xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:copy-of select="(count(exsl:node-set($thisTypeNode)/type/field) > 0)"/>\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n  </xsl:variable>\r\n  <xsl:if test="($hasTypeFilter = \'false\') or ($thisTypeNodeExists = \'true\')">\r\n\r\n      <xsl:message terminate="no">Info: generating type <xsl:value-of select="concat(../@Namespace, \'.\', @Name)"/></xsl:message>\r\n    \r\n      <xsl:variable name="BaseType">\r\n        <xsl:choose>\r\n          <xsl:when test="@BaseType">\r\n            <xsl:value-of select="concat($DefaultNamespace,@BaseType)"/>\r\n          </xsl:when>\r\n          <xsl:otherwise>\r\n            <xsl:value-of select="$EntityBaseClass"  />\r\n          </xsl:otherwise>\r\n        </xsl:choose>\r\n      </xsl:variable>\r\n\r\n\r\n     <xsl:variable name="props">\r\n       <xsl:for-each select="*[local-name() != \'NavigationProperty\' or ($GenerateNavigationProperties = \'true\' and local-name() = \'NavigationProperty\')]">\r\n         <xsl:variable name="fname" select="@Name" />\r\n         <xsl:variable name="isAllowedField">\r\n           <xsl:choose>\r\n             <xsl:when test="function-available(\'msxsl:node-set\')">\r\n               <xsl:copy-of select="(count(msxsl:node-set($thisTypeNode)/type/field[@name = $fname]) > 0)"/>\r\n             </xsl:when>\r\n             <xsl:otherwise>\r\n               <xsl:copy-of select="(count(exsl:node-set($thisTypeNode)/type/field[@name = $fname]) > 0)"/>\r\n             </xsl:otherwise>\r\n           </xsl:choose>\r\n         </xsl:variable>\r\n         <xsl:if test="($filterFields = \'false\') or ($isAllowedField = \'true\')">\r\n           <xsl:apply-templates select="." />\r\n         </xsl:if> \r\n       </xsl:for-each>\r\n      </xsl:variable>\r\n    \r\n      <xsl:text xml:space="preserve">  </xsl:text><xsl:value-of select="$BaseType"  />.extend(\'<xsl:value-of select="concat($DefaultNamespace,../@Namespace)"/>.<xsl:value-of select="@Name"/>\', {\r\n     <xsl:choose>\r\n        <xsl:when test="function-available(\'msxsl:node-set\')">\r\n          <xsl:for-each select="msxsl:node-set($props)/*">\r\n            <xsl:value-of select="."/>\r\n            <xsl:if test="position() != last()">\r\n            <xsl:text>,&#10;     </xsl:text>  \r\n            </xsl:if>\r\n          </xsl:for-each>\r\n        </xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:for-each select="exsl:node-set($props)/*">\r\n            <xsl:value-of select="."/>\r\n            <xsl:if test="position() != last()">,&#10;     </xsl:if>\r\n          </xsl:for-each>\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n      <xsl:variable name="currentName"><xsl:value-of select="concat(../@Namespace,\'.\',@Name)"/></xsl:variable>\r\n      <xsl:for-each select="//edm:FunctionImport[@IsBindable and edm:Parameter[1]/@Type = $currentName]"><xsl:if test="position() = 1">,\r\n      </xsl:if>\r\n        <xsl:apply-templates select="."></xsl:apply-templates><xsl:if test="position() != last()">,\r\n      </xsl:if>\r\n      </xsl:for-each>\r\n  });\r\n\r\n</xsl:if>\r\n</xsl:for-each>\r\n\r\n<xsl:for-each select="//edm:EntityContainer">\r\n  <xsl:text xml:space="preserve">  </xsl:text><xsl:value-of select="$ContextBaseClass"  />.extend(\'<xsl:value-of select="concat(concat($DefaultNamespace,../@Namespace), \'.\', @Name)"/>\', {\r\n     <!--or (@IsBindable = \'true\' and (@IsAlwaysBindable = \'false\' or @m:IsAlwaysBindable = \'false\' or @metadata:IsAlwaysBindable = \'false\'))-->\r\n\r\n   <xsl:variable name="subset">\r\n    <xsl:for-each select="edm:EntitySet | edm:FunctionImport">\r\n      <xsl:choose>\r\n        <xsl:when test="function-available(\'msxsl:node-set\')">\r\n          <xsl:if test="($hasTypeFilter = \'false\') or msxsl:node-set($allowedTypes)/type[@name = current()/@EntityType]">\r\n            <xsl:copy-of select="."/>\r\n          </xsl:if>\r\n        </xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:if test="($hasTypeFilter = \'false\') or exsl:node-set($allowedTypes)/type[@name = current()/@EntityType]">\r\n            <xsl:copy-of select="."/>\r\n          </xsl:if>\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:for-each>\r\n  </xsl:variable>\r\n\r\n  \r\n  <xsl:choose>\r\n    <xsl:when test="function-available(\'msxsl:node-set\')">\r\n      <xsl:for-each select="msxsl:node-set($subset)/*[local-name() != \'FunctionImport\' or not(@IsBindable) or @IsBindable = \'false\']">\r\n        <xsl:apply-templates select="."></xsl:apply-templates>\r\n        <xsl:if test="position() != last()">,\r\n     </xsl:if>\r\n      </xsl:for-each>\r\n    </xsl:when>\r\n    <xsl:otherwise>\r\n      <xsl:for-each select="exsl:node-set($subset)/*[local-name() != \'FunctionImport\' or not(@IsBindable) or @IsBindable = \'false\']">\r\n        <xsl:apply-templates select="."></xsl:apply-templates>\r\n        <xsl:if test="position() != last()">,\r\n     </xsl:if>\r\n      </xsl:for-each>\r\n    </xsl:otherwise>\r\n  </xsl:choose>\r\n  });\r\n\r\n  $data.generatedContexts = $data.generatedContexts || [];\r\n  $data.generatedContexts.push(<xsl:value-of select="concat(concat($DefaultNamespace,../@Namespace), \'.\', @Name)" />);\r\n  <xsl:if test="$AutoCreateContext = \'true\'">\r\n  /*Context Instance*/\r\n  <xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$ContextInstanceName" /> = new <xsl:value-of select="concat(concat($DefaultNamespace,../@Namespace), \'.\', @Name)" />({ name:\'oData\', oDataServiceHost: \'<xsl:value-of select="$SerivceUri" />\', maxDataServiceVersion: \'<xsl:value-of select="$MaxDataserviceVersion" />\' });\r\n</xsl:if>\r\n\r\n</xsl:for-each>\r\n      \r\n})(window, $data);\r\n      \r\n    </xsl:template>\r\n\r\n  <xsl:template match="edm:Key"></xsl:template>\r\n\r\n  <xsl:template match="edm:FunctionImport">\r\n    <xsl:text>\'</xsl:text>\r\n    <xsl:value-of select="@Name"/>\r\n    <xsl:text>\': { type: </xsl:text>\r\n    <xsl:choose>\r\n      <xsl:when test="@IsBindable = \'true\'">\r\n        <xsl:text>$data.ServiceAction</xsl:text>\r\n      </xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:text>$data.ServiceOperation</xsl:text>\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n\r\n    <xsl:apply-templates select="@*" mode="FunctionImport-mode"/>\r\n\r\n    <xsl:variable name="IsBindable">\r\n      <xsl:value-of select="@IsBindable"/>\r\n    </xsl:variable>\r\n    <xsl:text>, params: [</xsl:text>\r\n    <xsl:for-each select="edm:Parameter[($IsBindable = \'true\' and position() > 1) or (($IsBindable = \'false\' or $IsBindable = \'\') and position() > 0)]">\r\n      <xsl:text>{ name: \'</xsl:text>\r\n      <xsl:value-of select="@Name"/>\r\n      <xsl:text>\', type: \'</xsl:text>\r\n      <xsl:variable name="curr" select="@Type"/>\r\n      <xsl:choose>\r\n        <xsl:when test="$fullmetadata//edm:Schema[starts-with($curr, @Namespace)]">\r\n          <xsl:value-of select="concat($DefaultNamespace,$curr)" />\r\n        </xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:value-of select="$curr" />\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n      <xsl:text>\' }</xsl:text>\r\n      <xsl:if test="position() != last()">, </xsl:if>\r\n    </xsl:for-each>    \r\n    <xsl:text>]</xsl:text>\r\n\r\n    <xsl:text> }</xsl:text>\r\n  </xsl:template>\r\n  \r\n  <xsl:template match="@ReturnType" mode="FunctionImport-mode">\r\n    <xsl:text>, returnType: </xsl:text>\r\n    <xsl:choose>\r\n      <xsl:when test="not(.)">null</xsl:when>\r\n      <xsl:when test="starts-with(., \'Collection\')">$data.Queryable</xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:text>\'</xsl:text>\r\n        <xsl:variable name="curr" select="."/>\r\n        <xsl:choose>\r\n          <xsl:when test="$fullmetadata//edm:Schema[starts-with($curr, @Namespace)]">\r\n            <xsl:value-of select="concat($DefaultNamespace,$curr)" />\r\n          </xsl:when>\r\n          <xsl:otherwise>\r\n            <xsl:value-of select="$curr" />\r\n          </xsl:otherwise>\r\n        </xsl:choose>\r\n        <xsl:text>\'</xsl:text>\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n\r\n    <xsl:if test="starts-with(., \'Collection\')">\r\n      <xsl:variable name="len" select="string-length(.)-12"/>\r\n      <xsl:variable name="curr" select="substring(.,12,$len)"/>\r\n      <xsl:variable name="ElementType" >\r\n        <xsl:choose>\r\n          <xsl:when test="$fullmetadata//edm:Schema[starts-with($curr, @Namespace)]">\r\n            <xsl:value-of select="concat($DefaultNamespace,$curr)" />\r\n          </xsl:when>\r\n          <xsl:otherwise>\r\n            <xsl:value-of select="$curr" />\r\n          </xsl:otherwise>\r\n        </xsl:choose>\r\n      </xsl:variable>\r\n      <xsl:text>, elementType: \'</xsl:text>\r\n      <xsl:value-of select="$ElementType"/>\r\n      <xsl:text>\'</xsl:text>\r\n    </xsl:if>\r\n  </xsl:template>\r\n  <xsl:template match="@Name" mode="FunctionImport-mode"></xsl:template>\r\n  <xsl:template match="@m:HttpMethod" mode="FunctionImport-mode">\r\n    <xsl:text>, method: \'</xsl:text>\r\n    <xsl:value-of select="."/>\r\n    <xsl:text>\'</xsl:text>\r\n  </xsl:template>\r\n  <xsl:template match="@IsBindable | @IsSideEffecting | @IsAlwaysBindable | @m:IsAlwaysBindable | @metadata:IsAlwaysBindable | @IsComposable" mode="FunctionImport-mode">\r\n    <xsl:text>, </xsl:text>\r\n    <xsl:call-template name="GetAttributeName">\r\n      <xsl:with-param name="Name" select="name()" />\r\n    </xsl:call-template>\r\n    <xsl:text>: </xsl:text>\r\n    <xsl:value-of select="."/>\r\n  </xsl:template>\r\n  <xsl:template match="@*" mode="FunctionImport-mode">\r\n    <xsl:text>, \'</xsl:text>\r\n    <xsl:call-template name="GetAttributeName">\r\n      <xsl:with-param name="Name" select="name()" />\r\n    </xsl:call-template>\r\n    <xsl:text>\': \'</xsl:text>\r\n    <xsl:value-of select="."/>        \r\n    <xsl:text>\'</xsl:text>\r\n  </xsl:template>\r\n  <xsl:template name="GetAttributeName">\r\n    <xsl:param name="Name" />\r\n    <xsl:choose>\r\n      <xsl:when test="contains($Name, \':\')">\r\n        <xsl:value-of select="substring-after($Name, \':\')"/>\r\n      </xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:value-of select="$Name"/>\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n  </xsl:template>\r\n\r\n  <xsl:template match="edm:EntitySet">\'<xsl:value-of select="@Name"/>\': { type: <xsl:value-of select="$EntitySetBaseClass"  />, elementType: <xsl:value-of select="concat($DefaultNamespace,@EntityType)"/><xsl:text> </xsl:text><xsl:apply-templates select="." mode="Collection-Actions" />}</xsl:template>\r\n\r\n  <xsl:template match="edm:EntitySet" mode="Collection-Actions">\r\n    <xsl:variable name="CollectionType" select="concat(\'Collection(\', @EntityType, \')\')" />\r\n    <xsl:for-each select="//edm:FunctionImport[edm:Parameter[1]/@Type = $CollectionType]">\r\n      <xsl:if test="position() = 1">\r\n        <xsl:text>, actions: { \r\n        </xsl:text>\r\n      </xsl:if>\r\n        <xsl:apply-templates select="."></xsl:apply-templates><xsl:if test="position() != last()">,\r\n        </xsl:if>\r\n      <xsl:if test="position() = last()">\r\n        <xsl:text>\r\n      }</xsl:text>\r\n      </xsl:if>\r\n    </xsl:for-each>\r\n  </xsl:template>\r\n  \r\n  <xsl:template match="edm:Property | edm:NavigationProperty">\r\n    <property>\r\n    <xsl:variable name="memberDefinition">\r\n      <xsl:if test="parent::edm:EntityType/edm:Key/edm:PropertyRef[@Name = current()/@Name]"><attribute name="key">true</attribute></xsl:if>\r\n      <xsl:apply-templates select="@*[local-name() != \'Name\']" mode="render-field" />\r\n    </xsl:variable>\'<xsl:value-of select="@Name"/>\': { <xsl:choose><xsl:when test="function-available(\'msxsl:node-set\')"><xsl:for-each select="msxsl:node-set($memberDefinition)/*">\'<xsl:if test="@extended = \'true\'">$</xsl:if><xsl:value-of select="@name"/>\':<xsl:value-of select="."/>\r\n      <xsl:if test="position() != last()">,<xsl:text> </xsl:text>\r\n    </xsl:if> </xsl:for-each></xsl:when>\r\n  <xsl:otherwise><xsl:for-each select="exsl:node-set($memberDefinition)/*">\'<xsl:if test="@extended = \'true\'">$</xsl:if><xsl:value-of select="@name"/>\':<xsl:value-of select="."/>\r\n      <xsl:if test="position() != last()">,<xsl:text> </xsl:text>\r\n    </xsl:if> </xsl:for-each></xsl:otherwise>\r\n    </xsl:choose> }</property>\r\n</xsl:template>\r\n  \r\n  <xsl:template match="@Name" mode="render-field">\r\n  </xsl:template>\r\n\r\n  <xsl:template match="@Type" mode="render-field">\r\n    <xsl:choose>\r\n      <xsl:when test="starts-with(., \'Collection\')">\r\n        <attribute name="type">\'Array\'</attribute>\r\n        <xsl:variable name="len" select="string-length(.)-12"/>\r\n        <xsl:variable name="currType" select="substring(.,12,$len)"/>\r\n        <xsl:choose>\r\n          <xsl:when test="starts-with($currType, ../../../@Namespace)">\r\n            <attribute name="elementType">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$currType" />\'</attribute>\r\n          </xsl:when>\r\n          <xsl:otherwise>\r\n            <attribute name="elementType">\'<xsl:value-of select="$currType" />\'</attribute>\r\n          </xsl:otherwise>\r\n        </xsl:choose>\r\n      </xsl:when>\r\n      <xsl:when test="starts-with(., ../../../@Namespace)">\r\n        <attribute name="type">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="."/>\'</attribute>\r\n      </xsl:when>\r\n      <xsl:otherwise>\r\n        <attribute name="type">\'<xsl:value-of select="."/>\'</attribute>\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n  </xsl:template>\r\n\r\n  <xsl:template match="@ConcurrencyMode" mode="render-field">\r\n    <attribute name="concurrencyMode">$data.ConcurrencyMode.<xsl:value-of select="."/></attribute>\r\n  </xsl:template>\r\n\r\n  <xsl:template match="@Nullable" mode="render-field">\r\n    <attribute name="nullable"><xsl:value-of select="."/></attribute>\r\n    \r\n    <xsl:if test=". = \'false\'">\r\n      <xsl:choose>\r\n        <xsl:when test="parent::edm:Property/@annot:StoreGeneratedPattern = \'Identity\' or parent::edm:Property/@annot:StoreGeneratedPattern = \'Computed\'"></xsl:when>\r\n        <xsl:otherwise><attribute name="required">true</attribute></xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:if>\r\n  </xsl:template>\r\n\r\n  <xsl:template match="@annot:StoreGeneratedPattern" mode="render-field">\r\n    <xsl:if test=". != \'None\'"><attribute name="computed">true</attribute></xsl:if>    \r\n  </xsl:template>\r\n\r\n  <xsl:template match="@MaxLength" mode="render-field">\r\n    <attribute name="maxLength">\r\n      <xsl:choose>\r\n        <xsl:when test="string(.) = \'Max\'">Number.POSITIVE_INFINITY</xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:value-of select="."/>\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n    </attribute>\r\n  </xsl:template>\r\n\r\n  <xsl:template match="@FixedLength | @Unicode | @Precision | @Scale" mode="render-field">\r\n  </xsl:template>\r\n  <xsl:template match="@*" mode="render-field">\r\n    <xsl:variable name="nameProp">\r\n      <xsl:choose>\r\n        <xsl:when test="substring-after(name(), \':\') != \'\'">\r\n          <xsl:value-of select="substring-after(name(), \':\')"/>\r\n        </xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:value-of select="name()"/>\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n    <xsl:element name="attribute"><xsl:attribute name="extended">true</xsl:attribute><xsl:attribute name="name"><xsl:value-of select="$nameProp"/></xsl:attribute>\'<xsl:value-of select="."/>\'</xsl:element>\r\n  </xsl:template>\r\n\r\n  <xsl:template match="@Relationship" mode="render-field">\r\n    <xsl:variable name="relationName" select="string(../@ToRole)"/>\r\n    <xsl:variable name="relationshipName" select="string(.)" />\r\n    <xsl:variable name="relation" select="key(\'associations\',string(.))/edm:End[@Role = $relationName]" />\r\n    <xsl:variable name="otherName" select="../@FromRole" />\r\n    <xsl:variable name="otherProp" select="//edm:NavigationProperty[@ToRole = $otherName and @Relationship = $relationshipName]" />\r\n    <xsl:variable name="m" select="$relation/@Multiplicity" />\r\n    <xsl:choose>\r\n      <xsl:when test="$m = \'*\'">\r\n        <attribute name="type">\'<xsl:value-of select="$CollectionBaseClass"/>\'</attribute>\r\n        <attribute name="elementType">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$relation/@Type"/>\'</attribute>\r\n        <xsl:if test="not($otherProp/@Name)">\r\n          <attribute name="inverseProperty">\'$$unbound\'</attribute></xsl:if>\r\n        <xsl:if test="$otherProp/@Name">\r\n          <attribute name="inverseProperty">\'<xsl:value-of select="$otherProp/@Name"/>\'</attribute></xsl:if>\r\n      </xsl:when>\r\n      <xsl:when test="$m = \'0..1\'">\r\n        <attribute name="type">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$relation/@Type"/>\'</attribute>\r\n        <xsl:choose>\r\n          <xsl:when test="$otherProp">\r\n            <attribute name="inverseProperty">\'<xsl:value-of select="$otherProp/@Name"/>\'</attribute>\r\n          </xsl:when >\r\n          <xsl:otherwise>\r\n            <attribute name="inverseProperty">\'$$unbound\'</attribute>\r\n            <xsl:message terminate="no">  Warning: inverseProperty other side missing: <xsl:value-of select="."/>\r\n          </xsl:message>\r\n          </xsl:otherwise>\r\n        </xsl:choose>\r\n      </xsl:when>\r\n      <xsl:when test="$m = \'1\'">\r\n        <attribute name="type">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$relation/@Type"/>\'</attribute>\r\n        <attribute name="required">true</attribute>\r\n        <xsl:choose>\r\n          <xsl:when test="$otherProp">\r\n            <attribute name="inverseProperty">\'<xsl:value-of select="$otherProp/@Name"/>\'</attribute>\r\n          </xsl:when >\r\n          <xsl:otherwise>\r\n            <attribute name="inverseProperty">\'$$unbound\'</attribute>\r\n            <xsl:message terminate="no">\r\n              Warning: inverseProperty other side missing: <xsl:value-of select="."/>\r\n            </xsl:message>\r\n          </xsl:otherwise>\r\n        </xsl:choose>\r\n      </xsl:when>\r\n    </xsl:choose>\r\n  </xsl:template>\r\n\r\n\r\n  <xsl:template match="@FromRole | @ToRole" mode="render-field"></xsl:template>\r\n\r\n  <xsl:template match="*" mode="render-field">\r\n    <!--<unprocessed>!!<xsl:value-of select="name()"/>!!</unprocessed>-->\r\n    <xsl:message terminate="no">  Warning: <xsl:value-of select="../../@Name"/>.<xsl:value-of select="../@Name"/>:<xsl:value-of select="name()"/> is an unknown/unprocessed attribued</xsl:message>\r\n  </xsl:template>\r\n  <!--<xsl:template match="*">\r\n    !<xsl:value-of select="name()"/>!\r\n  </xsl:template>-->\r\n</xsl:stylesheet>\r\n'}}),$data.MetadataLoader=new $data.MetadataLoaderClass,$data.service=function(a,b,c){function d(a){switch(typeof a){case"object":"function"==typeof a.success||"function"==typeof a.error?f=a:e=a;
break;case"function":f=a}}var e,f;d(b),d(c),"object"==typeof a&&(e=$data.typeSystem.extend(a,e),a=a.url,delete e.url);var g=new $data.PromiseHandler;return f=g.createCallback(f),$data.MetadataLoader.load(a,{success:function(a){var b=a.type;if(e){var c=e.serviceName||e.storeAlias;c&&"addStore"in $data&&$data.addStore(c,a,void 0===e.isDefault||e.isDefault)}f.success(a,b)},error:f.error},e),g.getPromise()},function(a){"undefined"!=typeof jQuery&&(a.Class.define("$data.Deferred",a.PromiseHandlerBase,null,{constructor:function(){this.deferred=new $.Deferred},deferred:{},createCallback:function(b){b=a.typeSystem.createCallbackSetting(b);var c=this;return cbWrapper={success:function(){b.success.apply(c.deferred,arguments),c.deferred.resolve.apply(c.deferred,arguments)},error:function(){Array.prototype.push.call(arguments,c.deferred),b.error.apply(c.deferred,arguments)},notify:function(){b.notify.apply(c.deferred,arguments),c.deferred.notify.apply(c.deferred,arguments)}}},getPromise:function(){return this.deferred.promise()}},null),a.PromiseHandler=a.Deferred)}($data),function(a){a.initService=function(b,c){var d,e=new a.PromiseHandler;if("object"==typeof b){d=b;var f=d.isSSL||void 0===d.isSSL?"https":"http",g=d.port?":"+d.port:"";b="string"==typeof d.license&&"business"===d.license.toLowerCase()?d.appId&&d.serviceName?f+"://"+d.appId+".jaystack.net"+g+"/"+d.serviceName:d.url:d.ownerId&&d.appId&&d.serviceName?f+"://open.jaystack.net/"+d.ownerId+"/"+d.appId+"/api/"+d.serviceName:d.url,delete d.url,d=a.typeSystem.extend(d,c)}else d=c;return a.service(b,d).then(function(a){var b=a();return b.onReady().then(function(b){b.serviceFactory=a,e.deferred.resolve(b,a,a.type)}).fail(function(){e.deferred.reject.apply(e.deferred,arguments)})}).fail(function(){e.deferred.reject.apply(e.deferred,arguments)}),e.getPromise()}}($data),$data.IndexedDBConverter={fromDb:{"$data.Byte":$data.Container.proxyConverter,"$data.SByte":$data.Container.proxyConverter,"$data.Decimal":$data.Container.proxyConverter,"$data.Float":$data.Container.proxyConverter,"$data.Int16":$data.Container.proxyConverter,"$data.Int64":$data.Container.proxyConverter,"$data.Integer":$data.Container.proxyConverter,"$data.Int32":$data.Container.proxyConverter,"$data.Number":$data.Container.proxyConverter,"$data.Date":$data.Container.proxyConverter,"$data.DateTimeOffset":$data.Container.proxyConverter,"$data.Time":$data.Container.proxyConverter,"$data.String":$data.Container.proxyConverter,"$data.Boolean":$data.Container.proxyConverter,"$data.Blob":function(a){return a?$data.Container.convertTo(a,$data.Blob):a},"$data.Array":function(a){return void 0===a?new $data.Array:a},"$data.Object":$data.Container.proxyConverter,"$data.Guid":function(a){return a?$data.parseGuid(a).toString():a},"$data.GeographyPoint":function(a){return a?new $data.GeographyPoint(a):a},"$data.GeographyLineString":function(a){return a?new $data.GeographyLineString(a):a},"$data.GeographyPolygon":function(a){return a?new $data.GeographyPolygon(a):a},"$data.GeographyMultiPoint":function(a){return a?new $data.GeographyMultiPoint(a):a},"$data.GeographyMultiLineString":function(a){return a?new $data.GeographyMultiLineString(a):a},"$data.GeographyMultiPolygon":function(a){return a?new $data.GeographyMultiPolygon(a):a},"$data.GeographyCollection":function(a){return a?new $data.GeographyCollection(a):a},"$data.GeometryPoint":function(a){return a?new $data.GeometryPoint(a):a},"$data.GeometryLineString":function(a){return a?new $data.GeometryLineString(a):a},"$data.GeometryPolygon":function(a){return a?new $data.GeometryPolygon(a):a},"$data.GeometryMultiPoint":function(a){return a?new $data.GeometryMultiPoint(a):a},"$data.GeometryMultiLineString":function(a){return a?new $data.GeometryMultiLineString(a):a},"$data.GeometryMultiPolygon":function(a){return a?new $data.GeometryMultiPolygon(a):a},"$data.GeometryCollection":function(a){return a?new $data.GeometryCollection(a):a}},toDb:{"$data.Byte":$data.Container.proxyConverter,"$data.SByte":$data.Container.proxyConverter,"$data.Decimal":$data.Container.proxyConverter,"$data.Float":$data.Container.proxyConverter,"$data.Int16":$data.Container.proxyConverter,"$data.Int64":$data.Container.proxyConverter,"$data.Integer":$data.Container.proxyConverter,"$data.Int32":$data.Container.proxyConverter,"$data.Number":$data.Container.proxyConverter,"$data.Date":$data.Container.proxyConverter,"$data.DateTimeOffset":$data.Container.proxyConverter,"$data.Time":$data.Container.proxyConverter,"$data.String":$data.Container.proxyConverter,"$data.Boolean":$data.Container.proxyConverter,"$data.Blob":function(a){return a?$data.Blob.toString(a):a},"$data.Array":function(a){return a?JSON.parse(JSON.stringify(a)):a},"$data.Object":$data.Container.proxyConverter,"$data.Guid":function(a){return a?a.toString():a},"$data.GeographyPoint":function(a){return a?a:a},"$data.GeographyLineString":function(a){return a?a:a},"$data.GeographyPolygon":function(a){return a?a:a},"$data.GeographyMultiPoint":function(a){return a?a:a},"$data.GeographyMultiLineString":function(a){return a?a:a},"$data.GeographyMultiPolygon":function(a){return a?a:a},"$data.GeographyCollection":function(a){return a?a:a},"$data.GeometryPoint":function(a){return a?a:a},"$data.GeometryLineString":function(a){return a?a:a},"$data.GeometryPolygon":function(a){return a?a:a},"$data.GeometryMultiPoint":function(a){return a?a:a},"$data.GeometryMultiLineString":function(a){return a?a:a},"$data.GeometryMultiPolygon":function(a){return a?a:a},"$data.GeometryCollection":function(a){return a?a:a}}},$data.Class.define("$data.storageProviders.indexedDb.IndexedDBStorageProvider",$data.StorageProviderBase,null,{constructor:function(a,b){this.indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB,this.IDBRequest=window.IDBRequest||window.webkitIDBRequest||window.mozIDBRequest||window.msIDBRequest,this.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.mozIDBTransaction||window.msIDBTransaction,this.IDBTransactionType={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSIONCHANGE:"versionchange"},"undefined"!=typeof this.IDBTransaction.READ_ONLY&&"undefined"!=typeof this.IDBTransaction.READ_WRITE&&(this.IDBTransactionType.READ_ONLY=this.IDBTransaction.READ_ONLY,this.IDBTransactionType.READ_WRITE=this.IDBTransaction.READ_WRITE),this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.mozIDBKeyRange||window.msIDBKeyRange,this.IDBDatabaseException=window.IDBDatabaseException||window.webkitIDBDatabaseException||window.mozIDBDatabaseException||window.msIDBDatabaseException,this.IDBOpenDBRequest=window.IDBOpenDBRequest||window.webkitIDBOpenDBRequest||window.mozIDBOpenDBRequest||window.msIDBOpenDBRequest,this.newVersionAPI=!(!window.IDBFactory||!IDBFactory.prototype.deleteDatabase),this.sequenceStore="__jayData_sequence",this.SqlCommands=[],this.context={},this.providerConfiguration=$data.typeSystem.extend({databaseName:$data.defaults.defaultDatabaseName,version:1,dbCreation:$data.storageProviders.DbCreationType.DropTableIfChanged,memoryOperations:!0},a),this._setupExtensionMethods(),b&&(this.originalContext=b.getType())},supportedBinaryOperators:{value:{equal:{mapTo:" == ",dataType:$data.Boolean},notEqual:{mapTo:" != ",dataType:$data.Boolean},equalTyped:{mapTo:" == ",dataType:$data.Boolean},notEqualTyped:{mapTo:" != ",dataType:$data.Boolean},greaterThan:{mapTo:" > ",dataType:$data.Boolean},greaterThanOrEqual:{mapTo:" >= ",dataType:$data.Boolean},lessThan:{mapTo:" < ",dataType:$data.Boolean},lessThenOrEqual:{mapTo:" <= ",dataType:$data.Boolean},or:{mapTo:" || ",dataType:$data.Boolean},and:{mapTo:" && ",dataType:$data.Boolean}}},supportedSetOperations:{value:{length:{},toArray:{},forEach:{}},enumerable:!0,writable:!0},supportedFieldOperations:{value:{},enumerable:!0,writable:!0},supportedUnaryOperators:{value:{},enumerable:!0,writable:!0},_setupExtensionMethods:function(){var a=this.IDBRequest,b=this.IDBTransaction,c=this.IDBOpenDBRequest,d=function(a){"object"!=typeof a&&Guard.raise(new Exception("Invalid callbackSettings",null,a));for(var b in a)"undefined"!=typeof this[b]&&"function"==typeof a[b]&&(this[b]=a[b]);return this};a&&"function"!=typeof a.prototype.setCallbacks&&(a.prototype.setCallbacks=d),b&&"function"!=typeof b.prototype.setCallbacks&&(b.prototype.setCallbacks=d),c&&"function"!=typeof c.prototype.setCallbacks&&(c.prototype.setCallbacks=d)},supportedDataTypes:{value:[$data.Integer,$data.Number,$data.Date,$data.String,$data.Boolean,$data.Blob,$data.Array,$data.Object,$data.Guid,$data.GeographyPoint,$data.GeographyLineString,$data.GeographyPolygon,$data.GeographyMultiPoint,$data.GeographyMultiLineString,$data.GeographyMultiPolygon,$data.GeographyCollection,$data.GeometryPoint,$data.GeometryLineString,$data.GeometryPolygon,$data.GeometryMultiPoint,$data.GeometryMultiLineString,$data.GeometryMultiPolygon,$data.GeometryCollection,$data.Byte,$data.SByte,$data.Decimal,$data.Float,$data.Int16,$data.Int32,$data.Int64,$data.Time,$data.DateTimeOffset],writable:!1},fieldConverter:{value:$data.IndexedDBConverter},supportedAutoincrementKeys:{value:{"$data.Integer":!0,"$data.Int32":!0,"$data.Guid":function(){return $data.createGuid()}}},_getObjectStoreDefinition:function(a){var b={storeName:a.TableName},c=a.PhysicalType.memberDefinitions.getKeyProperties();if(0==c.length){var d=new Error("Entity must have a key field: "+b.storeName);throw d.name="KeyNotFoundError",d}c.length>2&&c.some(function(a){return a.computed})&&Guard.raise("With multiple keys the computed field is not allowed: "+b.storeName,"MultipleComputedKeyFieldError");for(var e=0;e<c.length;e++){var f=Container.resolveName(c[e].type);c[e].computed&&!this.supportedAutoincrementKeys[f]&&console.log("WARRNING! '"+f+"' not supported as computed Key!")}return b.keyFields=c,b},_getObjectStoreDefinitions:function(){var a=[],b=this;return b.context._storageModel.forEach(function(c){var d=b._getObjectStoreDefinition(c);a.push(d)}),a},_oldCreateDB:function(a,b,c){var d=this;a.db.onversionchange=function(a){return a.target.close()},d._createDB(a.db,b),a.oncomplete=c},_createDB:function(a,b){for(var c=0;c<b.length;c++)b[c].dropIfExists&&a.objectStoreNames.contains(b[c].storeName)&&a.deleteObjectStore(b[c].storeName);for(var c=0;c<b.length;c++){var d=b[c];if(!a.objectStoreNames.contains(d.storeName)){var e={};if(1==d.keyFields.length){e={keyPath:d.keyFields[0].name};var f=Container.resolveName(d.keyFields[0].type);e.autoIncrement=this.supportedAutoincrementKeys[f]?!0:!1}else{e.key=[];for(var c=0;c<d.keyFields.length;c++)e.key.push(d.keyFields[c].name)}a.createObjectStore(d.storeName,e)}}},_hasDbChanges:function(a,b,c){for(var d=!0,e=0;e<b.length;e++)d=d&&a.objectStoreNames.contains(b[e].storeName),c&&(b[e].dropIfExists=!0,d=!1);return!d},onupgradeneeded:function(a){var b=this;return function(c){var d=c.target.result;d.onversionchange=function(a){return a.target.close()};var e=b._hasDbChanges(d,a,b.providerConfiguration.dbCreation==$data.storageProviders.DbCreationType.DropAllExistingTables);e&&b._createDB(d,a)}},initializeStore:function(a){a=$data.typeSystem.createCallbackSetting(a);var b=this;this.initializeMemoryStore({success:function(){var c;try{c=b._getObjectStoreDefinitions()}catch(d){return console.log(c),void a.error(d)}b.indexedDB.open(b.providerConfiguration.databaseName).setCallbacks({onsuccess:function(d){var e=d.target.result;e.onversionchange=function(a){return a.target.close()};var f=b._hasDbChanges(e,c,b.providerConfiguration.dbCreation==$data.storageProviders.DbCreationType.DropAllExistingTables);if(e.setVersion){if(""===e.version||f)return void e.setVersion((parseInt(e.version)||0)+1).setCallbacks({onsuccess:function(d){var e=d.target.result;b._oldCreateDB(e,c,function(c){b.db=c.target.db,a.success(b.context)})},onerror:function(){arguments},onblocked:function(){arguments}})}else if(f){e.close();var g=parseInt(e.version)+1;return void b.indexedDB.open(b.providerConfiguration.databaseName,g).setCallbacks({onsuccess:function(c){b.db=c.target.result,a.success(b.context)},onupgradeneeded:b.onupgradeneeded(c),onerror:a.error,onabort:a.error,onblocked:a.error})}b.db=e,a.success(b.context)},onupgradeneeded:b.onupgradeneeded(c),onerror:a.error,onabort:a.error,onblocked:a.error})},error:a.error})},initializeMemoryStore:function(a){a=$data.typeSystem.createCallbackSetting(a);var b=this;b.originalContext&&b.providerConfiguration.memoryOperations?(b.operationProvider=new b.originalContext({name:"InMemory"}),b.operationProvider.onReady({success:function(){b.supportedBinaryOperators=b.operationProvider.storageProvider.supportedBinaryOperators,b.supportedSetOperations=b.operationProvider.storageProvider.supportedSetOperations,b.supportedFieldOperations=b.operationProvider.storageProvider.supportedFieldOperations,b.supportedUnaryOperators=b.operationProvider.storageProvider.supportedUnaryOperators,a.success()},error:a.error})):a.success()},_initializeStore:function(a){a=$data.typeSystem.createCallbackSetting(a);var b=this,c=function(a){a.onversionchange=function(a){var b=a.target.close();return b};var c=[];return b.context._storageModel.forEach(function(d){function e(){var e={},f=b._getKeySettings(d);b.newVersionAPI?f.autoIncrement&&c.push(d.TableName):e.autoIncrement=f.autoIncrement,void 0!==f.keyPath&&(e.keyPath=f.keyPath),a.createObjectStore(d.TableName,e)}a.objectStoreNames.contains(d.TableName)?b.providerConfiguration.dbCreation===$data.storageProviders.DbCreationType.DropAllExistingTables&&(a.deleteObjectStore(d.TableName),e()):e()}),c.length>0&&!a.objectStoreNames.contains(b.sequenceStore)&&(a.createObjectStore(b.sequenceStore,{keyPath:"store"}),c=[]),c},d=null,e={onupgradeneeded:function(a){d=c(a.target.result)},onerror:a.error,onblocked:a.error,onsuccess:function(e){if(b.db=e.target.result,b.db.onversionchange=function(a){a.target.close()},b.newVersionAPI){if(d&&d.length>0){var f=b.db.transaction([b.sequenceStore],b.IDBTransactionType.READ_WRITE).setCallbacks({onerror:a.error,oncomplete:function(){a.success(b.context)}}).objectStore(b.sequenceStore);switch(b.providerConfiguration.dbCreation){case $data.storageProviders.DbCreationType.DropAllExistingTables:case $data.storageProviders.DbCreationType.DropTableIfChanged:f.clear();break;default:d.forEach(function(a){f["delete"](a)})}}a.success(b.context)}else var g=b.db.setVersion(b.providerConfiguration.version.toString()).setCallbacks({onerror:a.error,onblocked:a.error,onsuccess:function(){c(b.db),g.result.oncomplete=function(){a.success(b.context)}}})}};b.newVersionAPI?b.indexedDB.open(b.providerConfiguration.databaseName,parseInt(b.providerConfiguration.version,10)).setCallbacks(e):b.indexedDB.open(b.providerConfiguration.databaseName).setCallbacks(e)},executeQuery:function(a,b){b=$data.typeSystem.createCallbackSetting(b);var c=this,d=a.context.getEntitySetFromElementType(a.defaultType),e=c.db.transaction([d.tableName],c.IDBTransactionType.READ_ONLY).setCallbacks({onerror:b.error,onabort:b.error,oncomplete:function(){c.operationProvider?(c.operationProvider.storageProvider.dataSource[d.tableName]=a.rawDataList,c.operationProvider.storageProvider.executeQuery(a,{success:function(a){a.expression.nodeType===$data.Expressions.ExpressionType.Count&&(a.rawDataList[0]={cnt:a.rawDataList[0]}),b.success(a)},error:b.error})):b.success(a)}}).objectStore(d.tableName),f=Container.createModelBinderConfigCompiler(a,[]);if(f.Visit(a.expression),c.operationProvider)e.openCursor().onsuccess=function(b){var c=b.target.result;if(c){{c.value}a.rawDataList.push(c.value),c["continue"]()}};else switch(a.expression.nodeType){case $data.Expressions.ExpressionType.Count:e.count().onsuccess=function(b){var c=b.target.result;a.rawDataList.push({cnt:c})};break;default:e.openCursor().onsuccess=function(b){var c=b.target.result;if(c){{c.value}a.rawDataList.push(c.value),c["continue"]()}}}},_getKeySettings:function(a){var b=this,c={autoIncrement:!1},d=[];return a.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(a){if(a.key&&d.push(a.name),a.computed){a.key||Guard.raise(new Exception("Only key field can be a computed field!"));var e=Container.resolveName(a.type);b.supportedAutoincrementKeys[e]===!0&&(c.autoIncrement=!0)}}),d.length>1?(c.autoIncrement&&Guard.raise(new Exception("Auto increment is only valid for a single key!")),c.keys=d):1==d.length?c.keyPath=d[0]:Guard.raise(new Exception("No valid key found!")),c},saveChanges:function(a,b){function c(){function b(){var a={};this.getSettingsForItem=function(b){var c=b.data.getType().fullName;return a.hasOwnProperty(c)||(a[c]=d._getKeySettings(d.context._storageModel.getStorageModel(b.data.getType()))),a[c]}}if(0===e.length)a.success();else{var f=e.shift(),g={},h=f.map(function(a){return g[a.entitySet.tableName]=!0,a.physicalData={},a.entitySet.elementType.memberDefinitions.getPublicMappedProperties().forEach(function(b){var c=Container.resolveName(b.type);if(b.key&&b.computed&&void 0==a.data[b.name]){if("function"!=typeof d.supportedAutoincrementKeys[c])return;var e=d.supportedAutoincrementKeys[c]();a.data[b.name]=d.fieldConverter.toDb[c](e)}if(!b.inverseProperty&&"undefined"==typeof b.concurrencyMode&&(b.key===!0||a.data.entityState===$data.EntityState.Added||a.data.changedProperties&&a.data.changedProperties.some(function(a){return a.name===b.name})))if(d.fieldConverter.toDb[c])a.physicalData[b.name]=d.fieldConverter.toDb[c](a.data[b.name]);else{var f=a.data[b.name];void 0!==f&&(f=JSON.parse(JSON.stringify(f))),a.physicalData[b.name]=f}}),a}),i=[];for(var j in g)i.push(j);var k=d.db.transaction(i,d.IDBTransactionType.READ_WRITE).setCallbacks({onerror:function(b){(!b.target||!d.IDBDatabaseException||b.target&&d.IDBDatabaseException&&b.target.errorCode!==d.IDBDatabaseException.ABORT_ERR)&&a.error(b)},oncomplete:function(){c()}}),l=new b;h.forEach(function(b){var c=k.objectStore(b.entitySet.tableName),e=l.getSettingsForItem(b),f=e.keys&&e.keys.map(function(a){return b.physicalData[a]})||null;try{var g=function(g){var h=e.keyPath?b.physicalData[e.keyPath]:f,i=b.physicalData;c.openCursor(d.IDBKeyRange.only(h)).onsuccess=function(c){try{var d=c.target.result;d?g(d,h,i):Guard.raise(new Exception("Object not found",null,b))}catch(e){k.abort(),a.error(e)}}};switch(b.data.entityState){case $data.EntityState.Added:e.keyPath?c.add(b.physicalData).onsuccess=function(a){b.data[e.keyPath]=a.target.result}:c.add(b.physicalData,f);break;case $data.EntityState.Deleted:g(function(a){a["delete"]()});break;case $data.EntityState.Modified:g(function(a,b,c){a.update($data.typeSystem.extend(a.value,c))});break;case $data.EntityState.Unchanged:break;default:Guard.raise(new Exception("Not supported entity state",null,b))}}catch(h){k.abort(),a.error(h)}})}}var d=this,e=d.buildIndependentBlocks(b);c()},_compile:function(a){var b=Container.createIndexedDBCompiler().compile(a);return b}},{isSupported:{get:function(){return window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB?!0:!1},set:function(){}}}),$data.storageProviders.indexedDb.IndexedDBStorageProvider.isSupported&&$data.StorageProviderBase.registerProvider("indexedDb",$data.storageProviders.indexedDb.IndexedDBStorageProvider),$data.InMemoryConverter={fromDb:{"$data.Byte":$data.Container.proxyConverter,"$data.SByte":$data.Container.proxyConverter,"$data.Decimal":$data.Container.proxyConverter,"$data.Float":$data.Container.proxyConverter,"$data.Int16":$data.Container.proxyConverter,"$data.Int64":$data.Container.proxyConverter,"$data.Integer":$data.Container.proxyConverter,"$data.Int32":$data.Container.proxyConverter,"$data.Number":$data.Container.proxyConverter,"$data.Date":$data.Container.proxyConverter,"$data.DateTimeOffset":$data.Container.proxyConverter,"$data.Time":$data.Container.proxyConverter,"$data.String":$data.Container.proxyConverter,"$data.Boolean":$data.Container.proxyConverter,"$data.Blob":$data.Container.proxyConverter,"$data.Object":function(a){return void 0===a?new $data.Object:a},"$data.Array":function(a){return void 0===a?new $data.Array:a},"$data.Guid":function(a){return a?$data.parseGuid(a).toString():a},"$data.GeographyPoint":function(a){return a?new $data.GeographyPoint(a):a},"$data.GeographyLineString":function(a){return a?new $data.GeographyLineString(a):a},"$data.GeographyPolygon":function(a){return a?new $data.GeographyPolygon(a):a},"$data.GeographyMultiPoint":function(a){return a?new $data.GeographyMultiPoint(a):a},"$data.GeographyMultiLineString":function(a){return a?new $data.GeographyMultiLineString(a):a},"$data.GeographyMultiPolygon":function(a){return a?new $data.GeographyMultiPolygon(a):a},"$data.GeographyCollection":function(a){return a?new $data.GeographyCollection(a):a},"$data.GeometryPoint":function(a){return a?new $data.GeometryPoint(a):a},"$data.GeometryLineString":function(a){return a?new $data.GeometryLineString(a):a},"$data.GeometryPolygon":function(a){return a?new $data.GeometryPolygon(a):a},"$data.GeometryMultiPoint":function(a){return a?new $data.GeometryMultiPoint(a):a},"$data.GeometryMultiLineString":function(a){return a?new $data.GeometryMultiLineString(a):a},"$data.GeometryMultiPolygon":function(a){return a?new $data.GeometryMultiPolygon(a):a},"$data.GeometryCollection":function(a){return a?new $data.GeometryCollection(a):a}},toDb:{"$data.Byte":$data.Container.proxyConverter,"$data.SByte":$data.Container.proxyConverter,"$data.Decimal":$data.Container.proxyConverter,"$data.Float":$data.Container.proxyConverter,"$data.Int16":$data.Container.proxyConverter,"$data.Int64":$data.Container.proxyConverter,"$data.Integer":$data.Container.proxyConverter,"$data.Int32":$data.Container.proxyConverter,"$data.Number":$data.Container.proxyConverter,"$data.Date":$data.Container.proxyConverter,"$data.DateTimeOffset":$data.Container.proxyConverter,"$data.Time":$data.Container.proxyConverter,"$data.String":$data.Container.proxyConverter,"$data.Boolean":$data.Container.proxyConverter,"$data.Blob":$data.Container.proxyConverter,"$data.Object":$data.Container.proxyConverter,"$data.Array":$data.Container.proxyConverter,"$data.Guid":function(a){return a?a.toString():a},"$data.GeographyPoint":function(a){return a?a:a},"$data.GeographyLineString":function(a){return a?a:a},"$data.GeographyPolygon":function(a){return a?a:a},"$data.GeographyMultiPoint":function(a){return a?a:a},"$data.GeographyMultiLineString":function(a){return a?a:a},"$data.GeographyMultiPolygon":function(a){return a?a:a},"$data.GeographyCollection":function(a){return a?a:a},"$data.GeometryPoint":function(a){return a?a:a},"$data.GeometryLineString":function(a){return a?a:a},"$data.GeometryPolygon":function(a){return a?a:a},"$data.GeometryMultiPoint":function(a){return a?a:a},"$data.GeometryMultiLineString":function(a){return a?a:a},"$data.GeometryMultiPolygon":function(a){return a?a:a},"$data.GeometryCollection":function(a){return a?a:a}},escape:{"$data.Byte":$data.Container.proxyConverter,"$data.SByte":$data.Container.proxyConverter,"$data.Decimal":$data.Container.proxyConverter,"$data.Float":$data.Container.proxyConverter,"$data.Int16":$data.Container.proxyConverter,"$data.Int64":$data.Container.proxyConverter,"$data.Integer":$data.Container.proxyConverter,"$data.Int32":$data.Container.proxyConverter,"$data.Number":$data.Container.proxyConverter,"$data.Date":function(a){return a?"new Date(Date.parse('"+a.toISOString()+"'))":a},"$data.DateTimeOffset":function(a){return a?"new Date(Date.parse('"+a.toISOString()+"'))":a},"$data.Time":function(a){return a?"'"+a+"'":a},"$data.String":function(a){return"'"+a.replace(/'/g,"''")+"'"},"$data.Boolean":function(a){return a?"true":"false"},"$data.Blob":function(a){return"'"+$data.Blob.toString(a)+"'"},"$data.Object":function(a){return JSON.stringify(a)},"$data.Array":function(a){return JSON.stringify(a)},"$data.Guid":function(a){return a?"'"+a.toString()+"'":a}}},$C("$data.storageProviders.InMemory.InMemoryProvider",$data.StorageProviderBase,null,{constructor:function(a,b){this.context=b,this.providerConfiguration=$data.typeSystem.extend({source:null,persistentData:!1,localStoreName:"JayData_InMemory_Provider",databaseName:"JayData_InMemory_Provider",__instaceId:$data.createGuid().toString()},a),this.dataSource=this.providerConfiguration.source,delete this.providerConfiguration.source,"JayData_InMemory_Provider"===this.providerConfiguration.databaseName&&(this.providerConfiguration.databaseName=this.providerConfiguration.localStoreName)},initializeStore:function(a){a=$data.typeSystem.createCallbackSetting(a);var b=[];for(var c in this.context._entitySetReferences)b.push(this.context._entitySetReferences[c].collectionName);var d=null;if(this.providerConfiguration.persistentData&&window.localStorage&&this.providerConfiguration.dbCreation!==$data.storageProviders.DbCreationType.DropAllExistingTables){var e=this.providerConfiguration.databaseName||"JayData_InMemory_Provider",f=this,g=window.localStorage.getItem(e);Object.isNullOrUndefined(g)||(d=JSON.parse(g,function(a,c){return b.indexOf(a)>-1&&c.map?c.map(function(b){return new f.context[a].createNew(b)}):c}))}var h=d||this.dataSource||{};this.dataSource={inmemory_sequence:{}};for(var i=0;i<this.context._storageModel.length;i++){var j=this.context._storageModel[i];this.dataSource[j.TableName]=[];var k=j.LogicalType.memberDefinitions.getKeyProperties(),l=k.filter(function(a){return a.computed});l.length>1&&Guard.raise(new Exception("More than one computed field not supported in "+j.TableName+" entity set."));var m=!1;if(1===l.length){var n=Container.resolveName(l[0].type);this.supportedAutoincrementKeys[n]===!0?(this.dataSource.inmemory_sequence[j.TableName]=0,m=!0):"function"==typeof this.supportedAutoincrementKeys[n]||console.log("WARRNING! '"+n+"' not supported as computed Key!")}if(h[j.TableName])for(var c=0;c<h[j.TableName].length;c++){var o=h[j.TableName][c];if(o instanceof j.LogicalType||(d?o=new j.LogicalType(o):Guard.raise(new Exception("Invalid element in source: "+j.TableName))),m){var p=o[l[0].name];p>this.dataSource.inmemory_sequence[j.TableName]&&(this.dataSource.inmemory_sequence[j.TableName]=p)}this.dataSource[j.TableName].push(o)}}a.success(this.context)},executeQuery:function(a,b){b=$data.typeSystem.createCallbackSetting(b);var c;try{c=this._compile(a)}catch(d){return void b.error(d)}var e=a.context.getEntitySetFromElementType(a.defaultType).tableName,f=[].concat(this.dataSource[e]||[]);c.$filter&&!c.$every&&(f=f.filter(c.$filter)),c.$map&&0===Object.keys(a.modelBinderConfig).length&&(f=f.map(c.$map)),c.$order&&c.$order.length>0&&f.sort(function(a,b){for(var d,e=0,f=c.$order.length;f>e;e++){d=0;var g=c.$order[e](a),h=c.$order[e](b);if(d=c.$order[e].ASC?g===h?0:g>h||null===h?1:-1:g===h?0:h>g||null===g?1:-1,0!==d)break}return d}),void 0!==c.$take&&void 0!==c.$skip?f=f.slice(c.$skip,c.$skip+c.$take):void 0!==c.$take&&f.length>c.$take?f=f.slice(0,c.$take):c.$skip&&(f=f.slice(c.$skip,f.length)),c.$some&&(f=[f.length>0]),c.$length&&(f=[f.length]),a.rawDataList=f,b.success(a)},_compile:function(a){var b=new $data.storageProviders.InMemory.InMemoryCompiler(this),c=b.compile(a);return c},saveChanges:function(a,b){for(var c=0;c<b.length;c++){var d=b[c];switch(d.data.entityState){case $data.EntityState.Added:this._save_add_processPk(d),this.dataSource[d.entitySet.tableName].push(d.data);break;case $data.EntityState.Deleted:var e=this.dataSource[d.entitySet.tableName],f=this._save_getEntity(d,e),g=e.indexOf(f);e.splice(g,1);break;case $data.EntityState.Modified:if(d.data.changedProperties&&d.data.changedProperties.length>0)for(var e=this.dataSource[d.entitySet.tableName],f=this._save_getEntity(d,e),h=0;h<d.data.changedProperties.length;h++){var i=d.data.changedProperties[h];!i.key&&d.entitySet.elementType.memberDefinitions.getPublicMappedPropertyNames().indexOf(i.name)>-1&&(f[i.name]=d.data[i.name])}}}if(this.providerConfiguration.persistentData&&window.localStorage){var j=this.providerConfiguration.databaseName||"JayData_InMemory_Provider",k=this,l=[];for(var c in this.context._entitySetReferences)l.push(this.context._entitySetReferences[c].collectionName);localStorageData=window.localStorage.setItem(j,JSON.stringify(this.dataSource,function(a,b){if(l.indexOf(a)>-1&&Array.isArray(b)){for(var c=[],d=0;d<b.length;d++){var e={};k.context[a].elementType.memberDefinitions.getPublicMappedProperties().forEach(function(a){if(!a.inverseProperty){var c=Container.resolveName(a.type),f=k.fieldConverter.fromDb[c];e[a.name]=f?f(b[d][a.name]):b[d][a.name]}}),c.push(e)}return c}return b}))}a.success()},_save_add_processPk:function(a){var b=a.entitySet.elementType.memberDefinitions.getKeyProperties();if(1===b.length&&b[0].computed){var c=b[0],d=Container.resolveName(c.type);if("function"==typeof this.supportedAutoincrementKeys[d])a.data[c.name]=this.supportedAutoincrementKeys[d]();else if(this.supportedAutoincrementKeys[d]===!0){var e=this.dataSource.inmemory_sequence[a.entitySet.tableName];a.data[c.name]=e+1,this.dataSource.inmemory_sequence[a.entitySet.tableName]=e+1}}else for(var f=0;f<b.length;f++)(null===a.data[b[f].name]||void 0===a.data[b[f].name])&&Guard.raise(new Exception("Key field must set value! Key field name without value: "+b[f].name))},_save_getEntity:function(a,b){var c=a.entitySet.elementType.memberDefinitions.getKeyProperties();return entities=b.filter(function(b){for(var d=!0,e=0;e<c.length;e++)d=d&&b[c[e].name]===a.data[c[e].name];return d}),entities>1&&Guard.raise(new Exception("Inconsistent storage!")),entities[0]},getTraceString:function(a){var b=this._compile(a);return b},supportedDataTypes:{value:[$data.Integer,$data.String,$data.Number,$data.Blob,$data.Boolean,$data.Date,$data.Object,$data.Guid,$data.GeographyPoint,$data.GeographyLineString,$data.GeographyPolygon,$data.GeographyMultiPoint,$data.GeographyMultiLineString,$data.GeographyMultiPolygon,$data.GeographyCollection,$data.GeometryPoint,$data.GeometryLineString,$data.GeometryPolygon,$data.GeometryMultiPoint,$data.GeometryMultiLineString,$data.GeometryMultiPolygon,$data.GeometryCollection,$data.Byte,$data.SByte,$data.Decimal,$data.Float,$data.Int16,$data.Int32,$data.Int64,$data.Time,$data.DateTimeOffset],writable:!1},supportedBinaryOperators:{value:{equal:{mapTo:" == ",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},notEqual:{mapTo:" != ",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},equalTyped:{mapTo:" === ",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},notEqualTyped:{mapTo:" !== ",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},greaterThan:{mapTo:" > ",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},greaterThanOrEqual:{mapTo:" >= ",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},lessThan:{mapTo:" < ",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},lessThenOrEqual:{mapTo:" <= ",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},or:{mapTo:" || ",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},and:{mapTo:" && ",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},"in":{mapTo:".indexOf(",allowedIn:[$data.Expressions.FilterExpression],rightValue:") > -1",reverse:!0}}},supportedUnaryOperators:{value:{not:{mapTo:"!"}}},supportedFieldOperations:{value:{contains:{mapTo:"$data.StringFunctions.contains(",rightValue:")",dataType:"boolean",parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},startsWith:{mapTo:"$data.StringFunctions.startsWith(",rightValue:")",dataType:"boolean",parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},endsWith:{mapTo:"$data.StringFunctions.endsWith(",rightValue:")",dataType:"boolean",parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},length:{dataType:"number",propertyFunction:!0},substr:{mapTo:"substr(",rightValue:")",dataType:"string",parameters:[{name:"startFrom",dataType:"number"},{name:"length",dataType:"number"}],propertyFunction:!0},toLowerCase:{dataType:"string",mapTo:"toLowerCase()",propertyFunction:!0},toUpperCase:{dataType:"string",mapTo:"toUpperCase()",propertyFunction:!0},trim:{dataType:$data.String,mapTo:"trim()",propertyFunction:!0},ltrim:{dataType:$data.String,mapTo:"trimLeft()",propertyFunction:!0},rtrim:{dataType:$data.String,mapTo:"trimRight()",propertyFunction:!0}},enumerable:!0,writable:!0},supportedSetOperations:{value:{filter:{},map:{},length:{},forEach:{},toArray:{},single:{},some:{},take:{},skip:{},orderBy:{},orderByDescending:{},first:{}},enumerable:!0,writable:!0},fieldConverter:{value:$data.InMemoryConverter},supportedAutoincrementKeys:{value:{"$data.Integer":!0,"$data.Int32":!0,"$data.Guid":function(){return $data.createGuid()
}}}},null),$C("$data.storageProviders.InMemory.LocalStorageProvider",$data.storageProviders.InMemory.InMemoryProvider,null,{constructor:function(){this.providerConfiguration.persistentData=!0}},null),$data.StorageProviderBase.registerProvider("InMemory",$data.storageProviders.InMemory.InMemoryProvider),$data.StorageProviderBase.registerProvider("LocalStore",$data.storageProviders.InMemory.LocalStorageProvider),$C("$data.storageProviders.InMemory.InMemoryCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){this.provider=a},compile:function(a){var b={urlText:""};this.Visit(a.expression,b);var c={};for(var d in b)0==d.indexOf("$")&&(c[d]=b[d]);return c},VisitOrderExpression:function(a,b){this.Visit(a.source,b),b.data="",b.lambda="";var c=Container.createInMemoryFunctionCompiler(this.provider);c.compile(a.selector,b),b.$order=b.$order||[];var d=new Function(b.lambda,"return "+b.data+";");d.ASC="OrderBy"==a.nodeType,b.$order.push(d),b.data="",b.lambda=""},VisitIncludeExpression:function(a,b){this.Visit(a.source,b),b.$include=b.$include||[],b.$include.indexOf(a.selector.value)<0&&b.$include.push(a.selector.value)},VisitPagingExpression:function(a,b){this.Visit(a.source,b),b["$"+a.nodeType.toLowerCase()]=a.amount.value},VisitProjectionExpression:function(a,b){this.defaultFunctionCompiler(a,b,"$map")},VisitFilterExpression:function(a,b){this.defaultFunctionCompiler(a,b,"$filter")},VisitSomeExpression:function(a,b){this.defaultFunctionCompiler(a,b,"$some")},VisitEveryExpression:function(a,b){this.defaultFunctionCompiler(a,b,"$every")},VisitCountExpression:function(a,b){this.Visit(a.source,b),b.$length=!0},VisitServiceOperationExpression:function(a,b){b.$serviceOperation={name:a.cfg.serviceName,params:a.params}},defaultFunctionCompiler:function(a,b,c){this.Visit(a.source,b),b.data="",b.lambda="";var d=Container.createInMemoryFunctionCompiler(this.provider);d.compile(a.selector,b),b[c]=new Function(b.lambda,"return "+b.data+";"),b.data="",b.lambda=""}},{}),$C("$data.storageProviders.InMemory.InMemoryFunctionCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){this.provider=a},compile:function(a,b){this.Visit(a,b)},VisitParametricQueryExpression:function(a,b){this.Visit(a.expression,b)},VisitUnaryExpression:function(a,b){b.data+=a.resolution.mapTo,b.data+="(",this.Visit(a.operand,b),b.data+=")"},VisitSimpleBinaryExpression:function(a,b){var c=this;if(a.resolution.reverse){if(b.data+="(","in"===a.resolution.name&&Array.isArray(a.right.value))b.data+="[",a.right.value.forEach(function(a,d){d>0&&(b.data+=","),c.Visit(a,b)}),b.data+="]";else{this.Visit(a.right,b)}b.data+=a.resolution.mapTo;{this.Visit(a.left,b)}a.resolution.rightValue&&(b.data+=a.resolution.rightValue),b.data+=")"}else{b.data+="(";{this.Visit(a.left,b)}b.data+=a.resolution.mapTo;{this.Visit(a.right,b)}b.data+=")"}},VisitConstantExpression:function(a,b){var c=Container.resolveType(a.type),d=Container.resolveName(c),e=this.provider.fieldConverter.escape[d];b.data+=e?e(a.value):a.value},VisitMemberInfoExpression:function(a,b){b.data+=".",b.data+=a.memberName},VisitComplexTypeExpression:function(a,b){this.Visit(a.source,b),this.Visit(a.selector,b)},VisitEntityExpression:function(a,b){b.data+=a.selector.lambda,b.lambda=a.selector.lambda,this.Visit(a.source,b)},VisitEntitySetExpression:function(){},VisitObjectLiteralExpression:function(a,b){b.data+="{ ";for(var c=0;c<a.members.length;c++){var d=a.members[c];c>0&&(b.data+=", "),this.Visit(d,b)}b.data+=" }"},VisitObjectFieldExpression:function(a,b){b.data+=a.fieldName+": ",this.Visit(a.expression,b)},VisitEntityFieldOperationExpression:function(a,b){Guard.requireType("expression.operation",a.operation,$data.Expressions.MemberInfoExpression);var c=a.operation.memberDefinition;c.propertyFunction&&(this.Visit(a.source,b),b.data+=".");var d=c.mapTo||c.name;b.data+=d;var e=0,f=c.parameters||[],g=f.map(function(b){return"@expression"===b.name?a.source:a.parameters[e++]});g.forEach(function(a,c){a&&(c>0&&(b.data+=","),this.Visit(a,b))},this),b.data+=c.rightValue||""}}),function(a){"undefined"!=typeof jQuery&&(a.Class.define("$data.Deferred",a.PromiseHandlerBase,null,{constructor:function(){this.deferred=new $.Deferred},deferred:{},createCallback:function(b){b=a.typeSystem.createCallbackSetting(b);var c=this;return cbWrapper={success:function(){b.success.apply(c.deferred,arguments),c.deferred.resolve.apply(c.deferred,arguments)},error:function(){Array.prototype.push.call(arguments,c.deferred),b.error.apply(c.deferred,arguments)},notify:function(){b.notify.apply(c.deferred,arguments),c.deferred.notify.apply(c.deferred,arguments)}}},getPromise:function(){return this.deferred.promise()}},null),a.PromiseHandler=a.Deferred)}($data),function(a){var b;if("undefined"==typeof Q){if("undefined"==typeof module||!module.exports)return void Guard.raise(new Exception("Q is not defined"));b=require("q")}else b=Q;a.Class.define("$data.Deferred",a.PromiseHandlerBase,null,{constructor:function(){this.deferred=new b.defer},deferred:{},createCallback:function(b){b=a.typeSystem.createCallbackSetting(b);var c=this;return cbWrapper={success:function(){b.success.apply(c.deferred,arguments),c.deferred.resolve.apply(c.deferred,arguments)},error:function(){Array.prototype.push.call(arguments,c.deferred),b.error.apply(c.deferred,arguments)}}},getPromise:function(){return this.deferred.promise}},null),a.PromiseHandler=a.Deferred}($data);